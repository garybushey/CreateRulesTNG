Selected,Name,ID,Source,Severity,Kind,Description,Tactics,Techniques,QueryFrequency,QueryPeriod
X,(Preview) TI map Domain entity to Dns Events (ASIM DNS Schema),999e9f5d-db4a-4b07-a206-29c4e667b7e8,Sentinel,Medium,Scheduled,"Identifies a match in DNS events from any Domain IOC from TI
This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM DNS schema",Impact,,PT1H,P14D
X,(Preview) TI map Domain entity to Web Session Events (ASIM Web Session schema),b1832f60-6c3d-4722-a0a5-3d564ee61a63,Sentinel,Medium,Scheduled,This rule identifies Web Sessions for which the target URL hostname is a known IoC. <br><br>This rule uses the [Advanced Security Information Model (ASIM)](https:/aka.ms/AboutASIM) and supports any web session source that complies with ASIM.,Impact,,PT1H,P14D
X,(Preview) TI map IP entity to DNS Events (ASIM DNS schema),67775878-7f8b-4380-ac54-115e1e828901,Sentinel,Medium,Scheduled,"This rule identifies DNS requests for which response IP address is a known IoC. <br><br>
This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM DNS schema.",Impact,,PT1H,P14D
X,(Preview) TI map IP entity to Network Session Events (ASIM Network Session schema),e2399891-383c-4caf-ae67-68a008b9f89e,Sentinel,Medium,Scheduled,"This rule identifies a match Network Sessions for which the source of destination IP address is a known IoC. <br><br>
This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM NetworkSession schema",Impact,,PT1H,P14D
X,(Preview) TI map IP entity to Web Session Events (ASIM Web Session schema),e2559891-383c-4caf-ae67-55a008b9f89e,Sentinel,Medium,Scheduled,This rule identifies Web Sessions for which the source IP address is a known IoC. <br><br>This rule uses the [Advanced Security Information Model (ASIM)](https://aka.ms/AboutASIM) and supports any web session source that complies with ASIM.,Impact,,PT1H,P14D
X,A client made a web request to a potentially harmful file (ASIM Web Session schema),09c49590-4e9d-4da9-a34d-17222d0c9e7e,Sentinel,Medium,Scheduled,"This rule identifies a web request to a URL that holds a file type, including .ps1, .bat, .vbs, and .scr that can be harmful if downloaded. This rule uses the [Advanced Security Information Model (ASIM)](https://aka.ms/AboutASIM) and supports any web session source that complies with ASIM. To use this Analytics Rule, deploy the Advanced Security Information Model (ASIM).
 This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM WebSession schema (ASIM WebSession Schema)",InitialAccess,,PT10M,PT10M
X,A host is potentially running a crypto miner (ASIM Web Session schema),8cbc3215-fa58-4bd6-aaaa-f0029c351730,Sentinel,Medium,Scheduled,"This rule identifies a web request with a user agent header known to belong to a crypto miner. This indicates a crypto miner may have infected the client machine.<br>You can add custom crypto mining indicating User-Agent headers using a watchlist, for more information refer to the [UnusualUserAgents Watchlist](https://aka.ms/ASimUnusualUserAgentsWatchlist).<br><br>   This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM WebSession schema (ASIM WebSession Schema)",CommandAndControl,,PT15M,PT15M
X,A host is potentially running a hacking tool (ASIM Web Session schema),3f0c20d5-6228-48ef-92f3-9ff7822c1954,Sentinel,Medium,Scheduled,"This rule identifies a web request with a user agent header known to belong to a hacking tool. This indicates a hacking tool is used on the host.<br>You can add custom hacking tool indicating User-Agent headers using a watchlist, for more information refer to the [UnusualUserAgents Watchlist](https://aka.ms/ASimUnusualUserAgentsWatchlist).<br><br>
 This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM WebSession schema (ASIM WebSession Schema)",CommandAndControl,,PT15M,PT15M
X,A host is potentially running PowerShell to send HTTP(S) requests (ASIM Web Session schema),42436753-9944-4d70-801c-daaa4d19ddd1,Sentinel,Medium,Scheduled,"This rule identifies a web request with a user agent header known to belong PowerShell. <br>You can add custom Powershell indicating User-Agent headers using a watchlist, for more information refer to the [UnusualUserAgents Watchlist](https://aka.ms/ASimUnusualUserAgentsWatchlist).<br><br>
 This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM WebSession schema (ASIM WebSession Schema)",CommandAndControl|DefenseEvasion,,PT15M,PT15M
X,A potentially malicious web request was executed against a web server,46ac55ae-47b8-414a-8f94-89ccd1962178,Sentinel,Medium,Scheduled,"Detects unobstructed Web Application Firewall (WAF) activity in sessions where the WAF blocked incoming requests by computing the 
ratio between blocked requests and unobstructed WAF requests in these sessions (BlockvsSuccessRatio metric). A high ratio value for 
a given client IP and hostname calls for further investigation of the WAF data in that session, due to the significantly high number 
of blocked requests and a few unobstructed logs which may be malicious but have passed undetected through the WAF. The successCode 
variable defines what the detection thinks is a successful status code, and should be altered to fit the environment.",InitialAccess,T1190,P1D,P1D
X,AAD Local Device Join Information and Transport Key Registry Keys Access,a356c8bd-c81d-428b-aa36-83be706be034,Sentinel,Medium,Scheduled,"This detection uses Windows security events to detect suspicious access attempts by the same process
 to registry keys that provide information about an AAD joined or registered devices and Transport keys (tkpub / tkpriv).
 This information can be used to export the Device Certificate (dkpub / dkpriv) and Transport key (tkpub/tkpriv).
 These set of keys can be used to impersonate existing Azure AD joined devices.
 This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable objects:
 HKLM:\SYSTEM\CurrentControlSet\Control\CloudDomainJoin (AAD joined devices)
 HKCU:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WorkplaceJoin (AAD registered devices)
 HKLM:\SYSTEM\CurrentControlSet\Control\Cryptography\Ngc\KeyTransportKey (Transport Key)
 Make sure you set the SACL to propagate to its sub-keys. You can find more information in here https://github.com/OTRF/Set-AuditRule/blob/master/rules/registry/aad_connect_health_service_agent.yml
 Reference: https://o365blog.com/post/deviceidentity/",Discovery,T1012,P1D,P1D
X,Accessed files shared by temporary external user,bff058b2-500e-4ae5-bb49-a5b1423cbd5b,Sentinel,Low,Scheduled,"This detection identifies an external user is added to a Team or Teams chat
and shares a files which is accessed by many users (>10) and the users is removed within short period of time. This might be
an indicator of suspicious activity.",InitialAccess,T1566,PT1H,PT1H
X,Account added and removed from privileged groups,7efc75ce-e2a4-400f-a8b1-283d3b0f2c60,Sentinel,Low,Scheduled,"Identifies accounts that are added to privileged group and then quickly removed, which could be a sign of compromise.",Persistence|PrivilegeEscalation,T1098|T1078,P1D,P1D
X,Account Created and Deleted in Short Timeframe,bb616d82-108f-47d3-9dec-9652ea0d3bf6,Sentinel,High,Scheduled,"Search for user principal name (UPN) events. Look for accounts created and then deleted in under 24 hours. Attackers may create an account for their use, and then remove the account when no longer needed.
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-user-accounts#short-lived-account",InitialAccess,T1078,PT1H,P1D
X,Account created from non-approved sources,99d589fa-7337-40d7-91a0-c96d0c4fa437,Sentinel,Medium,Scheduled,"This query looks for account being created from a domain that is not regularly seen in a tenant.
  Attackers may attempt to add accounts from these sources as a means of establishing persistant access to an environment.
  Created accounts should be investigated to ensure they were legitimated created.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-user-accounts#short-lived-accounts",Persistence,T1136,P1D,P7D
X,Account created or deleted by non-approved user,6d63efa6-7c25-4bd4-a486-aa6bf50fde8a,Sentinel,Medium,Scheduled,"Identifies accounts that were created or deleted by a defined list of non-approved user principal names. Add to this list before running the query for accurate results.
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-user-accounts",InitialAccess,T1078,P1D,P1D
X,Account Elevated to New Role,c1c66f0b-5531-4a3e-a619-9d2f770ef730,Sentinel,Medium,Scheduled,"Detects an account that is elevated to a new role where that account has not had that role in the last 14 days.
  Role elevations are a key mechanism for gaining permissions, monitoring which users have which roles, and for anomalies in those roles is useful for finding suspicious activity.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-accounts#changes-to-privileged-accounts",Persistence,T1078,P1D,P14D
X,ACTINIUM Actor IOCs - Feb 2022,825991eb-ea39-4590-9de2-ee97ef42eb93,Sentinel,High,Scheduled,"Identifies a match across various data feeds for domains, hashes and commands related to an actor tracked by Microsoft as Actinium.",Persistence,T1137,PT6H,PT6H
X,ACTINIUM AV hits - Feb 2022,18dbdc22-b69f-4109-9e39-723d9465f45f,Sentinel,High,Scheduled,Identifies a match in the Security Alert table for MDATP hits related to the ACTINIUM actor,Persistence,T1137,PT6H,PT6H
X,AD account with Don't Expire Password,6c360107-f3ee-4b91-9f43-f4cfd90441cf,Sentinel,Low,Scheduled,"Identifies whenever a user account has the setting ""Password Never Expires"" in the user account properties selected.
This is indicated in Security event 4738 in the EventData item labeled UserAccountControl with an included value of %%2089.
%%2089 resolves to ""Don't Expire Password - Enabled"".",Persistence,T1098,P1D,P1D
X,AD FS Abnormal EKU object identifier attribute,cfc1ae62-db63-4a3e-b88b-dc04030c2257,Sentinel,High,Scheduled,"This detection uses Security events from the ""AD FS Auditing"" provider to detect suspicious object identifiers (OIDs) as part EventID 501 and specifically part of the Enhanced Key Usage attributes.
This query checks to see if you have any new OIDs in the last hour that have not been seen in the previous day. New OIDs should be validated and OIDs that are very long, as indicated
by the OID_Length field, could also be an indicator of malicious activity.
In order to use this query you need to enable AD FS auditing on the AD FS Server.
References:
https://www.microsoft.com/security/blog/2022/08/24/magicweb-nobeliums-post-compromise-trick-to-authenticate-as-anyone/
https://docs.microsoft.com/windows-server/identity/ad-fs/troubleshooting/ad-fs-tshoot-logging
",CredentialAccess,T1552,PT1H,P1D
X,AD FS Remote Auth Sync Connection,2f4165a6-c4fb-4e94-861e-37f1b4d6c0e6,Sentinel,Medium,Scheduled,"This detection uses Security events from the ""AD FS Auditing"" provider to detect suspicious authentication events on an AD FS server. The results then get
correlated with events from the Windows Filtering Platform (WFP) to detect suspicious incoming network traffic on port 80 on the AD FS server.
This could be a sign of a threat actor trying to use replication services on the AD FS server to get its configuration settings and extract
sensitive information such as AD FS certificates.
In order to use this query you need to enable AD FS auditing on the AD FS Server.
References: 
https://docs.microsoft.com/windows-server/identity/ad-fs/troubleshooting/ad-fs-tshoot-logging
https://twitter.com/OTR_Community/status/1387038995016732672
",Collection,T1005,P1D,P1D
X,AD FS Remote HTTP Network Connection,d57c33a9-76b9-40e0-9dfa-ff0404546410,Sentinel,Medium,Scheduled,"This detection uses Sysmon events (NetworkConnect events) to detect incoming network traffic on port 80 on AD FS servers. This could be a sign of a threat actor
trying to use replication services on the AD FS server to get its configuration settings and extract sensitive information such as AD FS certificates.
In order to use this query you need to enable Sysmon telemetry on the AD FS Server.
Reference: https://twitter.com/OTR_Community/status/1387038995016732672
",Collection,T1005,P1D,P1D
X,AD user enabled and password not set within 48 hours,62085097-d113-459f-9ea7-30216f2ee6af,Sentinel,Low,Scheduled,"Identifies when an account is enabled with a default password and the password is not set by the user within 48 hours.
Effectively, there is an event 4722 indicating an account was enabled and within 48 hours, no event 4723 occurs which
indicates there was no attempt by the user to set the password. This will show any attempts (success or fail) that occur
after 48 hours, which can indicate too long of a time period in setting the password to something that only the user knows.
It is recommended that this time period is adjusted per your internal company policy.",Persistence,T1098,P1D,P3D
X,Addition of a Temporary Access Pass to a Privileged Account,d7feb859-f03e-4e8d-8b21-617be0213b13,Sentinel,High,Scheduled,"Detects when a Temporary Access Pass (TAP) is created for a Privileged Account.
  A Temporary Access Pass is a time-limited passcode issued by an admin that satisfies strong authentication requirements and can be used to onboard other authentication methods, including Passwordless ones such as Microsoft Authenticator or even Windows Hello.
  A threat actor could use a TAP to register a new authentication method to maintain persistance to an account.
  Review any TAP creations to ensure they were used legitimately.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-accounts#changes-to-privileged-accounts",Persistence,T1078,P1D,P1D
X,ADFS Database Named Pipe Connection,dcdf9bfc-c239-4764-a9f9-3612e6dff49c,Sentinel,Medium,Scheduled,"This detection uses Sysmon telemetry to detect suspicious local connections via a named pipe to the AD FS configuration database (Windows Internal Database).
In order to use this query you need to be collecting Sysmon EventIdD 18 (Pipe Connected).
If you do not have Sysmon data in your workspace this query will raise an error stating:
Failed to resolve scalar expression named ""[@Name]",Collection,T1005,P1D,P1D
X,ADFS DKM Master Key Export,18e6a87e-9d06-4a4e-8b59-3469cd49552d,Sentinel,Medium,Scheduled,"Identifies an export of the ADFS DKM Master Key from Active Directory.
References: https://blogs.microsoft.com/on-the-issues/2020/12/13/customers-protect-nation-state-cyberattacks/, 
https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html?1
To understand further the details behind this detection, please review the details in the original PR and subequent PR update to this:
https://github.com/Azure/Azure-Sentinel/pull/1562#issue-551542469
https://github.com/Azure/Azure-Sentinel/pull/1512#issue-543053339
",Collection,T1005,P1D,P1D
X,Admin promotion after Role Management Application Permission Grant,f80d951a-eddc-4171-b9d0-d616bb83efdc,Sentinel,High,Scheduled,"This rule looks for a service principal being granted the Microsoft Graph RoleManagement.ReadWrite.Directory (application) permission before being used to add an Azure AD object or user account to an Admin directory role (i.e. Global Administrators).
This is a known attack path that is usually abused when a service principal already has the AppRoleAssignment.ReadWrite.All permission granted. This permission Allows an app to manage permission grants for application permissions to any API.
A service principal can promote itself or other service principals to admin roles (i.e. Global Administrators). This would be considered a privilege escalation technique.
Ref : https://docs.microsoft.com/graph/permissions-reference#role-management-permissions, https://docs.microsoft.com/graph/api/directoryrole-post-members?view=graph-rest-1.0&tabs=http",PrivilegeEscalation|Persistence,T1098|T1078,PT2H,PT2H
X,AdminSDHolder Modifications,52aec824-96c1-4a03-8e44-bb70532e6cea,Sentinel,High,Scheduled,"This query detects modification in the AdminSDHolder  in the Active Directory which could indicate an attempt for persistence. 
AdminSDHolder Modification is a persistence technique in which an attacker abuses the SDProp process in Active Directory to establish a persistent backdoor to Active Directory.
This query searches for the event id 5136 where the Object DN is AdminSDHolder.
Ref: https://attack.stealthbits.com/adminsdholder-modification-ad-persistence",Persistence,T1078,PT1H,PT1H
X,"Alert for  IOCs related to Windows/ELF malware - IP, Hash IOCs - September 2021",d992b87b-eb49-4a9d-aa96-baacf9d26247,Sentinel,Medium,Scheduled,"Identifies a match across various data feeds for IP,hashes and IOCs related to Windows/ELF malware published by Black Lotus Labs
Reference: 
https://blog.lumen.com/no-longer-just-theory-black-lotus-labs-uncovers-linux-executables-deployed-as-stealth-windows-loaders
https://github.com/ManuelBerrueta/YARA-rules/blob/master/BlackLotusLabs-WSLMalware/BLL_SneakyWSL.yar",Impact,T1496,PT6H,PT6H
X,Anomalous login followed by Teams action,2b701288-b428-4fb8-805e-e4372c574786,Sentinel,Medium,Scheduled,"Detects anomalous IP address usage by user accounts and then checks to see if a suspicious Teams action is performed.
Query calculates IP usage Delta for each user account and selects accounts where a delta >= 90% is observed between the most and least used IP.
To further reduce results the query performs a prevalence check on the lowest used IP's country, only keeping IP's where the country is unusual for the tenant (dynamic ranges)
Finally the user accounts activity within Teams logs is checked for suspicious commands (modifying user privileges or admin actions) during the period the suspicious IP was active.",InitialAccess|Persistence,T1199|T1136|T1078|T1098,P1D,P14D
X,Anomalous sign-in location by user account and authenticating application,7cb8f77d-c52f-4e46-b82f-3cf2e106224a,Sentinel,Medium,Scheduled,"This query over Azure Active Directory sign-in considers all user sign-ins for each Azure Active
Directory application and picks out the most anomalous change in location profile for a user within an
individual application. An alert is generated for recent sign-ins that have location counts that are anomalous
over last day but also over the last 3-day and 7-day periods.
Please note that on workspaces with larger volume of Signin data (~10M+ events a day) may timeout when using this default query time period.
It is recommended that you test and tune this appropriately for the workspace.",InitialAccess,T1078,P1D,P14D
X,Anomalous User Agent connection attempt,f845881e-2500-44dc-8ed7-b372af3e1e25,Sentinel,Low,Scheduled,Identifies connection attempts (success or fail) from clients with very short or very long User Agent strings and with less than 100 connection attempts.,InitialAccess,T1190,P1D,P1D
X,Anomolous Single Factor Signin,f7c3f5c8-71ea-49ff-b8b3-148f0e346291,Sentinel,Low,Scheduled,"Detects successful signins using single factor authentication where the device, location, and ASN are abnormal.
  Single factor authentications pose an opportunity to access compromised accounts, investigate these for anomalous occurrencess.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-devices#non-compliant-device-sign-in",InitialAccess,T1078,P1D,P7D
X,Application Gateway WAF - SQLi Detection,68c0b6bb-6bd9-4ef4-9011-08998c8ef90f,Sentinel,High,Scheduled,"Identifies a match for SQL Injection attack in the Application gateway WAF logs. The Threshold value in the query can be changed as per your infrastructure's requirement.
 References: https://owasp.org/Top10/A03_2021-Injection/",DefenseEvasion|Execution|InitialAccess|PrivilegeEscalation,T1211|T1059|T1190|T0890,PT6H,PT6H
X,Application Gateway WAF - XSS Detection,d2bc08fa-030a-4eea-931a-762d27c6a042,Sentinel,High,Scheduled,"Identifies a match for XSS attack in the Application gateway WAF logs. The Threshold value in the query can be changed as per your infrastructure's requirement.
 References: https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)",InitialAccess|Execution,T1189|T1203|T0853,PT6H,PT6H
X,Application ID URI Changed,9fb2ee72-959f-4c2b-bc38-483affc539e4,Sentinel,Medium,Scheduled,"Detects changes to an Application ID URI.
  Monitor these changes to make sure that they were authorized.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-applications#appid-uri-added-modified-or-removed",Persistence|PrivilegeEscalation,T1078,P1D,P1D
X,Application Redirect URL Update,a1080fc1-13d1-479b-8340-255f0290d96c,Sentinel,Medium,Scheduled,"Detects the redirect URL of an app being changed.
  Applications associated with URLs not controlled by the organization can pose a security risk.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-applications#application-configuration-changes",Persistence|PrivilegeEscalation,T1078,P1D,P1D
X,AppServices AV Scan Failure,c2da1106-bfe4-4a63-bf14-5ab73130ccd5,Sentinel,Informational,Scheduled,Identifies if an AV scan fails in Azure App Services.,,,P1D,P1D
X,AppServices AV Scan with Infected Files,9d0295ee-cb75-4f2c-9952-e5acfbb67036,Sentinel,Informational,Scheduled,Identifies if an AV scan finds infected files in Azure App Services.,,,P1D,P1D
X,Attempt to bypass conditional access rule in Azure AD,3af9285d-bb98-4a35-ad29-5ea39ba0c628,Sentinel,Low,Scheduled,"Identifies an attempt to Bypass conditional access rule(s) in Azure Active Directory.
The ConditionalAccessStatus column value details if there was an attempt to bypass Conditional Access
or if the Conditional access rule was not satisfied (ConditionalAccessStatus == 1).
References:
https://docs.microsoft.com/azure/active-directory/conditional-access/overview
https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-sign-ins
https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-sign-ins-error-codes
ConditionalAccessStatus == 0 // Success
ConditionalAccessStatus == 1 // Failure
ConditionalAccessStatus == 2 // Not Applied
ConditionalAccessStatus == 3 // unknown",InitialAccess|Persistence,T1078|T1098,P1D,P1D
X,Attempts to sign in to disabled accounts,75ea5c39-93e5-489b-b1e1-68fa6c9d2d04,Sentinel,Medium,Scheduled,"Identifies failed attempts to sign in to disabled accounts across multiple Azure Applications.
Default threshold for Azure Applications attempted to sign in to is 3.
References: https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-sign-ins-error-codes
50057 - User account is disabled. The account has been disabled by an administrator.",InitialAccess,T1078,P1D,P1D
X,Audit policy manipulation using auditpol utility,66276b14-32c5-4226-88e3-080dacc31ce1,Sentinel,Medium,Scheduled,"This detects attempt to manipulate audit policies using auditpol command.
This technique was seen in relation to Solorigate attack but the results can indicate potential  malicious activity used in different attacks.
The process name in each data source is commented out as an adversary could rename it. It is advisable to keep process name commented but 
if the results show unrelated false positives, users may want to uncomment it.
Refer to auditpol syntax: https://docs.microsoft.com/windows-server/administration/windows-commands/auditpol  
Refer to our M365 blog for details on use during the Solorigate attack:
https://www.microsoft.com/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/",Execution,T1204,P1D,P1D
X,Authentication Attempt from New Country,ef895ada-e8e8-4cf0-9313-b1ab67fab69f,Sentinel,Medium,Scheduled,"Detects when there is a log in attempt from a country that has not seen a successful login in the previous 14 days.
  Threat actors may attempt to authenticate with credentials from compromised accounts - monitoring attempts from anomalous locations may help identify these attempts.
  Authentication attempts should be investigated to ensure the activity was legitimate and if there is other similar activity.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-user-accounts#monitoring-for-failed-unusual-sign-ins",InitialAccess,T1078,P1D,P14D
X,Authentication Method Changed for Privileged Account,feb0a2fb-ae75-4343-8cbc-ed545f1da289,Sentinel,High,Scheduled,"Identifies authentication methods being changed for a privileged account. This could be an indicated of an attacker adding an auth method to the account so they can have continued access.
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-accounts#things-to-monitor-1",Persistence,T1098,PT2H,PT2H
X,Authentication Methods Changed for Privileged Account,694c91ee-d606-4ba9-928e-405a2dd0ff0f,Sentinel,High,Scheduled,"Identifies authentication methods being changed for a privileged account. This could be an indication of an attacker adding an auth method to the account so they can have continued access.
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-accounts#things-to-monitor-1",Persistence,T1098,PT2H,P14D
X,Authentications of Privileged Accounts Outside of Expected Controls,af435ca1-fb70-4de1-92c1-7435c48482a9,Sentinel,Medium,Scheduled,"Detects when a privileged user account successfully authenticates from a location, device or ASN that another admin has not logged in from in the last 7 days.
  Privileged accounts are a key target for threat actors, monitoring for logins from these accounts that deviate from normal activity can help identify compromised accounts.
  Authentication attempts should be investigated to ensure the activity was legitimate and if there is other similar activity.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-user-accounts#monitoring-for-successful-unusual-sign-ins",InitialAccess,T1078,P1D,P7D
X,AV detections related to Dev-0530 actors,5f171045-88ab-4634-baae-a7b6509f483b,Sentinel,High,Scheduled,"This query looks for Microsoft Defender AV detections related to  Dev-0530 actors. In Microsoft Sentinel the SecurityAlerts table includes only the Device Name of the affected device, 
 this query joins the DeviceInfo table to clearly connect other information such as Device group, ip, logged on users etc. This would allow the Microsoft Sentinel analyst to have more context related to the alert, if available.",Impact,T1486,P1D,P1D
X,AV detections related to Europium actors,186970ee-5001-41c1-8c73-3178f75ce96a,Sentinel,High,Scheduled,"This query looks for Microsoft Defender AV detections related to  Europium actor. In Microsoft Sentinel the SecurityAlerts table includes only the Device Name of the affected device, 
 this query joins the DeviceInfo table to clearly connect other information such as Device group, ip, etc. This would allow the Microsoft Sentinel analyst to have more context related to the alert, if available.
 Reference: https://www.microsoft.com/security/blog/2022/09/08/microsoft-investigates-iranian-attacks-against-the-albanian-government ",Impact,T1486,P1D,P1D
X,AV detections related to Hive Ransomware,4e5914a4-2ccd-429d-a845-fa597f0bd8c5,Sentinel,High,Scheduled,"This query looks for Microsoft Defender AV detections related to Hive Ransomware . In Microsoft Sentinel the SecurityAlerts table includes only the Device Name of the affected device,
 this query joins the DeviceInfo table to clearly connect other information such as Device group, ip, logged on users etc. This would allow the Microsoft Sentinel analyst to have more context related to the alert, if available.",Impact,T1486,P1D,P1D
X,AV detections related to SpringShell Vulnerability,3bd33158-3f0b-47e3-a50f-7c20a1b88038,Sentinel,High,Scheduled,"This query looks for Microsoft Defender AV detections related to SpringShell Vulnerability. In Microsoft Sentinel the SecurityAlerts table includes only the Device Name of the affected device, 
 this query joins the DeviceInfo table to clearly connect other information such as Device group, ip, logged on users etc. This would allow the Microsoft Sentinel analyst to have more context related to the alert, if available.
 Reference: https://www.microsoft.com/security/blog/2022/04/04/springshell-rce-vulnerability-guidance-for-protecting-against-and-detecting-cve-2022-22965/",InitialAccess,T1190,P1D,P1D
X,AV detections related to Tarrask malware,1785d372-b9fe-4283-96a6-3a1d83cabfd1,Sentinel,High,Scheduled,"This query looks for Microsoft Defender AV detections related to Tarrask malware. In Microsoft Sentinel the SecurityAlerts table 
 includes only the Device Name of the affected device, this query joins the DeviceInfo table to clearly connect other information such as Device group, ip, logged on users etc. 
 This would allow the Microsoft Sentinel analyst to have more context related to the alert, if available.
 Reference: https://www.microsoft.com/security/blog/2022/04/12/tarrask-malware-uses-scheduled-tasks-for-defense-evasion/",Persistence,T1053,P1D,P1D
X,AV detections related to Ukraine threats,b6685757-3ed1-4b05-a5bd-2cacadc86c2a,Sentinel,High,Scheduled,"This query looks for Microsoft Defender AV detections for malware observed in relation to the war in Ukraine.
  Ref: https://msrc-blog.microsoft.com/2022/02/28/analysis-resources-cyber-threat-activity-ukraine/ ",Impact,T1485,P1D,P1D
X,AV detections related to Zinc actors,3705158d-e008-49c9-92dd-e538e1549090,Sentinel,High,Scheduled,"This query looks for Microsoft Defender AV detections related to  Zinc threat actor. In Microsoft Sentinel the SecurityAlerts table includes only the Device Name of the affected device, 
 this query joins the DeviceInfo table to clearly connect other information such as Device group, ip, etc. 
 This would allow the Microsoft Sentinel analyst to have more context related to the alert, if available.
 Reference: https://www.microsoft.com/security/blog/2022/09/29/zinc-weaponizing-open-source-software/",Impact,T1486,P1D,P1D
X,AWS Guard Duty Alert,bf0cde21-0c41-48f6-a40c-6b5bd71fa106,Sentinel,Medium,Scheduled,Amazon GuardDuty is a threat detection service that continuously monitors your AWS accounts and workloads for malicious activity and delivers detailed security findings for visibility and remediation. This templates create an alert for each Amazon GuardDuty finding.,,,PT5H,PT5H
X,Azure Active Directory Hybrid Health AD FS New Server,88f453ff-7b9e-45bb-8c12-4058ca5e44ee,Sentinel,Medium,Scheduled,"This detection uses AzureActivity logs (Administrative category) to identify the creation or update of a server instance in an Azure AD Hybrid health AD FS service.
A threat actor can create a new AD Health ADFS service and create a fake server instance to spoof AD FS signing logs. There is no need to compromise an on-prem AD FS server.
This can be done programmatically via HTTP requests to Azure. More information in this blog: https://o365blog.com/post/hybridhealthagent/",DefenseEvasion,T1578,P1D,P1D
X,Azure Active Directory Hybrid Health AD FS Service Delete,86a036b2-3686-42eb-b417-909fc0867771,Sentinel,Medium,Scheduled,"This detection uses AzureActivity logs (Administrative category) to identify the deletion of an Azure AD Hybrid health AD FS service instance in a tenant.
A threat actor can create a new AD Health ADFS service and create a fake server to spoof AD FS signing logs.
The health AD FS service can then be deleted after it is not longer needed via HTTP requests to Azure.
More information in this blog https://o365blog.com/post/hybridhealthagent/",DefenseEvasion,T1578,P1D,P1D
X,Azure Active Directory Hybrid Health AD FS Suspicious Application,d9938c3b-16f9-444d-bc22-ea9a9110e0fd,Sentinel,Medium,Scheduled,"This detection uses AzureActivity logs (Administrative category) to a suspicious application adding a server instance to an Azure AD Hybrid health AD FS service or deleting the AD FS service instance.
Usually the Azure AD Connect Health Agent application with ID cf6d7e68-f018-4e0a-a7b3-126e053fb88d and ID cb1056e2-e479-49de-ae31-7812af012ed8 is used to perform those operations.",CredentialAccess|DefenseEvasion,T1528|T1550,P1D,P1D
X,Azure Active Directory PowerShell accessing non-AAD resources,50574fac-f8d1-4395-81c7-78a463ff0c52,Sentinel,Low,Scheduled,"This will alert when a user or application signs in using Azure Active Directory PowerShell to access non-Active Directory resources, such as the Azure Key Vault, which may be undesired or unauthorized behavior.
For capabilities and expected behavior of the Azure Active Directory PowerShell module, see: https://docs.microsoft.com/powershell/module/azuread/?view=azureadps-2.0.
For further information on Azure Active Directory Signin activity reports, see: https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-sign-ins.",InitialAccess,T1078,PT1H,PT1H
X,Azure AD Health Monitoring Agent Registry Keys Access,f819c592-c5f9-4d5c-a79f-1e6819863533,Sentinel,Medium,Scheduled,"This detection uses Windows security events to detect suspicious access attempts to the registry key of Azure AD Health monitoring agent.
This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object HKLM\SOFTWARE\Microsoft\Microsoft Online\Reporting\MonitoringAgent.
You can find more information in here https://github.com/OTRF/Set-AuditRule/blob/master/rules/registry/aad_connect_health_monitoring_agent.yml
",Collection,T1005,P1D,P1D
X,Azure AD Health Service Agents Registry Keys Access,06bbf969-fcbe-43fa-bac2-b2fa131d113a,Sentinel,Medium,Scheduled,"This detection uses Windows security events to detect suspicious access attempts to the registry key values and sub-keys of Azure AD Health service agents (e.g AD FS).
Information from AD Health service agents can be used to potentially abuse some of the features provided by those services in the cloud (e.g. Federation).
This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object: HKLM:\SOFTWARE\Microsoft\ADHealthAgent.
Make sure you set the SACL to propagate to its sub-keys. You can find more information in here https://github.com/OTRF/Set-AuditRule/blob/master/rules/registry/aad_connect_health_service_agent.yml
",Collection,T1005,P1D,P1D
X,Azure AD Role Management Permission Grant,1ff56009-db01-4615-8211-d4fda21da02d,Sentinel,High,Scheduled,"Identifies when the Microsoft Graph RoleManagement.ReadWrite.Directory (Delegated or Application) permission is granted to a service principal.
This permission allows an application to read and manage the role-based access control (RBAC) settings for your company's directory.
An adversary could use this permission to add an Azure AD object to an Admin directory role and escalate privileges.
Ref : https://docs.microsoft.com/graph/permissions-reference#role-management-permissions
Ref : https://docs.microsoft.com/graph/api/directoryrole-post-members?view=graph-rest-1.0&tabs=http",Persistence|Impact,T1098|T1078,PT2H,PT2H
X,Azure DevOps Administrator Group Monitoring,89e6adbd-612c-4fbe-bc3d-32f81baf3b6c,Sentinel,Medium,Scheduled,This detection monitors for additions to projects or project collection administration groups in an Azure DevOps Organization.,Persistence,T1098,PT4H,PT4H
X,Azure DevOps Agent Pool Created Then Deleted,acfdee3f-b794-404a-aeba-ef6a1fa08ad1,Sentinel,High,Scheduled,"As well as adding build agents to an existing pool to execute malicious activity within a pipeline, an attacker could create a complete new agent pool and use this for execution.
Azure DevOps allows for the creation of agent pools with Azure hosted infrastructure or self-hosted infrastructure. Given the additional customizability of self-hosted agents this 
detection focuses on the creation of new self-hosted pools. To further reduce false positive rates the detection looks for pools created and deleted relatively quickly (within 7 days by default), 
as an attacker is likely to remove a malicious pool once used in order to reduce/remove evidence of their activity.",DefenseEvasion,T1578,P7D,P14D
X,Azure DevOps Audit Stream Disabled,4e8238bd-ff4f-4126-a9f6-09b3b6801b3d,Sentinel,High,Scheduled,"Azure DevOps allow for audit logs to be streamed to external storage solutions such as SIEM solutions. An attacker looking to hide malicious Azure DevOps activity from defenders may look to disable data streams 
before conducting activity and then re-enabling the stream after (so as not to raise data threshold-based alarms). Looking for disabled audit streams can identify this activity, and due to the nature of the action 
its unlikely to have a high false positive rate.",DefenseEvasion,T1562,P1D,P1D
X,Azure DevOps Build Variable Modified by New User.,3b9a44d7-c651-45ed-816c-eae583a6f2f1,Sentinel,Medium,Scheduled,"Variables can be configured and used at any stage of the build process in Azure DevOps to inject values. An attacker with the required permissions could modify 
or add to these variables to conduct malicious activity such as changing paths or remote endpoints called during the build. As variables are often changed by users, 
just detecting these changes would have a high false positive rate. This detection looks for modifications to variable groups where that user has not been observed 
modifying them before.",DefenseEvasion,T1578,P1D,P14D
X,Azure DevOps New Extension Added,bf07ca9c-e408-443a-8939-6860a45a929e,Sentinel,Low,Scheduled,"Extensions add additional features to Azure DevOps. An attacker could use a malicious extension to conduct malicious activity. 
This query looks for new extensions that are not from a configurable list of approved publishers.",Persistence,T1505,P1D,P1D
X,Azure DevOps PAT used with Browser.,5f0d80db-3415-4265-9d52-8466b7372e3a,Sentinel,Medium,Scheduled,"Personal Access Tokens (PATs) are used as an alternate password to authenticate into Azure DevOps. PATs are intended for programmatic access use in code or applications. 
This can be prone to attacker theft if not adequately secured. This query looks for the use of a PAT in authentication but from a User Agent indicating a browser. 
This should not be normal activity and could be an indicator of an attacker using a stolen PAT.",CredentialAccess,,P1D,P1D
X,Azure DevOps Personal Access Token (PAT) misuse,ac891683-53c3-4f86-86b4-c361708e2b2b,Sentinel,High,Scheduled,"This Alert detects whenever a PAT is used in ways that PATs are not normally used. May require an allow list and baselining.
Reference - https://docs.microsoft.com/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops&tabs=preview-page
Use this query for baselining:
AzureDevOpsAuditing
| distinct OperationName",Execution|Impact,T1496|T1559,PT1H,PT1H
X,Azure DevOps Pipeline Created and Deleted on the Same Day,17f23fbe-bb73-4324-8ecf-a18545a5dc26,Sentinel,Medium,Scheduled,"An attacker with access to Azure DevOps could create a pipeline to inject artifacts used by other pipelines, 
or to create a malicious software build that looks legitimate by using a pipeline that incorporates legitimate elements. 
An attacker would also likely want to cover their tracks once conducting such activity. This query looks for Pipelines 
created and deleted within the same day, this is unlikely to be legitimate user activity in the majority of cases.",Execution,T1072,P3D,P3D
X,Azure DevOps Pipeline modified by a new user.,155e9134-d5ad-4a6f-88f3-99c220040b66,Sentinel,Medium,Scheduled,"There are several potential pipeline steps that could be modified by an attacker to inject malicious code into the build cycle. A likely attacker path is the modification to an existing pipeline that they have access to. 
This detection looks for users modifying a pipeline when they have not previously been observed modifying or creating that pipeline before. This query also joins events with data to Azure AD Identity Protection (AAD IdP) 
in order to show if the user conducting the action has any associated AAD IdP alerts. You can also choose to filter this detection to only alert when the user also has AAD IdP alerts associated with them.",Execution|DefenseEvasion,T1578|T1569,P1D,P14D
X,Azure DevOps Pull Request Policy Bypassing - Historic allow list,4d8de9e6-263e-4845-8618-cd23a4f58b70,Sentinel,Medium,Scheduled,"This detection builds an allow list of historic PR policy bypasses and compares to recent history, flagging pull request bypasses that are not manually in the allow list and not historically included in the allow list.",Persistence,T1098,PT3H,P14D
X,Azure DevOps Retention Reduced,71d374e0-1cf8-4e50-aecd-ab6c519795c2,Sentinel,Low,Scheduled,"AzureDevOps retains items such as run records and produced artifacts for a configurable amount of time. An attacker looking to reduce the footprint left by their malicious activity may look to reduce the retention time for artifacts and runs.
This query will look for where retention has been reduced to the minimum level - 1, or reduced by more than half.",DefenseEvasion,T1564,P1D,P1D
X,Azure DevOps Service Connection Abuse,d564ff12-8f53-41b8-8649-44f76b37b99f,Sentinel,Medium,Scheduled,"Flags builds/releases that use a large number of service connections if they aren't manually in the allow list.
This is to determine if someone is hijacking a build/release and adding many service connections in order to abuse
or dump credentials from service connections.",Persistence|Impact,T1098|T1496,P1D,P14D
X,Azure DevOps Service Connection Addition/Abuse - Historic allow list,5efb0cfd-063d-417a-803b-562eae5b0301,Sentinel,Medium,Scheduled,"This detection builds an allow list of historic service connection use by Builds and Releases and compares to recent history, flagging growth of service connection use which are not manually included in the allow list and
not historically included in the allow list Build/Release runs.  This is to determine if someone is hijacking a build/release and adding many service connections in order to abuse or dump credentials from service connections.",Persistence|Impact,T1098|T1496,PT6H,P14D
X,Azure DevOps Variable Secret Not Secured,4ca74dc0-8352-4ac5-893c-73571cc78331,Sentinel,Medium,Scheduled,"Credentials used in the build process may be stored as Azure DevOps variables. To secure these variables they should be stored in KeyVault or marked as Secrets. 
This detection looks for new variables added with names that suggest they are credentials but where they are not set as Secrets or stored in KeyVault.",CredentialAccess,T1552,P1D,P1D
X,Azure Diagnostic settings removed from a resource,6e95aef3-a1e0-4063-8e74-cd59aa59f245,Sentinel,Medium,Scheduled,"This query looks for diagnostic settings that are removed from a resource.
This could indicate an attacker or malicious internal trying to evade detection before malicious act is performed.
If the diagnostic settings are being deleted as part of a parent resource deletion, the event is ignores.",DefenseEvasion,T1562,PT1H,PT2H
X,Azure Key Vault access TimeSeries anomaly,0914adab-90b5-47a3-a79f-7cdcac843aa7,Sentinel,Low,Scheduled,"Indentifies a sudden increase in count of Azure Key Vault secret or vault access operations by CallerIPAddress. The query leverages a built-in KQL anomaly detection algorithm
to find large deviations from baseline Azure Key Vault access patterns. Any sudden increase in the count of Azure Key Vault accesses can be an
indication of adversary dumping credentials via automated methods. If you are seeing any noise, try filtering known source(IP/Account) and user-agent combinations.
TimeSeries Reference Blog: https://techcommunity.microsoft.com/t5/azure-sentinel/looking-for-unknown-anomalies-what-is-normal-time-series/ba-p/555052",CredentialAccess,T1003,P1D,P14D
X,Azure Portal Signin from another Azure Tenant,87210ca1-49a4-4a7d-bb4a-4988752f978c,Sentinel,Medium,Scheduled,"This query looks for sign in attempts to the Azure Portal where the user who is signing in from another Azure tenant,
 and the IP address the login attempt is from is an Azure IP. A threat actor who compromises an Azure tenant may look
 to pivot to other tenants leveraging cross-tenant delegated access in this manner.",InitialAccess,T1199,PT1H,PT1H
X,Azure VM Run Command operation executed during suspicious login window,11bda520-a965-4654-9a45-d09f372f71aa,Sentinel,High,Scheduled,"Identifies when the Azure Run Command operation is executed by a UserPrincipalName and IP Address  
that has resulted in a recent user entity behaviour alert.",LateralMovement|CredentialAccess,T1570|T1212,P1D,P2D
X,Azure VM Run Command operations executing a unique PowerShell script,5239248b-abfb-4c6a-8177-b104ade5db56,Sentinel,Medium,Scheduled,"Identifies when Azure Run command is used to execute a PowerShell script on a VM that is unique.
The uniqueness of the PowerShell script is determined by taking a combined hash of the cmdLets it imports
and the file size of the PowerShell script. Alerts from this detection indicate a unique PowerShell was executed
in your environment.",LateralMovement|Execution,T1570|T1059,P1D,P1D
X,Azure WAF matching for Log4j vuln(CVE-2021-44228),2de8abd6-a613-450e-95ed-08e503369fb3,Sentinel,High,Scheduled,"This query will alert on a positive pattern match by Azure WAF for CVE-2021-44228 log4j vulnerability exploitation attempt. If possible, it then decodes the malicious command for further analysis.
 Refrence: https://www.microsoft.com/security/blog/2021/12/11/guidance-for-preventing-detecting-and-hunting-for-cve-2021-44228-log4j-2-exploitation/",InitialAccess,T1190,PT6H,PT6H
X,Azure WAF matching for Log4j vuln(CVE-2021-44228),System.Object[],Solution,High,Scheduled,"This query will alert on a positive pattern match by Azure WAF for CVE-2021-44228 log4j vulnerability exploitation attempt. If possible, it then decodes the malicious command for further analysis.
 Refrence: https://www.microsoft.com/security/blog/2021/12/11/guidance-for-preventing-detecting-and-hunting-for-cve-2021-44228-log4j-2-exploitation/",InitialAccess,,PT6H,PT6H
X,Base64 encoded Windows process command-lines,ca67c83e-7fff-4127-a3e3-1af66d6d4cad,Sentinel,Medium,Scheduled,Identifies instances of a base64 encoded PE file header seen in the process command line parameter.,Execution|DefenseEvasion,T1059|T1027|T1140,P1D,P1D
X,Base64 encoded Windows process command-lines (Normalized Process Events),f8b3c49c-4087-499b-920f-0dcfaff0cbca,Sentinel,Medium,Scheduled,"Identifies instances of a base64 encoded PE file header seen in the process command line parameter.
To use this analytics rule, make sure you have deployed the [ASIM normalization parsers](https://aka.ms/ASimProcessEvent)",Execution|DefenseEvasion,T1059|T1027|T1140,P1D,P1D
X,Brute force attack against a Cloud PC,3fbc20a4-04c4-464e-8fcb-6667f53e4987,Sentinel,Medium,Scheduled,Identifies evidence of brute force activity against a Windows 365 Cloud PC by highlighting multiple authentication failures and by a successful authentication within a given time window.,CredentialAccess,T1110,P1D,P1D
X,Brute force attack against Azure Portal,28b42356-45af-40a6-a0b4-a554cdfd5d8a,Sentinel,Medium,Scheduled,"Identifies evidence of brute force activity against Azure Portal by highlighting multiple authentication failures 
and by a successful authentication within a given time window. 
Default Failure count is 10 and default Time Window is 20 minutes.
References: https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-sign-ins-error-codes.",CredentialAccess,T1110,P1D,P1D
X,Brute Force Attack against GitHub Account,97ad74c4-fdd9-4a3f-b6bf-5e28f4f71e06,Sentinel,Medium,Scheduled,"Attackers who are trying to guess your users' passwords or use brute-force methods to get in. If your organization is using SSO with Azure Active Directory, authentication logs to GitHub.com will be generated. Using the following query can help you identify a sudden increase in failed logon attempt of users.",CredentialAccess,T1110,P1D,P1D
X,Brute force attack against user credentials (Uses Authentication Normalization),a6c435a2-b1a0-466d-b730-9f8af69262e8,Sentinel,Medium,Scheduled,"Identifies evidence of brute force activity against a user based on multiple authentication failures 
and at least one successful authentication within a given time window. Note that the query does not enforce any sequence,
and does not require the successful authentication to occur last.
The default failure threshold is 10, success threshold is 1, and the default time window is 20 minutes.
To use this analytics rule, make sure you have deployed the [ASIM normalization parsers](https://aka.ms/ASimAuthentication)",CredentialAccess,T1110,PT20M,PT20M
X,Bulk Changes to Privileged Account Permissions,218f60de-c269-457a-b882-9966632b9dc6,Sentinel,High,Scheduled,"Identifies when changes to multiple users permissions are changed at once. Investigate immediately if not a planned change. This setting could enable an attacker access to Azure subscriptions in your environment.
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-identity-management",PrivilegeEscalation,T1078,PT2H,PT2H
X,Changes made to AWS CloudTrail logs,610d3850-c26f-4f20-8d86-f10fdf2425f5,Sentinel,Low,Scheduled,"Attackers often try to hide their steps by deleting or stopping the collection of logs that could show their activity.
This alert identifies any manipulation of AWS CloudTrail, Cloudwatch/EventBridge or VPC Flow logs.
More Information: AWS CloudTrail API: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_Operations.html
AWS Cloudwatch/Eventbridge API: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_Operations.html
AWS DelteteFlowLogs API : https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html ",DefenseEvasion,,P1D,P1D
X,Changes to Amazon VPC settings,65360bb0-8986-4ade-a89d-af3cf44d28aa,Sentinel,Low,Scheduled,"Amazon Virtual Private Cloud (Amazon VPC) lets you provision a logically isolated section of the AWS Cloud where you can launch AWS resources
in a virtual network that you define.
This identifies changes to Amazon VPC (Virtual Private Cloud) settings such as new ACL entries,routes, routetable or Gateways.
More information: https://medium.com/@GorillaStack/the-most-important-aws-cloudtrail-security-events-to-track-a5b9873f8255
and AWS VPC API Docs: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/OperationList-query-vpc.html",PrivilegeEscalation|LateralMovement,T1078|T1563,P1D,P1D
X,Changes to Application Logout URL,492fbe35-cbac-4a8c-9059-826782e6915a,Sentinel,Low,Scheduled,"Detects changes to an applications sign out URL.
  Look for any modifications to a sign out URL. Blank entries or entries to non-existent locations would stop a user from terminating a session.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-applications#logout-url-modified-or-removed",Persistence|PrivilegeEscalation,T1078,P1D,P1D
X,Changes to Application Ownership,cc5780ce-3245-4bba-8bc1-e9048c2257ce,Sentinel,Medium,Scheduled,"Detects changes to the ownership of an appplicaiton.
  Monitor these changes to make sure that they were authorized.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-applications#new-owner",Persistence|PrivilegeEscalation,T1078,P1D,P1D
X,Changes to AWS Elastic Load Balancer security groups,c7bfadd4-34a6-4fa5-82f8-3691a32261e8,Sentinel,Low,Scheduled,"Elastic Load Balancer distributes incoming traffic across multiple instances in multiple availability Zones. This increases the fault tolerance of your applications.
 Unwanted changes to Elastic Load Balancer specific security groups could open your environment to attack and  hence needs monitoring.
 More information: https://medium.com/@GorillaStack/the-most-important-aws-cloudtrail-security-events-to-track-a5b9873f8255
 and https://aws.amazon.com/elasticloadbalancing/.",Persistence,T1098,P1D,P1D
X,Changes to AWS Security Group ingress and egress settings,4f19d4e3-ec5f-4abc-9e61-819eb131758c,Sentinel,Low,Scheduled,"A Security Group acts as a virtual firewall of an instance to control inbound and outbound traffic.
 Hence, ingress and egress settings changes to AWS Security Group should be monitored as these can expose the enviornment to new attack vectors.
More information: https://medium.com/@GorillaStack/the-most-important-aws-cloudtrail-security-events-to-track-a5b9873f8255.",Persistence,T1098,P1D,P1D
X,Changes to internet facing AWS RDS Database instances,8c2ef238-67a0-497d-b1dd-5c8a0f533e25,Sentinel,Low,Scheduled,"Amazon Relational Database Service (RDS) is scalable relational database in the cloud.
If your organization have one or more AWS RDS Databases running, monitoring changes to especially internet facing AWS RDS (Relational Database Service)
Once alerts triggered, validate if changes observed are authorized and adhere to change control policy.
More information: https://medium.com/@GorillaStack/the-most-important-aws-cloudtrail-security-events-to-track-a5b9873f8255
and RDS API Reference Docs: https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_Operations.html",Persistence,T1098,P1D,P1D
X,Changes to PIM Settings,0ed0fe7c-af29-4990-af7f-bb5ccb231198,Sentinel,High,Scheduled,"PIM provides a key mechanism for assigning privileges to accounts, this query detects changes to PIM role settings.
  Monitor these changes to ensure they are being made legitimately and don't confer more privileges than expected or reduce the security of a PIM elevation.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-accounts#changes-to-privileged-accounts",PrivilegeEscalation,T1078,P1D,P1D
X,"Chia_Crypto_Mining - Domain, Process, Hash and IP IOCs - June 2021",595a10c9-91be-4abb-bbc7-ae9c57848bef,Sentinel,Low,Scheduled,"Identifies a match across various data feeds for domains, process, hashes and IP IOC related to Chia cryptocurrency farming/plotting activity.",Impact,T1496,PT6H,PT6H
,Chia_Crypto_Mining IOC - June 2021,4d173248-439b-4741-8b37-f63ad0c896ae,Sentinel,Low,Scheduled,Identifies a match across IOC's related to Chia cryptocurrency farming/plotting activity,Impact,T1496,PT6H,PT6H
,Cisco - firewall block but success logon to Azure AD,157c0cfc-d76d-463b-8755-c781608cdc1a,Sentinel,Medium,Scheduled,"Correlate IPs blocked by a Cisco firewall appliance with successful Azure Active Directory signins.
Because the IP was blocked by the firewall, that same IP logging on successfully to AAD is potentially suspect
and could indicate credential compromise for the user account.",InitialAccess,T1078,P1D,P1D
,Cisco ASA - average attack detection rate increase,79f29feb-6a9d-4cdf-baaa-2daf480a5da1,Sentinel,Low,Scheduled,"This will help you determine if Cisco ASA devices are under heavier attack than normal over the last hour versus the previous 6 hours based on DeviceEventClassID 733100
References: https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs9.html
Details on how to further troubleshoot/investigate: https://www.cisco.com/c/en/us/support/docs/security/asa-5500-x-series-next-generation-firewalls/113685-asa-threat-detection.html",Discovery|Impact,T1046|T1498,PT1H,PT6H
,Cisco ASA - threat detection message fired,795edf2d-cf3e-45b5-8452-fe6c9e6a582e,Sentinel,Medium,Scheduled,"Identifies when the Cisco ASA Threat Detection engine fired an alert based on malicious activity occurring on the network inicated by DeviceEventClassID 733101-733105
Resources: https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs9.html
Details on how to further troubleshoot/investigate: https://www.cisco.com/c/en/us/support/docs/security/asa-5500-x-series-next-generation-firewalls/113685-asa-threat-detection.html",Discovery|Impact,T1046|T1498,PT1H,PT1H
,Cisco Umbrella - Connection to non-corporate private network,c9b6d281-b96b-4763-b728-9a04b9fe1246,Sentinel,Medium,Scheduled,"IP addresses of broadband links that usually indicates users attempting to access their home network, for example for a remote session to a home computer.",CommandAndControl|Exfiltration,,PT10M,PT10M
,Cisco Umbrella - Connection to Unpopular Website Detected,75297f62-10a8-4fc1-9b2a-12f25c6f05a7,Sentinel,Medium,Scheduled,Detects first connection to an unpopular website (possible malicious payload delivery).,CommandAndControl,,P1D,P14D
,Cisco Umbrella - Crypto Miner User-Agent Detected,b619d1f1-7f39-4c7e-bf9e-afbb46457997,Sentinel,Medium,Scheduled,Detects suspicious user agent strings used by crypto miners in proxy logs.,CommandAndControl,,PT15M,PT15M
,Cisco Umbrella - Empty User Agent Detected,2b328487-162d-4034-b472-59f1d53684a1,Sentinel,Medium,Scheduled,Rule helps to detect empty and unusual user agent indicating web browsing activity by an unusual process other than a web browser.,CommandAndControl,,PT15M,PT15M
,Cisco Umbrella - Hack Tool User-Agent Detected,8d537f3c-094f-430c-a588-8a87da36ee3a,Sentinel,Medium,Scheduled,Detects suspicious user agent strings used by known hack tools,CommandAndControl,,PT15M,PT15M
,Cisco Umbrella - Rare User Agent Detected,8c8de3fa-6425-4623-9cd9-45de1dd0569a,Sentinel,Medium,Scheduled,Rule helps to detect a rare user-agents indicating web browsing activity by an unusual process other than a web browser.,CommandAndControl,,P1D,P14D
,Cisco Umbrella - Request Allowed to harmful/malicious URI category,d6bf1931-b1eb-448d-90b2-de118559c7ce,Sentinel,Medium,Scheduled,It is reccomended that these Categories shoud be blocked by policies because they provide harmful/malicious content..,CommandAndControl|InitialAccess,,PT10M,PT10M
,Cisco Umbrella - Request to blocklisted file type,de58ee9e-b229-4252-8537-41a4c2f4045e,Sentinel,Medium,Scheduled,"Detects request to potentially harmful file types (.ps1, .bat, .vbs, etc.).",InitialAccess,,PT10M,PT10M
,Cisco Umbrella - URI contains IP address,ee1818ec-5f65-4991-b711-bcf2ab7e36c3,Sentinel,Medium,Scheduled,Malware can use IP address to communicate with C2.,CommandAndControl,,PT10M,PT10M
,Cisco Umbrella - Windows PowerShell User-Agent Detected,b12b3dab-d973-45af-b07e-e29bb34d8db9,Sentinel,Medium,Scheduled,Rule helps to detect Powershell user-agent activity by an unusual process other than a web browser.,CommandAndControl|DefenseEvasion,,PT15M,PT15M
,COM Event System Loading New DLL,02f6c2e5-219d-4426-a0bf-ad67abc63d53,Sentinel,Medium,Scheduled,This query uses Sysmon Image Load (Event ID 7) and Process Create (Event ID 1) data to look for COM Event System being used to load a newly seen DLL.,PrivilegeEscalation,T1543,P1D,P1D
,COM Registry Key Modified to Point to File in Color Profile Folder,ed8c9153-6f7a-4602-97b4-48c336b299e1,Sentinel,Medium,Scheduled,"This query looks for changes to COM registry keys to point to files in C:\Windows\System32\spool\drivers\color\.
  This can be used to enable COM hijacking for persistence.
  Ref: https://www.microsoft.com/security/blog/2022/07/27/untangling-knotweed-european-private-sector-offensive-actor-using-0-day-exploits/",Persistence,T1574,P1D,P1D
,Conditional Access Policy Modified by New User,25a7f951-54b7-4cf5-9862-ebc04306c590,Sentinel,Medium,Scheduled,"Detects a Conditional Access Policy being modified by a user who has not modified a policy in the last 14 days.
  A threat actor may try to modify policies to weaken the security controls in place.
  Investigate any change to ensure they are approved.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-infrastructure#conditional-access",DefenseEvasion,T1078,P1D,P14D
,CoreBackUp Deletion in correlation with other related security alerts,011c84d8-85f0-4370-b864-24c13455aa94,Sentinel,Medium,Scheduled,"This query will help detect attackers attempt to delete backup containers in correlation with other alerts that could have triggered to help possibly reveal more details of attacker activity. 
Though such an activity could be legitimate as part of business operation, some ransomware actors may perform such operation to cause interruption to regular business services.",Impact,T1496,P1D,P1D
,Correlate Unfamiliar sign-in properties and atypical travel alerts,a3df4a32-4805-4c6d-8699-f3c888af2f67,Sentinel,High,Scheduled,The combination of an Unfamiliar sign-in properties alert and an Atypical travel alert about the same user within a +10m or -10m window is considered a high severity incident.,InitialAccess,T1078,P1D,P14D
,Creation of expensive computes in Azure,9736e5f1-7b6e-4bfb-a708-e53ff1d182c3,Sentinel,Low,Scheduled,"Identifies the creation of large size/expensive VMs (GPU or with large no of virtual CPUs) in Azure.
Adversary may create new or update existing virtual machines sizes to evade defenses 
or use it for cryptomining purposes.
For Windows/Linux Vm Sizes - https://docs.microsoft.com/azure/virtual-machines/windows/sizes 
Azure VM Naming Conventions - https://docs.microsoft.com/azure/virtual-machines/vm-naming-conventions",DefenseEvasion,T1578,P1D,P1D
,Credential added after admin consented to Application,707494a5-8e44-486b-90f8-155d1797a8eb,Sentinel,Medium,Scheduled,"This query will identify instances where Service Principal credentials were added to an application by one user after the application was granted admin consent rights by another user.
 If a threat actor obtains access to an account with sufficient privileges and adds the alternate authentication material triggering this event, the threat actor can now authenticate as the Application or Service Principal using this credential.
 Additional information on OAuth Credential Grants can be found in RFC 6749 Section 4.4 or https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow.
 For further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities",CredentialAccess,,P1D,P2D
,Credential Dumping Tools - File Artifacts,32ffb19e-8ed8-40ed-87a0-1adb4746b7c4,Sentinel,High,Scheduled,"This query detects the creation of credential dumping tools files. Several credential dumping tools export files with hardcoded file names.
Ref: https://jpcertcc.github.io/ToolAnalysisResultSheet/",CredentialAccess,T1003,PT1H,PT1H
,Credential Dumping Tools - Service Installation,4ebbb5c2-8802-11ec-a8a3-0242ac120002,Sentinel,High,Scheduled,"This query detects the installation of a Windows service that contains artifacts from credential dumping tools such as Mimikatz.
Ref: https://blueteamblog.com/darkside-ransomware-operations-preventions-and-detections",CredentialAccess,T1003,PT1H,PT1H
,CreepyDrive request URL sequence,eda260eb-f4a1-4379-ad98-452604da9b3e,Sentinel,High,Scheduled,"CreepyDrive uses OneDrive for command and control, however, it makes regular requests to predicatable paths.
This detecton will alert when over 20 sequences are observed in a single day.",Exfiltration|CommandAndControl,T1567|T1102,P1D,P1D
,CreepyDrive URLs,b6d03b88-4d27-49a2-9c1c-29f1ad2842dc,Sentinel,High,Scheduled,CreepyDrive uses OneDrive for command and control. This detection identifies URLs specific to CreepyDrive.,Exfiltration|CommandAndControl,T1567|T1102,P1D,P1D
,Cross-tenant Access Settings Organization Added,757e6a79-6d23-4ae6-9845-4dac170656b5,Sentinel,Medium,Scheduled,Organizations are added in the Cross-tenant Access Settings to control communication inbound or outbound for users and applications. This detection notifies when an Organization is added other than the list that is supposed to exist from the Azure AD Cross-tenant Access Settings.,InitialAccess|Persistence|Discovery,T1078|T1136|T1087,P2D,P2D
,Cross-tenant Access Settings Organization Deleted,eb8a9c1c-f532-4630-817c-1ecd8a60ed80,Sentinel,Medium,Scheduled,Organizations are added in the Cross-tenant Access Settings to control communication inbound or outbound for users and applications. This detection notifies when an Organization is deleted from the Azure AD Cross-tenant Access Settings.,InitialAccess|Persistence|Discovery,T1078|T1136|T1087,P2D,P2D
,Cross-tenant Access Settings Organization Inbound Collaboration Settings Changed,c895c5b9-0fc6-40ce-9830-e8818862f2d5,Sentinel,Medium,Scheduled,"Organizations are added in the Cross-tenant Access Settings to control communication inbound or outbound for users and applications. This detection notifies when Organization Inbound Collaboration Settings are changed for ""Users & Groups"" and for ""Applications"".",InitialAccess|Persistence|Discovery,T1078|T1136|T1087,P2D,P2D
,Cross-tenant Access Settings Organization Inbound Direct Settings Changed,276d5190-38de-4eb2-9933-b3b72f4a5737,Sentinel,Medium,Scheduled,"Organizations are added in the Cross-tenant Access Settings to control communication inbound or outbound for users and applications. This detection notifies when Organization Inbound Direct Settings are changed for ""Users & Groups"" and for ""Applications"".",InitialAccess|Persistence|Discovery,T1078|T1136|T1087,P2D,P2D
,Cross-tenant Access Settings Organization Outbound Collaboration Settings Changed,229f71ba-d83b-42a5-b83b-11a641049ed1,Sentinel,Medium,Scheduled,"Organizations are added in the Cross-tenant Access Settings to control communication inbound or outbound for users and applications. This detection notifies when Organization Outbound Collaboration Settings are changed for ""Users & Groups"" and for ""Applications"".",InitialAccess|Persistence|Discovery,T1078|T1136|T1087,P2D,P2D
,Cross-tenant Access Settings Organization Outbound Direct Settings Changed,0101e08d-99cd-4a97-a9e0-27649c4369ad,Sentinel,Medium,Scheduled,"Organizations are added in the Cross-tenant Access Settings to control communication inbound or outbound for users and applications. This detection notifies when Organization Outbound Direct Settings are changed for ""Users & Groups"" and for ""Applications"".",InitialAccess|Persistence|Discovery,T1078|T1136|T1087,P2D,P2D
,Detect PIM Alert Disabling activity,1f3b4dfd-21ff-4ed3-8e27-afc219e05c50,Sentinel,Medium,Scheduled,"Privileged Identity Management (PIM) generates alerts when there is suspicious or unsafe activity in Azure Active Directory (Azure AD) organization. 
This query will help detect attackers attempts to disable in product PIM alerts which are associated with Azure MFA requirements and could indicate activation of privileged access",Persistence|PrivilegeEscalation,T1098|T1078,P1D,P1D
,Detecting Impossible travel with mailbox permission tampering & Privilege Escalation attempt,1399664f-9434-497c-9cde-42e4d74ae20e,Sentinel,Medium,Scheduled,"This hunting query will alert on any Impossible travel activity in correlation with mailbox permission tampering followed by account being added to a PIM managed privileged group.
Ensure this impossible travel incident with increase of privileges is legitimate in your environment.",InitialAccess|PrivilegeEscalation,T1078|T1548,P1D,P1D
,Detecting Macro Invoking ShellBrowserWindow COM Objects,e7470b35-0128-4508-bfc9-e01cfb3c2eb7,Sentinel,Medium,Scheduled,"This query detects a macro invoking ShellBrowserWindow COM Objects evade naive parent/child Office detection rules.
Ref: https://blog.menasec.net/2019/02/threat-hunting-doc-with-macro-invoking.html",LateralMovement,T1021,PT1H,PT1H
,Dev-0228 File Path Hashes November 2021,3b443f22-9be9-4c35-ac70-a94757748439,Sentinel,High,Scheduled,"This hunting query looks for file paths/hashes related to observed activity by Dev-0228. The actor is known to use custom version of popular tool like PsExec, Procdump etc. to carry its activity.
 The risk score associated with each result is based on a number of factors, hosts with higher risk events should be investigated first.",CredentialAccess|Execution,T1569|T1003,PT6H,PT6H
,Dev-0228 File Path Hashes November 2021 (ASIM Version),29a29e5d-354e-4f5e-8321-8b39d25047bf,Sentinel,High,Scheduled,"This hunting query looks for file paths/hashes related to observed activity by Dev-0228. The actor is known to use custom version of popular tool like PsExec, Procdump etc. to carry its activity.
 The risk score associated with each result is based on a number of factors, hosts with higher risk events should be investigated first.
 This query uses the Microsoft Sentinel Information Model - https://docs.microsoft.com/azure/sentinel/normalization",CredentialAccess|Execution,T1569|T1003,PT6H,PT6H
,Dev-0270 Malicious Powershell usage,422ca2bf-598b-4872-82bb-5f7e8fa731e7,Sentinel,High,Scheduled,"DEV-0270 heavily uses powershell to achieve their objective at various stages of their attack. To locate powershell related activity tied to the actor, Microsoft Sentinel customers can run the following query.",Exfiltration|DefenseEvasion,T1048|T1562,PT6H,PT6H
,DEV-0270 New User Creation,7965f0be-c039-4d18-8ee8-9a6add8aecf3,Sentinel,High,Scheduled,The following query tries to detect creation of a new user using a known DEV-0270 username/password schema,Persistence,T1098,PT6H,PT6H
,Dev-0270 Registry IOC - September 2022,2566e99f-ad0f-472a-b9ac-d3899c9283e6,Sentinel,High,Scheduled,The query below identifies modification of registry by Dev-0270 actor to disable security feature as well as to add ransom notes,Impact,T1486,PT6H,PT6H
,Dev-0270 WMIC  Discovery,6b652b4f-9810-4eec-9027-7aa88ce4db23,Sentinel,High,Scheduled,The query below identifies dllhost.exe using WMIC to discover additional hosts and associated domains in the environment.,Discovery,T1482,PT6H,PT6H
,DEV-0322 Serv-U related IOCs - July 2021,4759ddb4-2daf-43cb-b34e-d85b85b4e4a5,Sentinel,High,Scheduled,Identifies a match across IOC's related to DEV-0322 targeting SolarWinds Serv-U software.,InitialAccess,T1190,PT6H,PT6H
,Dev-0530 File Extension Rename,d82eb796-d1eb-43c8-a813-325ce3417cef,Sentinel,High,Scheduled,Dev-0530 actors are known to encrypt the contents of the victims device as well as renaming the file extensions. This query looks for the creation of files with .h0lyenc extension or presence of ransom note.,Impact,T1486,P1D,P1D
,Dev-0530 IOC - July 2022,a172107d-794c-48c0-bc26-d3349fe10b4d,Sentinel,High,Scheduled,Identifies a IOC match related to Dev-0530 actor across various data sources.,Impact,T1486,PT12H,PT12H
,DEV-0586 Actor IOC - January 2022,961b6a81-5c53-40b6-9800-4f661a8faea7,Sentinel,High,Scheduled,"Identifies a match across IOC's related to an actor tracked by Microsoft as DEV-0586
 Reference: https://www.microsoft.com/security/blog/2022/01/15/destructive-malware-targeting-ukrainian-organizations/",Impact,T1561,PT6H,PT6H
,Discord CDN Risky File Download  (ASIM Web Session Schema),01e8ffff-dc0c-43fe-aa22-d459c4204553,Sentinel,Medium,Scheduled,"Identifies callouts to Discord CDN addresses for risky file extensions. This detection will trigger when a callout for a risky file is made to a discord server that has only been seen once in your environment. Unique discord servers are identified using the server ID that is included in the request URL (DiscordServerId in query). Discord CDN has been used in multiple campaigns to download additional payloads.
 This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM WebSession schema (ASIM WebSession Schema)",CommandAndControl,T1071,P1D,P1D
,Distributed Password cracking attempts in AzureAD,bfb1c90f-8006-4325-98be-c7fffbc254d6,Sentinel,Medium,Scheduled,"Identifies distributed password cracking attempts from the Azure Active Directory SigninLogs.
The query looks for unusually high number of failed password attempts coming from multiple locations for a user account.
References: https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-sign-ins-error-codes
50053   Account is locked because the user tried to sign in too many times with an incorrect user ID or password.
50055   Invalid password, entered expired password.
50056   Invalid or null password - Password does not exist in store for this user.
50126   Invalid username or password, or invalid on-premises username or password.",CredentialAccess,T1110,P1D,P1D
,DNS events related to mining pools,0d76e9cf-788d-4a69-ac7d-f234826b5bed,Sentinel,Low,Scheduled,Identifies IP addresses that may be performing DNS lookups associated with common currency mining pools.,Impact,T1496,P1D,P1D
,DNS events related to mining pools (ASIM DNS Schema),c094384d-7ea7-4091-83be-18706ecca981,Sentinel,Low,Scheduled,"Identifies IP addresses that may be performing DNS lookups associated with common currency mining pools.
This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM DNS schema",Impact,T1496,P1D,P1D
,DNS events related to ToR proxies,a83ef0f4-dace-4767-bce3-ebd32599d2a0,Sentinel,Low,Scheduled,Identifies IP addresses performing DNS lookups associated with common ToR proxies.,Exfiltration,T1048,P1D,P1D
,DNS events related to ToR proxies  (ASIM DNS Schema),3fe3c520-04f1-44b8-8398-782ed21435f8,Sentinel,Low,Scheduled,"Identifies IP addresses performing DNS lookups associated with common ToR proxies.
This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM DNS schema",Exfiltration,T1048,P1D,P1D
,DSRM Account Abuse,979c42dd-533e-4ede-b18b-31a84ba8b3d6,Sentinel,High,Scheduled,"This query detects an abuse of the DSRM account in order to maintain persistence and access to the organization's Active Directory.
Ref: https://adsecurity.org/?p=1785",Persistence,T1098,PT1H,PT1H
,Dumping LSASS Process Into a File,a7b9df32-1367-402d-b385-882daf6e3020,Sentinel,High,Scheduled,"Adversaries may attempt to access credential material stored in the process memory of the Local Security Authority Subsystem Service (LSASS). 
After a user logs on, the system generates and stores a variety of credential materials in LSASS process memory. 
These credential materials can be harvested by an administrative user or SYSTEM and used to conduct Lateral Movement using Use Alternate Authentication Material. 
As well as in-memory techniques, the LSASS process memory can be dumped from the target host and analyzed on a local system.
Ref: https://attack.mitre.org/techniques/T1003/001/",CredentialAccess,T1003,PT1H,PT1H
,Dynamics 365 - User Bulk Retrieval Outside Normal Activity,93a25f10-593d-4c57-a752-a8a75f031425,Sentinel,Medium,Scheduled,This query detects users retrieving significantly more records from Dynamics 365 than they have in the past 2 weeks. This could indicate potentially unauthorized access to data within Dynamics 365.,Collection,T1530,P1D,P14D
,Dynamics Encryption Settings Changed,b185ac23-dc27-4573-8192-1134c7a95f4f,Sentinel,Medium,Scheduled,"This query looks for changes to the Data Encryption settings for Dynamics 365.
Reference: https://docs.microsoft.com/microsoft-365/compliance/office-365-encryption-in-microsoft-dynamics-365",DefenseEvasion,T1600,PT1H,PT1H
,Email access via active sync,2f561e20-d97b-4b13-b02d-18b34af6e87c,Sentinel,Medium,Scheduled,"This query detects attempts to add attacker devices as allowed IDs for active sync using the Set-CASMailbox command.
This technique was seen in relation to Solorigate attack but the results can indicate potential malicious activity used in different attacks.
- Note that this query can be changed to use the KQL ""has_all"" operator, which hasn't yet been documented officially, but will be soon.
  In short, ""has_all"" will only match when the referenced field has all strings in the list.
- Refer to Set-CASMailbox syntax: https://docs.microsoft.com/powershell/module/exchange/set-casmailbox?view=exchange-ps  ",PrivilegeEscalation,T1068|T1078,P1D,P1D
,Employee account deleted,System.Object[],Solution,Medium,Scheduled,"This rule will monitor for any employee accounts being deleted.
Deleting an employee account can have a big potential impact as all of the data for that user will be removed.",Impact,,PT1H,PT1H
,End-user consent stopped due to risk-based consent,009b9bae-23dd-43c4-bcb9-11c4ba7c784a,Sentinel,Medium,Scheduled,"Detects a user's consent to an OAuth application being blocked due to it being too risky.
  These events should be investigated to understand why the user attempted to consent to the applicaiton and what other applicaitons they may have consented to.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-applications#end-user-stopped-due-to-risk-based-consent",Persistence|PrivilegeEscalation,T1078,P1D,P1D
,Europium - Hash and IP IOCs - September 2022,9d8b5a18-b7db-4c23-84a6-95febaf7e1e4,Sentinel,High,Scheduled,"Identifies a match across various data feeds for  hashes and IP IOC related to Europium
 Reference: https://www.microsoft.com/security/blog/2022/09/08/microsoft-investigates-iranian-attacks-against-the-albanian-government",CommandAndControl|CredentialAccess,T1071|T1003,PT12H,PT12H
,Excessive number of failed connections from a single source (ASIM Network Session schema),4902eddb-34f7-44a8-ac94-8486366e9494,Sentinel,Medium,Scheduled,"This rule identifies that a single source generates an excessive amount of failed connections. Modify the threshold to change the sensitivity of the rule: the higher the threshold, the less sensitive is the rule and less incidents will be generated.<br><br>
This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM NetworkSession schema",Impact,T1499,PT1H,PT1H
,Excessive number of HTTP authentication failures from a source (ASIM Web Session schema),a1bddaf8-982b-4089-ba9e-6590dfcf80ea,Sentinel,Low,Scheduled,"This rule identifies a source that repeatedly fails to authenticate to a web service (HTTP response code 403). This may indicate a [brute force](https://en.wikipedia.org/wiki/Brute-force_attack) or [credential stuffing](https://en.wikipedia.org/wiki/Credential_stuffing) attack.<br><br>
This rule uses the [Advanced Security Information Model (ASIM)](https://aka.ms/AboutSIM) and supports any web session source that complies with ASIM. ",Persistence|CredentialAccess,T1110|T1556,P1D,P1D
,Excessive NXDOMAIN DNS Queries (ASIM DNS Schema),c3b11fb2-9201-4844-b7b9-6b7bf6d9b851,Sentinel,Medium,Scheduled,"This creates an incident in the event a client generates excessive amounts of DNS queries for non-existent domains. 
This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM DNS schema",CommandAndControl,T1568|T1008,PT1H,PT1H
,Excessive Windows logon failures,2391ce61-8c8d-41ac-9723-d945b2e90720,Sentinel,Low,Scheduled,User has over 50 Windows logon failures today and at least 33% of the count of logon failures over the previous 7 days.,CredentialAccess,T1110,P1D,P8D
,Exchange AuditLog disabled,194dd92e-d6e7-4249-85a5-273350a7f5ce,Sentinel,Medium,Scheduled,"Identifies when the exchange audit logging has been disabled which may be an adversary attempt
to evade detection or avoid other defenses.",DefenseEvasion,T1562,P1D,P1D
,Exchange OAB Virtual Directory Attribute Containing Potential Webshell,faf1a6ff-53b5-4f92-8c55-4b20e9957594,Sentinel,High,Scheduled,"This query uses Windows Event ID 5136 in order to detect potential webshell deployment by exploitation of CVE-2021-27065.
This query looks for changes to the InternalHostName or ExternalHostName properties of Exchange OAB Virtual Directory objects in AD Directory Services
where the new objects contain potential webshell objects. Ref: https://aka.ms/ExchangeVulns",InitialAccess,T1190,PT1H,PT1H
,Exchange Server Suspicious File Downloads.,8955c0fb-3408-47b0-a3b9-a1faec41e427,Sentinel,Medium,Scheduled,"This query looks for messages related to file downloads of suspicious file types on an Exchange Server. This could indicate attempted deployment of webshells. 
This query uses the Exchange HttpProxy AOBGeneratorLog, you will need to onboard this log as a custom log under the table http_proxy_oab_CL before using this query. 
This log is commonly found at C:\Program Files\Microsoft\Exchange Server\V15\Logging\OABGeneratorLog on the Exchange server. Details on collecting custom logs into Sentinel
can be found here: https://learn.microsoft.com/azure/sentinel/connect-custom-logs",InitialAccess,T1190,P1D,P1D
,Exchange Server Vulnerabilities Disclosed March 2021 IoC Match,d804b39c-03a4-417c-a949-bdbf21fa3305,Sentinel,Medium,Scheduled,"This detection look for IoCs shared by Microsoft relating to attacks exploiting the Exchange Server vulnerabilities disclosed in March 2021. It looks for SHA256 file hashes, IP addresses and file paths in a number of data sources. This query can also be customized with additional data sources that may include these elements.
Ref: https://msrc-blog.microsoft.com/2021/03/02/multiple-security-updates-released-for-exchange-server/",InitialAccess,T1190,PT1H,PT1H
,Exchange SSRF Autodiscover ProxyShell - Detection,968358d6-6af8-49bb-aaa4-187b3067fb95,Sentinel,High,Scheduled,"This query looks for suspicious request patterns to Exchange servers that fit patterns recently
blogged about by PeterJson. This exploitation chain utilises an SSRF vulnerability in Exchange
which eventually allows the attacker to execute arbitrary Powershell on the server. In the example
powershell can be used to write an email to disk with an encoded attachment containing a shell.
Reference: https://peterjson.medium.com/reproducing-the-proxyshell-pwn2own-exploit-49743a4ea9a1",InitialAccess,T1190,PT12H,PT12H
,Exchange Worker Process Making Remote Call,2c701f94-783c-4cd4-bc9b-3b3334976090,Sentinel,Medium,Scheduled,"This query dynamically identifies Exchange servers and then looks for instances where the IIS worker process
initiates a call out to a remote URL using either cmd.exe or powershell.exe. This behaviour was described as
post-compromise behaviour following exploitation of CVE-2022-41040 and CVE-2022-41082, this pattern of activity was
use to download additional tools to the server. This suspicious activity is generic.",Execution,T1059,P1D,P1D
,Exchange workflow MailItemsAccessed operation anomaly,b4ceb583-4c44-4555-8ecf-39f572e827ba,Sentinel,Medium,Scheduled,"Identifies anomalous increases in Exchange mail items accessed operations.
The query leverages KQL built-in anomaly detection algorithms to find large deviations from baseline patterns.
Sudden increases in execution frequency of sensitive actions should be further investigated for malicious activity.
Manually change scorethreshold from 1.5 to 3 or higher to reduce the noise based on outliers flagged from the query criteria.
Read more about MailItemsAccessed- https://docs.microsoft.com/microsoft-365/compliance/advanced-audit?view=o365-worldwide#mailitemsaccessed",Collection,T1114,P1D,P14D
,Explicit MFA Deny,a22740ec-fc1e-4c91-8de6-c29c6450ad00,Sentinel,Medium,Scheduled,"User explicitly denies MFA push, indicating that login was not expected and the account's password may be compromised.",CredentialAccess,T1110,P1D,P1D
,External guest invitation followed by Azure AD PowerShell signin,acc4c247-aaf7-494b-b5da-17f18863878a,Sentinel,Medium,Scheduled,"By default guests have capability to invite more external guest users, guests also can do suspicious Azure AD enumeration. This detection look at guests
users, who have been invited or have invited recently, who also are logging via various PowerShell CLI.
Ref : 'https://danielchronlund.com/2021/11/18/scary-azure-ad-tenant-enumeration-using-regular-b2b-guest-accounts/",InitialAccess|Persistence|Discovery,T1078|T1136|T1087,PT1H,P1D
,External Upstream Source Added to Azure DevOps Feed,adc32a33-1cd6-46f5-8801-e3ed8337885f,Sentinel,Medium,Scheduled,"The detection looks for new external sources added to an Azure DevOps feed. An allow list can be customized to explicitly allow known good sources. 
An attacker could look to add a malicious feed in order to inject malicious packages into a build pipeline.",InitialAccess,T1199,P1D,P1D
,External User Access Enabled,8e267e91-6bda-4b3c-bf68-9f5cbdd103a3,Sentinel,Low,Scheduled,This alerts when the account setting is changed to allow either external domain access or anonymous access to meetings.,CredentialAccess|Persistence,T1098|T1556,P1D,P1D
,External user added and removed in short timeframe,bff093b2-500e-4ae5-bb49-a5b1423cbd5b,Sentinel,Low,Scheduled,"This detection flags the occurances of external user accounts that are added to a Team and then removed within
one hour.",Persistence,T1136,PT1H,PT1H
,Failed AWS Console logons but success logon to AzureAD,910124df-913c-47e3-a7cd-29e1643fa55e,Sentinel,Medium,Scheduled,"Identifies a list of IP addresses with a minimum numbe(default of 5) of failed logon attempts to AWS Console.
Uses that list to identify any successful Azure Active Directory logons from these IPs within the same timeframe.",InitialAccess|CredentialAccess,T1078|T1110,P1D,P1D
,Failed AzureAD logons but success logon to AWS Console,643c2025-9604-47c5-833f-7b4b9378a1f5,Sentinel,Medium,Scheduled,"Identifies a list of IP addresses with a minimum number(defualt of 5) of failed logon attempts to Azure Active Directory.
Uses that list to identify any successful AWS Console logons from these IPs within the same timeframe.",InitialAccess|CredentialAccess,T1078|T1110,P1D,P1D
,Failed AzureAD logons but success logon to host,8ee967a2-a645-4832-85f4-72b635bcb3a6,Sentinel,Medium,Scheduled,"Identifies a list of IP addresses with a minimum number (default of 5) of failed logon attempts to Azure Active Directory.
Uses that list to identify any successful remote logons to hosts from these IPs within the same timeframe.",InitialAccess|CredentialAccess,T1078|T1110,P1D,P1D
,Failed host logons but success logon to AzureAD,1ce5e766-26ab-4616-b7c8-3b33ae321e80,Sentinel,Medium,Scheduled,"Identifies a list of IP addresses with a minimum number(default of 5) of failed logon attempts to remote hosts.
Uses that list to identify any successful logons to Azure Active Directory from these IPs within the same timeframe.",InitialAccess|CredentialAccess,T1078|T1110,P1D,P1D
,Failed login attempts to Azure Portal,223db5c1-1bf8-47d8-8806-bed401b356a4,Sentinel,Low,Scheduled,"Identifies failed login attempts in the Azure Active Directory SigninLogs to the Azure Portal.  Many failed logon
attempts or some failed logon attempts from multiple IPs could indicate a potential brute force attack.
The following are excluded due to success and non-failure results:
References: https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-sign-ins-error-codes
0 - successful logon
50125 - Sign-in was interrupted due to a password reset or password registration entry.
50140 - This error occurred due to 'Keep me signed in' interrupt when the user was signing-in.",CredentialAccess,T1110,P1D,P7D
,Failed logon attempts by valid accounts within 10 mins,0777f138-e5d8-4eab-bec1-e11ddfbc2be2,Sentinel,Low,Scheduled,Identifies when failed logon attempts are 20 or higher during a 10 minute period (2 failed logons per minute minimum) from valid account.,CredentialAccess,T1110,PT10M,PT10M
,Failed logon attempts in authpriv,e7ec9fa6-e7f7-41ed-a34b-b956837a3ee6,Sentinel,Medium,Scheduled,"Identifies failed logon attempts from unknown users in Syslog authpriv logs. The unknown user means the account that tried to log in 
isn't provisioned on the machine. A few hits could indicate someone attempting to access a machine they aren't authorized to access. 
If there are many of hits, especially from outside your network, it could indicate a brute force attack. 
Default threshold for logon attempts is 15.",CredentialAccess,T1110,P1D,P1D
,Failed sign-ins into LastPass due to MFA,System.Object[],Solution,Low,Scheduled,"This rule will check if a sign-in failed into LastPass due to MFA.
An incident can indicate the potential brute forcing of a LastPass account. 
The use of MFA is identified by combining the sign-in logs, this rule assumes LastPass is federated to AAD.",InitialAccess,,P1D,P1D
,Fake computer account created,c1faf5e8-6958-11ec-90d6-0242ac120003,Sentinel,Medium,Scheduled,"This query detects domain user accounts creation (event ID 4720) where the username ends with $. 
Accounts that end with $ are normally domain computer accounts and when they are created the event ID 4741 is generated instead.
Ref: https://blog.menasec.net/2019/02/threat-hunting-6-hiding-in-plain-sights.html",DefenseEvasion,T1564,PT1H,PT1H
,First access credential added to Application or Service Principal where no credential was present,2cfc3c6e-f424-4b88-9cc9-c89f482d016a,Sentinel,High,Scheduled,"This will alert when an admin or app owner account adds a new credential to an Application or Service Principal where there was no previous verify KeyCredential associated.
If a threat actor obtains access to an account with sufficient privileges and adds the alternate authentication material triggering this event, the threat actor can now authenticate as the Application or Service Principal using this credential.
Additional information on OAuth Credential Grants can be found in RFC 6749 Section 4.4 or https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow
For further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities.",DefenseEvasion,T1550,PT1H,PT1H
,Fortinet - Beacon pattern detected,3255ec41-6bd6-4f35-84b1-c032b18bbfcb,Sentinel,Low,Scheduled,"Identifies patterns in the time deltas of contacts between internal and external IPs in Fortinet network data that are consistent with beaconing.
 Accounts for randomness (jitter) and seasonality such as working hours that may have been introduced into the beacon pattern.
 The lookback is set to 1d, the minimum granularity in time deltas is set to 60 seconds and the minimum number of beacons required to emit a
 detection is set to 4.
 Increase the lookback period to capture beacons with larger periodicities.
 The jitter tolerance is set to 0.2 - This means we account for an overall 20% deviation from the infered beacon periodicity. Seasonality is dealt with
 automatically using series_outliers.
 Note: In large environments it may be necessary to reduce the lookback period to get fast query times.",CommandAndControl,T1071|T1571,P1D,P1D
,Front Door Premium WAF - SQLi Detection,16da3a2a-af29-48a0-8606-d467c180fe18,Sentinel,High,Scheduled,"Identifies a match for SQL Injection attack in the Front Door Premium WAF logs. The Threshold value in the query can be changed as per your infrastructure's requirement.
 References: https://owasp.org/Top10/A03_2021-Injection/",DefenseEvasion|Execution|InitialAccess|PrivilegeEscalation,T1211|T1059|T1190|T0890,PT6H,PT6H
,Front Door Premium WAF - XSS Detection,b7643904-5081-4920-917e-a559ddc3448f,Sentinel,High,Scheduled,"Identifies a match for XSS attack in the Front Door Premium WAF logs. The Threshold value in the query can be changed as per your infrastructure's requirement.
 References: https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)",InitialAccess|Execution,T1189|T1203|T0853,PT6H,PT6H
,"Full Admin policy created and then attached to Roles, Users or Groups",826bb2f8-7894-4785-9a6b-a8a855d8366f,Sentinel,Medium,Scheduled,"Identity and Access Management (IAM) securely manages access to AWS services and resources. 
Identifies when a policy is created with Full Administrators Access (Allow-Action:*,Resource:*). 
This policy can be attached to role,user or group and may be used by an adversary to escalate a normal user privileges to an adminsitrative level.
AWS IAM Policy Grammar: https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_grammar.html
and AWS IAM API at https://docs.aws.amazon.com/IAM/latest/APIReference/API_Operations.html",PrivilegeEscalation,,P1D,P14D
,Gain Code Execution on ADFS Server via Remote WMI Execution,0bd65651-1404-438b-8f63-eecddcec87b4,Sentinel,Medium,Scheduled,"This query detects instances where an attacker has gained the ability to execute code on an ADFS Server through remote WMI Execution.
In order to use this query you need to be collecting Sysmon EventIDs 19, 20, and 21.
If you do not have Sysmon data in your workspace this query will raise an error stating:
     Failed to resolve scalar expression named ""[@Name]""
For more on how WMI was used in Solorigate see https://www.microsoft.com/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/.
The query contains some features from the following detections to look for potentially malicious ADFS activity. See them for more details.
- ADFS Key Export (Sysmon): https://github.com/Azure/Azure-Sentinel/blob/master/Detections/SecurityEvent/ADFSKeyExportSysmon.yaml
- ADFS DKM Master Key Export: https://github.com/Azure/Azure-Sentinel/blob/master/Detections/MultipleDataSources/ADFS-DKM-MasterKey-Export.yaml",LateralMovement,T1210,P1D,P7D
,Gain Code Execution on ADFS Server via SMB + Remote Service or Scheduled Task,12dcea64-bec2-41c9-9df2-9f28461b1295,Sentinel,Medium,Scheduled,This query detects instances where an attacker has gained the ability to execute code on an ADFS Server through SMB and Remote Service or Scheduled Task.,LateralMovement,T1210,P1D,P7D
,GitHub Activites from a New Country,f041e01d-840d-43da-95c8-4188f6cef546,Sentinel,Medium,Scheduled,Detect activities from a location that was not recently or was never visited by the user or by any user in your organization.,InitialAccess,T1078,P1D,P7D
,GitHub Security Vulnerability in Repository,5436f471-b03d-41cb-b333-65891f887c43,Sentinel,Informational,Scheduled,This alerts when there is a new security vulnerability in a GitHub repository.,,,PT1H,PT1H
,GitHub Signin Burst from Multiple Locations,d3980830-dd9d-40a5-911f-76b44dfdce16,Sentinel,Medium,Scheduled,This alerts when there Signin burst from multiple locations in GitHub (AAD SSO).,CredentialAccess,T1110,PT1H,PT1H
,GitHub Two Factor Auth Disable,3ff0fffb-d963-40c0-b235-3404f915add7,Sentinel,Medium,Scheduled,"Two-factor authentication is a process where a user is prompted during the sign-in process for an additional form of identification, such as to enter a code on their cellphone or to provide a fingerprint scan. Two factor authentication reduces the risk of account takeover. Attacker will want to disable such security tools in order to go undetected. ",DefenseEvasion,T1562,P1D,P1D
,Group created then added to built in domain local or global group,a7564d76-ec6b-4519-a66b-fcc80c42332b,Sentinel,Medium,Scheduled,"Identifies when a recently created Group was added to a privileged built in domain local group or global group such as the 
Enterprise Admins, Cert Publishers or DnsAdmins.  Be sure to verify this is an expected addition.
References: For AD SID mappings - https://docs.microsoft.com/windows/security/identity-protection/access-control/active-directory-security-groups.",Persistence|PrivilegeEscalation,T1098|T1078,PT1H,PT1H
,Guest accounts added in AAD Groups other than the ones specified,6ab1f7b2-61b8-442f-bc81-96afe7ad8c53,Sentinel,High,Scheduled,"Guest Accounts are added in the Organization Tenants to perform various tasks i.e projects execution, support etc.. This detection notifies when guest users are added to Azure AD Groups other than the ones specified and poses a risk to gain access to sensitive apps or data.",InitialAccess|Persistence|Discovery,T1078|T1136|T1087,P1D,P1D
,Guest accounts changed user type from guest to members in AzureAD,639aa695-9de9-4921-aa6b-6fdc35cb1eee,Sentinel,Medium,Scheduled,"Guest Accounts are added in the Organization Tenants to perform various tasks i.e projects execution, support etc.. This detection notifies when guest users are changed from user type as should be in AzureAD to member and gain other rights in the tenant.",InitialAccess|Persistence|Discovery,T1078|T1136|T1087,P1D,P1D
,Guest Users Invited to Tenant by New Inviters,572e75ef-5147-49d9-9d65-13f2ed1e3a86,Sentinel,Medium,Scheduled,"Detects when a Guest User is added by a user account that has not been seen adding a guest in the previous 14 days.
  Monitoring guest accounts and the access they are provided is important to detect potential account abuse.
  Accounts added should be investigated to ensure the activity was legitimate.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-user-accounts#monitoring-for-failed-unusual-sign-ins",Persistence,T1078,P1D,P14D
,HAFNIUM New UM Service Child Process,95a15f39-d9cc-4667-8cdd-58f3113691c9,Sentinel,Medium,Scheduled,"This query looks for new processes being spawned by the Exchange UM service where that process has not previously been observed before. 
Reference: https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/",InitialAccess,T1190,P1D,P14D
,HAFNIUM Suspicious Exchange Request,23005e87-2d3a-482b-b03d-edbebd1ae151,Sentinel,Medium,Scheduled,"This query looks for suspicious request patterns to Exchange servers that fit a pattern observed by HAFNIUM actors.
The same query can be run on HTTPProxy logs from on-premise hosted Exchange servers.
Reference: https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/",InitialAccess,T1190,P1D,P14D
,HAFNIUM Suspicious File Downloads.,03e04c97-8cae-48b3-9d2f-4ab262e4ffff,Sentinel,Medium,Scheduled,"This query looks for messages related to file downloads of suspicious file types. This query uses the Exchange HttpProxy AOBGeneratorLog, you will need to onboard this log as a custom log under the table http_proxy_oab_CL before using this query. 
Reference: https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/",InitialAccess,T1190,P1D,P1D
,HAFNIUM Suspicious UM Service Error,0625fcce-6d52-491e-8c68-1d9b801d25b9,Sentinel,Low,Scheduled,"This query looks for errors that may indicate that an attacker is attempting to exploit a vulnerability in the service. 
Reference: https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/",InitialAccess,T1190,P1D,P1D
,HAFNIUM UM Service writing suspicious file,7d6d8a8e-b08a-4082-8dbb-d7fd2cbbc35e,Sentinel,High,Scheduled,"This query looks for the Exchange server UM process writing suspicious files that may be indicative of webshells.
Reference: https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/",InitialAccess,T1190,P1D,P1D
,High count of connections by client IP on many ports,44a555d8-ecee-4a25-95ce-055879b4b14b,Sentinel,Medium,Scheduled,"Identifies when 30 or more ports are used for a given client IP in 10 minutes occurring on the IIS server.
This could be indicative of attempted port scanning or exploit attempt at internet facing web applications.
This could also simply indicate a misconfigured service or device.
References:
IIS status code mapping - https://support.microsoft.com/help/943891/the-http-status-code-in-iis-7-0-iis-7-5-and-iis-8-0
Win32 Status code mapping - https://msdn.microsoft.com/library/cc231199.aspx",InitialAccess,T1190,P1D,P1D
,High count of failed attempts from same client IP,19e01883-15d8-4eb6-a7a5-3276cd668388,Sentinel,Medium,Scheduled,"Identifies when 20 or more failed attempts from a given client IP in 1 minute occur on the IIS server.
This could be indicative of an attempted brute force. This could also simply indicate a misconfigured service or device.
Recommendations: Validate that these are expected connections from the given Client IP.  If the client IP is not recognized,
potentially block these connections at the edge device.
If these are expected connections, verify the credentials are properly configured on the system, service, application or device
that is associated with the client IP.
References:
IIS status code mapping: https://support.microsoft.com/help/943891/the-http-status-code-in-iis-7-0-iis-7-5-and-iis-8-0
Win32 Status code mapping: https://msdn.microsoft.com/library/cc231199.aspx",CredentialAccess,T1110,P1D,P1D
,High count of failed logons by a user,884c4957-70ea-4f57-80b9-1bca3890315b,Sentinel,Medium,Scheduled,"Identifies when 100 or more failed attempts by a given user in 10 minutes occur on the IIS Server.
This could be indicative of attempted brute force based on known account information.
This could also simply indicate a misconfigured service or device.
References:
IIS status code mapping - https://support.microsoft.com/help/943891/the-http-status-code-in-iis-7-0-iis-7-5-and-iis-8-0
Win32 Status code mapping - https://msdn.microsoft.com/library/cc231199.aspx",CredentialAccess,T1110,P1D,P1D
,High Number of Urgent Vulnerabilities Detected,be52662c-3b23-435a-a6fa-f39bdfc849e6,Sentinel,Medium,Scheduled,"This Creates an incident when a host has a high number of Urgent, severity 5, vulnerabilities detected.",InitialAccess,T1190,PT1H,PT1H
,High Number of Urgent Vulnerabilities Detected,3edb7215-250b-40c0-8b46-79093949242d,Sentinel,Medium,Scheduled,"This Creates an incident when a host has a high number of Urgent, severity 5, vulnerabilities detected.",InitialAccess,T1190,PT1H,PT1H
,Highly Sensitive Password Accessed,System.Object[],Solution,Medium,Scheduled,"This rule will monitor access to highly sensitive passwords.
Within the Watchlist called 'LastPass' define passwords which are deemed highly sensitive (such as password to a high privileged application).
When an activity is observed against such password, an incident is created.",CredentialAccess|Discovery,,PT1H,PT1H
,Hive Ransomware IOC - July 2022,b2199398-8942-4b8c-91a9-b0a707c5d147,Sentinel,High,Scheduled,Identifies a hash match related to Hive Ransomware across various data sources.,Impact,T1486,PT12H,PT12H
,Identify MERCURY powershell commands,ce74dc9a-cb3c-4081-8c2f-7d39f6b7bae1,Sentinel,High,Scheduled,"The query below identifies powershell commands used by the threat actor Mercury.
Reference:  https://www.microsoft.com/security/blog/2022/08/25/mercury-leveraging-log4j-2-vulnerabilities-in-unpatched-systems-to-target-israeli-organizations/",LateralMovement,T1570,P1D,P1D
,Identify SysAid Server web shell creation,50eb4cbd-188f-44f4-b964-bab84dcdec10,Sentinel,High,Scheduled,"This query looks for potential webshell creation by the threat actor Mercury after the sucessful exploitation of SysAid server. 
Reference:  https://www.microsoft.com/security/blog/2022/08/25/mercury-leveraging-log4j-2-vulnerabilities-in-unpatched-systems-to-target-israeli-organizations/",InitialAccess,T1190,P1D,P1D
,IP address of Windows host encoded in web request,a4ce20ae-a2e4-4d50-b40d-d49f1353b6cc,Sentinel,Medium,Scheduled,"This detection will identify network requests in HTTP proxy data that contains Base64 encoded IP addresses. After identifying candidates the query
joins with DeviceNetworkEvents to idnetify any machine within the network using that IP address. Alerts indicate that the IP address of a machine
within your network was seen with it's IP address base64 encoded in an outbounf web request. This method of egressing the IP was seen used in POLONIUM's
RunningRAT tool, however the detection is generic.",Exfiltration|CommandAndControl,T1041|T1071,P1D,P1D
,IP with multiple failed Azure AD logins successfully logs in to Palo Alto VPN,ba144bf8-75b8-406f-9420-ed74397f9479,Sentinel,Medium,Scheduled,"This query creates a list of IP addresses with a number failed login attempts to AAD 
above a set threshold.  It then looks for any successful Palo Alto VPN logins from any
of these IPs within the same timeframe.",InitialAccess|CredentialAccess,T1078|T1110,P1D,P1D
,KNOTWEED AV Detection,9f9c1e51-4fb1-4510-a675-c7c2fb32f47e,Sentinel,High,Scheduled,"This query looks for Microsoft Defender AV detections related to the KNOTWEED threat actor and the Corelump and Jumplump malware.
  Ref: https://www.microsoft.com/security/blog/2022/07/27/untangling-knotweed-european-private-sector-offensive-actor-using-0-day-exploits/",Execution,T1203,P1D,P1D
,KNOTWEED C2 Domains July 2022,ce02935c-cc67-4b77-9b96-93d9947e119a,Sentinel,High,Scheduled,"This query looks for references to known KNOTWEED Domains in network logs.
  This query was published July 2022.
  Ref: https://www.microsoft.com/security/blog/2022/07/27/untangling-knotweed-european-private-sector-offensive-actor-using-0-day-exploits/",CommandAndControl,T1071,P1D,P1D
,KNOTWEED File Hashes July 2022,a779e2d5-9109-4f0a-a75e-f3d4f3c58560,Sentinel,High,Scheduled,"This query looks for references to known KNOTWEED file hashes in various logs.
  This query was published July 2022.
  Ref: https://www.microsoft.com/security/blog/2022/07/27/untangling-knotweed-european-private-sector-offensive-actor-using-0-day-exploits/",Execution,T1203,P1D,P1D
,Known Barium domains,70b12a3b-4899-42cb-910c-5ffaf9d7997d,Sentinel,High,Scheduled,"Identifies a match across various data feeds for domains IOCs related to the Barium activity group.
 References: https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer",CommandAndControl,,P1D,P1D
,Known Barium IP,6ee72a9e-2e54-459c-bc9a-9c09a6502a63,Sentinel,High,Scheduled,"Identifies a match across various data feeds for IP IOCs related to the Barium activity group.
 References: https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer",CommandAndControl,,P1D,P1D
,Known CERIUM domains and hashes,c87fb346-ea3a-4c64-ba92-3dd383e0f0b5,Sentinel,High,Scheduled,"CERIUM malicious webserver and hash values for maldocs and malware. 
 Matches domain name IOCs related to the CERIUM activity group with CommonSecurityLog, DnsEvents, and VMConnection dataTypes.",CommandAndControl|CredentialAccess,,P1D,P1D
,Known GALLIUM domains and hashes,26a3b261-b997-4374-94ea-6c37f67f4f39,Sentinel,High,Scheduled,"GALLIUM command and control domains and hash values for tools and malware used by GALLIUM. 
 Matches domain name IOCs related to the GALLIUM activity group with CommonSecurityLog, DnsEvents, VMConnection and SecurityEvents dataTypes.
 References: https://www.microsoft.com/security/blog/2019/12/12/gallium-targeting-global-telecom/ ",CommandAndControl|CredentialAccess,,P1D,P1D
,Known IRIDIUM IP,7ee72a9e-2e54-459c-bc8a-8c08a6532a63,Sentinel,High,Scheduled,IRIDIUM command and control IP. Identifies a match across various data feeds for IP IOCs related to the IRIDIUM activity group.,CommandAndControl,,P1D,P1D
,Known Manganese IP and UserAgent activity,a04cf847-a832-4c60-b687-b0b6147da219,Sentinel,High,Scheduled,"Matches IP plus UserAgent IOCs in OfficeActivity data, along with IP plus Connection string information in the CommonSecurityLog data related to Manganese group activity.
References: 
https://kb.pulsesecure.net/articles/Pulse_Security_Advisories/SA44101/
https://fortiguard.com/psirt/FG-IR-18-384",InitialAccess|Collection,T1133|T1114,P1D,P1D
,Known NICKEL domains and hashes,9122a9cb-916b-4d98-a199-1b7b0af8d598,Sentinel,High,Scheduled,"IOC domains and hash values for tools and malware used by NICKEL. 
 Matches domain name, hash IOCs and M365 Defender sigs related to the NICKEL activity group with CommonSecurityLog, DnsEvents, VMConnection and SecurityEvents dataTypes.",CommandAndControl,T1071,P1D,P1D
,Known Phosphorus group domains/IP,155f40c6-610d-497d-85fc-3cf06ec13256,Sentinel,High,Scheduled,"Matches domain name IOCs related to Phosphorus group activity with CommonSecurityLog, DnsEvents, OfficeActivity and VMConnection dataTypes.
References: https://blogs.microsoft.com/on-the-issues/2019/03/27/new-steps-to-protect-customers-from-hacking/.",CommandAndControl,T1071,P1D,P1D
,Known PHOSPHORUS group domains/IP - October 2020,7249500f-3038-4b83-8549-9cd8dfa2d498,Sentinel,High,Scheduled,"Matches IOCs related to PHOSPHORUS group activity published October 2020 with CommonSecurityLog, DnsEvents, OfficeActivity and VMConnection dataTypes.
References: ",CommandAndControl|InitialAccess,T1071|T1566,P1D,P1D
,Known POLONIUM IP,95407904-0131-4918-bc49-ebf282ce149a,Sentinel,High,Scheduled,"Identifies a match across various data feeds for IP IOCs related to the POLONIUM activity group.  
 References: BLOGURL' ",CommandAndControl,,P1D,P1D
,Known STRONTIUM group domains - July 2019,074ce265-f684-41cd-af07-613c5f3e6d0d,Sentinel,High,Scheduled,"Matches domain name IOCs related to Strontium group activity published July 2019 with CommonSecurityLog, DnsEvents and VMConnection dataTypes.
References: https://blogs.microsoft.com/on-the-issues/2019/07/17/new-cyberthreats-require-new-ways-to-protect-democracy/.",CommandAndControl,T1071,P1D,P1D
,Known ZINC Comebacker and Klackring malware hashes,09551db0-e147-4a0c-9e7b-918f88847605,Sentinel,High,Scheduled,ZINC attacks against security researcher campaign malware hashes.,CommandAndControl|Execution,T1071|T1204,P1D,P1D
,Known ZINC related maldoc hash,3174a9ec-d0ad-4152-8307-94ed04fa450a,Sentinel,High,Scheduled,Document hash used by ZINC in highly targeted spear phishing campaign.,CommandAndControl|CredentialAccess,,P1D,P1D
,Lateral Movement via DCOM,50cbf34a-4cdd-45d7-b3f5-8b53a1d0d14f,Sentinel,Medium,Scheduled,"This query detects a fairly uncommon attack technique using the Windows Distributed Component Object Model (DCOM) to make a remote execution call to another computer system and gain lateral movement throughout the network.
Ref: http://thenegative.zone/incident%20response/2017/02/04/MMC20.Application-Lateral-Movement-Analysis.html",LateralMovement,T1021,PT1H,PT1H
,Linked Malicious Storage Artifacts,b9e3b9f8-a406-4151-9891-e5ff1ddd8c1d,Sentinel,Medium,Scheduled,An IP address which uploaded malicious content to an Azure Blob or File Storage container (triggering a malware alert) also uploaded additional files.,CommandAndControl|Exfiltration,T1071|T1567,P1D,P1D
,Log4j vulnerability exploit aka Log4Shell IP IOC,System.Object[],Solution,High,Scheduled,"Identifies a match across various data feeds for IP IOCs related to the Log4j vulnerability exploit aka Log4Shell described in CVE-2021-44228.
 References: https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-44228",CommandAndControl,,PT1H,PT1H
,Log4j vulnerability exploit aka Log4Shell IP IOC,6e575295-a7e6-464c-8192-3e1d8fd6a990,Sentinel,High,Scheduled,"Identifies a match across various data feeds for IP IOCs related to the Log4j vulnerability exploit aka Log4Shell described in CVE-2021-44228.
 References: https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-44228",CommandAndControl,,PT1H,PT1H
,Login to AWS Management Console without MFA,d25b1998-a592-4bc5-8a3a-92b39eedb1bc,Sentinel,Low,Scheduled,"Multi-Factor Authentication (MFA) helps you to prevent credential compromise. This alert identifies logins to the AWS Management Console without MFA.
You can limit this detection to trigger for adminsitrative accounts if you do not have MFA enabled on all accounts.
This is done by looking at the eventName ConsoleLogin and if the AdditionalEventData field indicates MFA was NOT used
and the ResponseElements field indicates NOT a Failure. Thereby indicating that a non-MFA login was successful.",DefenseEvasion|PrivilegeEscalation|Persistence|InitialAccess,T1078,P1D,P1D
,Mail redirect via ExO transport rule,500415fb-bba7-4227-a08a-9857fb61b6a7,Sentinel,Medium,Scheduled,"Identifies when Exchange Online transport rule configured to forward emails.
This could be an adversary mailbox configured to collect mail from multiple user accounts.",Collection|Exfiltration,T1114|T1020,P1D,P1D
,Mail.Read Permissions Granted to Application,2560515c-07d1-434e-87fb-ebe3af267760,Sentinel,Medium,Scheduled,This query look for applications that have been granted (Delegated or App/Role) permissions to Read Mail (Permissions field has Mail.Read) and subsequently has been consented to. This can help identify applications that have been abused to gain access to mailboxes.,Persistence,T1098,P1D,P1D
,Malformed user agent,a357535e-f722-4afe-b375-cff362b2b376,Sentinel,Medium,Scheduled,"Malware authors will sometimes hardcode user agent string values when writing the network communication component of their malware.
Malformed user agents can be an indication of such malware.",InitialAccess|CommandAndControl|Execution,T1189|T1071|T1203,P1D,P1D
,Malicious Inbox Rule,7b907bf7-77d4-41d0-a208-5643ff75bf9a,Sentinel,Medium,Scheduled,"Often times after the initial compromise the attackers create inbox rules to delete emails that contain certain keywords.
 This is done so as to limit ability to warn compromised users that they've been compromised. Below is a sample query that tries to detect this.
Reference: https://www.reddit.com/r/sysadmin/comments/7kyp0a/recent_phishing_attempts_my_experience_and_what/",Persistence|DefenseEvasion,T1098|T1078,P1D,P1D
,Malicious web application requests linked with Microsoft Defender for Endpoint (formerly Microsoft Defender ATP) alerts,fbfbf530-506b-49a4-81ad-4030885a195c,Sentinel,Medium,Scheduled,"Takes Microsoft Defender for Endpoint (formerly Microsoft Defender ATP) alerts where web scripts are present in the evidence and correlates with requests made to those scripts
in the WCSIISLog to surface new alerts for potentially malicious web request activity.
The lookback for alerts is set to 1h and the lookback for W3CIISLogs is set to 7d. A sample set of popular web script extensions
has been provided in scriptExtensions that should be tailored to your environment.",Persistence,T1505,PT1H,P7D
,Malware in the recycle bin,75bf9902-0789-47c1-a5d8-f57046aa72df,Sentinel,Medium,Scheduled,"The query detects Windows binaries, that can be used for executing malware, that have been hidden in the recycle bin. 
 The list of these binaries are sourced from https://lolbas-project.github.io/
 References: https://azure.microsoft.com/blog/how-azure-security-center-helps-reveal-a-cyberattack/.",DefenseEvasion,,P1D,P1D
,Malware in the recycle bin (Normalized Process Events),61988db3-0565-49b5-b8e3-747195baac6e,Sentinel,Medium,Scheduled,"Identifies malware that has been hidden in the recycle bin.
To use this analytics rule, make sure you have deployed the [ASIM normalization parsers](https://aka.ms/ASimProcessEvent)",DefenseEvasion,T1564,P1D,P1D
,Mass Cloud resource deletions Time Series Anomaly,ed43bdb7-eaab-4ea4-be52-6951fcfa7e3b,Sentinel,Medium,Scheduled,"This query generates baseline pattern of cloud resource deletions by an user and generated anomaly 
when any unusual spike is detected.
These anomalies from unusual or privileged users could be an indication of cloud infrastructure 
take-down by an adversary ",Impact,T1485,P1D,P14D
,Mass Download & copy to USB device by single user,6267ce44-1e9d-471b-9f1e-ae76a6b7aa84,Sentinel,Medium,Scheduled,"This query looks for any mass download by a single user with possible file copy activity to a new USB drive. Malicious insiders may perform such activities that may cause harm to the organization. 
This query could also reveal unintentional insider that had no intention of malicious activity but their actions may impact an organizations security posture.
Reference:https://docs.microsoft.com/defender-cloud-apps/policy-template-reference",Exfiltration,T1052,P1D,P1D
,Mass Export of Dynamics 365 Records to Excel,05eca115-c4b5-48e4-ba6e-07db57695be2,Sentinel,Medium,Scheduled,"The query detects user exporting a large amount of records from Dynamics 365 to Excel, significantly more records exported than any other recent activity by that user.",Collection,T1530,P1D,P7D
,Mass secret retrieval from Azure Key Vault,24f8c234-d1ff-40ec-8b73-96b17a3a9c1c,Sentinel,Low,Scheduled,"Identifies mass secret retrieval from Azure Key Vault observed by a single user. 
Mass secret retrival crossing a certain threshold is an indication of credential dump operations or mis-configured applications. 
You can tweak the EventCountThreshold based on average count seen in your environment 
and also filter any known sources (IP/Account) and useragent combinations based on historical analysis to further reduce noise",CredentialAccess,T1003,P1D,P1D
,"Mercury - Domain, Hash and IP IOCs - August 2022",ae10c588-7ff7-486c-9920-ab8b0bdb6ede,Sentinel,High,Scheduled,"Identifies a match across various data feeds for domains, hashes and IP IOC related to Mercury
 Reference:  https://www.microsoft.com/security/blog/2022/08/25/mercury-leveraging-log4j-2-vulnerabilities-in-unpatched-systems-to-target-israeli-organizations/",CommandAndControl,T1071,PT12H,PT12H
,MFA disabled for a user,65c78944-930b-4cae-bd79-c3664ae30ba7,Sentinel,Medium,Scheduled,Multi-Factor Authentication (MFA) helps prevent credential compromise. This alert identifies when an attempt has been made to disable MFA for a user ,CredentialAccess|Persistence,T1098|T1556,PT1H,PT1H
,MFA Rejected by User,d99cf5c3-d660-436c-895b-8a8f8448da23,Sentinel,Medium,Scheduled,"Identifies accurances where a user has rejected an MFA prompt. This could be an indicator that a threat actor has compromised the username and password of this user account and is using it to try and log into the account.
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-user-accounts#monitoring-for-failed-unusual-sign-ins",InitialAccess,T1078,PT1H,PT1H
,Microsoft COVID-19 file hash indicator matches,2be4ef67-a93f-4d8a-981a-88158cb73abd,Sentinel,Medium,Scheduled,Identifies a match in CommonSecurityLog Event data from any FileHash published in the Microsoft COVID-19 Threat Intel Feed - as described at https://www.microsoft.com/security/blog/2020/05/14/open-sourcing-covid-threat-intelligence/,Impact,,PT1H,P14D
,Microsoft Defender for Endpoint (MDE) signatures for Azure Synapse pipelines and Azure Data Factory,a333d8bf-22a3-4c55-a1e9-5f0a135c0253,Sentinel,High,Scheduled,"This query looks for Microsoft Defender for Endpoint detections related to the remote command execution attempts on Azure IR with Managed VNet or SHIR. 
In Microsoft Sentinel, the SecurityAlerts table includes the name of the impacted device. Additionally, this query joins the DeviceInfo table to connect other information such as device group, 
IP address, signed in users, and others allowing analysts using Microsoft Sentinel to have more context related to the alert. 
Reference: https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-29972 , 
https://msrc-blog.microsoft.com/2022/05/09/vulnerability-mitigated-in-the-third-party-data-connector-used-in-azure-synapse-pipelines-and-azure-data-factory-cve-2022-29972",InitialAccess,T1190,P1D,P1D
,Missing Domain Controller Heartbeat,b8b8ba09-1e89-45a1-8bd7-691cd23bfa32,Sentinel,High,Scheduled,"This detection will go over the heartbeats received from the agents of Domain Controllers over the last hour, and will create alerts if the last heartbeats were received an hour ago.",Impact|DefenseEvasion,,PT15M,PT2H
,Modification of Accessibility Features,d714ef62-1a56-4779-804f-91c4158e528d,Sentinel,Medium,Scheduled,"Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by accessibility features. Windows contains accessibility features that may be launched with a key combination before a user has logged in (ex: when the user is on the Windows logon screen). An adversary can modify the way these programs are launched to get a command prompt or backdoor without logging in to the system.
 Two common accessibility programs are C:\Windows\System32\sethc.exe, launched when the shift key is pressed five times and C:\Windows\System32\utilman.exe, launched when the Windows + U key combination is pressed. The sethc.exe program is often referred to as ""sticky keys"", and has been used by adversaries for unauthenticated access through a remote desktop login screen. [1]
Ref: https://attack.mitre.org/techniques/T1546/008/",Persistence,T1546,PT1H,PT1H
,Modified domain federation trust settings,95dc4ae3-e0f2-48bd-b996-cdd22b90f9af,Sentinel,High,Scheduled,"This will alert when a user or application modifies the federation settings on the domain or Update domain authentication from Managed to Federated.
For example, this alert will trigger when a new Active Directory Federated Service (ADFS) TrustedRealm object, such as a signing certificate, is added to the domain.
Modification to domain federation settings should be rare. Confirm the added or modified target domain/URL is legitimate administrator behavior.
To understand why an authorized user may update settings for a federated domain in Office 365, Azure, or Intune, see: https://docs.microsoft.com/office365/troubleshoot/active-directory/update-federated-domain-office-365.
For details on security realms that accept security tokens, see the ADFS Proxy Protocol (MS-ADFSPP) specification: https://docs.microsoft.com/openspecs/windows_protocols/ms-adfspp/e7b9ea73-1980-4318-96a6-da559486664b.
For further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities.",CredentialAccess,,P1D,P1D
,Monitor AWS Credential abuse or hijacking,32555639-b639-4c2b-afda-c0ae0abefa55,Sentinel,Low,Scheduled,"Looking for GetCallerIdentity Events where the UserID Type is AssumedRole
An attacker who has assumed the role of a legitimate account can call the GetCallerIdentity function to determine what account they are using.
A legitimate user using legitimate credentials would not need to call GetCallerIdentity since they should already know what account they are using.
More Information: https://duo.com/decipher/trailblazer-hunts-compromised-credentials-in-aws
AWS STS GetCallerIdentity API: https://docs.aws.amazon.com/STS/latest/APIReference/API_GetCallerIdentity.html ",Discovery,T1087,P1D,P1D
,MSHTML vulnerability CVE-2021-40444 attack,972c89fa-c969-4d12-932f-04d55d145299,Sentinel,High,Scheduled,"This query detects attacks that exploit the CVE-2021-40444 MSHTML vulnerability using specially crafted Microsoft Office documents. 
 The detection searches for relevant files used in the attack along with regex matches in commnadline to look for pattern similar to : "".cpl:../../msword.inf""
 Refrence: https://www.microsoft.com/security/blog/2021/09/15/analyzing-attacks-that-exploit-the-mshtml-cve-2021-40444-vulnerability/",Execution,T1203,PT1H,PT1H
,Multiple admin membership removals from newly created admin.,cda5928c-2c1e-4575-9dfa-07568bc27a4f,Sentinel,Medium,Scheduled,"This query detects when newly created Global admin removes multiple existing global admins which can be an attempt by adversaries to lock down organization and retain sole access. 
 Investigate reasoning and intention of multiple membership removal by new Global admins and take necessary actions accordingly.",Impact,T1531,PT1H,P7D
,Multiple Password Reset by user,0b9ae89d-8cad-461c-808f-0494f70ad5c4,Sentinel,Low,Scheduled,"This query will determine multiple password resets by user across multiple data sources.
Account manipulation including password reset may aid adversaries in maintaining access to credentials
and certain permission levels within an environment.",InitialAccess|CredentialAccess,T1078|T1110,P1D,P1D
,Multiple RDP connections from Single System,78422ef2-62bf-48ca-9bab-72c69818a425,Sentinel,Low,Scheduled,"Identifies when an RDP connection is made to multiple systems and above the normal for the previous 7 days.
Connections from the same system with the same account within the same day.
RDP connections are indicated by the EventID 4624 with LogonType = 10",LateralMovement,T1021,P1D,P8D
,Multiple Teams deleted by a single user,173f8699-6af5-484a-8b06-8c47ba89b380,Sentinel,Low,Scheduled,"This detection flags the occurrences of deleting multiple teams within an hour.
This data is a part of Office 365 Connector in Microsoft Sentinel.",Impact,T1485|T1489,P1D,P1D
,Multiple users email forwarded to same destination,871ba14c-88ef-48aa-ad38-810f26760ca3,Sentinel,Medium,Scheduled,"Identifies when multiple (more than one) users mailboxes are configured to forward to the same destination. 
This could be an attacker-controlled destination mailbox configured to collect mail from multiple compromised user accounts.",Collection|Exfiltration,T1114|T1020,P1D,P7D
,Network endpoint to host executable correlation,01f64465-b1ef-41ea-a7f5-31553a11ad43,Sentinel,Medium,Scheduled,"Correlates blocked URLs hosting [malicious] executables with host endpoint data
to identify potential instances of executables of the same name having been recently run.",Execution,T1204,P1D,P1D
,New access credential added to Application or Service Principal,79566f41-df67-4e10-a703-c38a6213afd8,Sentinel,Medium,Scheduled,"This will alert when an admin or app owner account adds a new credential to an Application or Service Principal where a verify KeyCredential was already present for the app.
If a threat actor obtains access to an account with sufficient privileges and adds the alternate authentication material triggering this event, the threat actor can now authenticate as the Application or Service Principal using this credential.
Additional information on OAuth Credential Grants can be found in RFC 6749 Section 4.4 or https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow
For further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities.",DefenseEvasion,T1550,PT1H,PT1H
,New Agent Added to Pool by New User or Added to a New OS Type.,4ce177b3-56b1-4f0e-b83e-27eed4cb0b16,Sentinel,Medium,Scheduled,"As seen in attacks such as SolarWinds attackers can look to subvert a build process by controlling build servers. Azure DevOps uses agent pools to execute pipeline tasks. 
An attacker could insert compromised agents that they control into the pools in order to execute malicious code. This query looks for users adding agents to pools they have 
not added agents to before, or adding agents to a pool of an OS that has not been added to that pool before. This detection has potential for false positives so has a 
configurable allow list to allow for certain users to be excluded from the logic.",Execution,T1053,P1D,P14D
,New CloudShell User,6d7214d9-4a28-44df-aafb-0910b9e6ae3e,Sentinel,Low,Scheduled,"Identifies when a user creates an Azure CloudShell for the first time.
Monitor this activity to ensure only expected user are using CloudShell",Execution,T1059,P1D,P1D
,New Dynamics 365 Admin Activity,e147e4dc-849c-49e9-9e8b-db4581951ff4,Sentinel,Low,Scheduled,Detects users conducting administrative activity in Dynamics 365 where they have not had admin rights before.,InitialAccess,T1078,P1D,P14D
,New Dynamics 365 User Agent,8ec3a7f9-9f55-4be3-aeb6-9188f91b278e,Sentinel,Low,Scheduled,Detects users accessing Dynamics from a User Agent that has not been seen the 14 days. Has configurable filter for known good user agents such as PowerApps. Also includes optional section to exclude User Agents to indicate a browser being used.,InitialAccess,T1078,P1D,P14D
,New EXE deployed via Default Domain or Default Domain Controller Policies,05b4bccd-dd12-423d-8de4-5a6fb526bb4f,Sentinel,High,Scheduled,"This detection highlights executables deployed to hosts via either the Default Domain or Default Domain Controller Policies. These policies apply to all hosts or Domain Controllers and best practice is that these policies should not be used for deployment of files.
A threat actor may use these policies to deploy files or scripts to all hosts in a domain.",Execution|LateralMovement,T1072|T1570,P1D,P14D
,New EXE deployed via Default Domain or Default Domain Controller Policies (ASIM Version),0dd2a343-4bf9-4c93-a547-adf3658ddaec,Sentinel,High,Scheduled,"This detection highlights executables deployed to hosts via either the Default Domain or Default Domain Controller Policies. These policies apply to all hosts or Domain Controllers and best practice is that these policies should not be used for deployment of files.
  A threat actor may use these policies to deploy files or scripts to all hosts in a domain.
  This query uses the ASIM parsers and will need them deployed before usage - https://docs.microsoft.com/azure/sentinel/normalization",Execution|LateralMovement,T1072|T1570,P1D,P14D
,New executable via Office FileUploaded Operation,d722831e-88f5-4e25-b106-4ef6e29f8c13,Sentinel,Low,Scheduled,"Identifies when executable file types are uploaded to Office services such as SharePoint and OneDrive.
List currently includes 'exe', 'inf', 'gzip', 'cmd', 'bat' file extensions.
Additionally, identifies when a given user is uploading these files to another users workspace.
This may be indication of a staging location for malware or other malicious activity.",CommandAndControl,T1105,P1D,P8D
,New External User Granted Admin,d7424fd9-abb3-4ded-a723-eebe023aaa0b,Sentinel,Medium,Scheduled,"This query will detect instances where a newly invited external user is granted an administrative role. By default this query
will alert on any granted administrative role, however this can be modified using the roles variable if false positives occur
in your environment. The maximum delta between invite and escalation to admin is 60 minues, this can be configured using the 
deltaBetweenInviteEscalation variable.",Persistence,T1098,P1D,P1D
,New High Severity Vulnerability Detected Across Multiple Hosts,6116dc19-475a-4148-84b2-efe89c073e27,Sentinel,Medium,Scheduled,This creates an incident when a new high severity vulnerability is detected across multilple hosts,InitialAccess,T1190,PT1H,PT1H
,New High Severity Vulnerability Detected Across Multiple Hosts,84cf1d59-f620-4fee-b569-68daf7008b7b,Sentinel,Medium,Scheduled,This creates an incident when a new high severity vulnerability is detected across multilple hosts,InitialAccess,T1190,PT1H,PT1H
,New Office User Agent in Dynamics 365,572f3951-5fa3-4e42-9640-fe194d859419,Sentinel,Low,Scheduled,Detects users accessing Dynamics from a User Agent that has not been seen in any Office 365 workloads in the last 7 days. Has configurable filter for known good user agents such as PowerApps.,InitialAccess,T1078,P1D,P7D
,"New PA, PCA, or PCAS added to Azure DevOps",35ce9aff-1708-45b8-a295-5e9a307f5f17,Sentinel,Medium,Scheduled,"In order for an attacker to be able to conduct many potential attacks against Azure DevOps they will need to gain elevated permissions. 
This detection looks for users being granted key administrative permissions. If the principal of least privilege is applied, the number of 
users granted these permissions should be small. Note that permissions can also be granted via Azure AD groups and monitoring of these 
should also be conducted.",InitialAccess,T1078,P1D,P1D
,New user created and added to the built-in administrators group,aa1eff90-29d4-49dc-a3ea-b65199f516db,Sentinel,Low,Scheduled,"Identifies when a user account was created and then added to the builtin Administrators group in the same day.
This should be monitored closely and all additions reviewed.",Persistence|PrivilegeEscalation,T1098|T1078,P1D,P1D
,New UserAgent observed in last 24 hours,b725d62c-eb77-42ff-96f6-bdc6745fc6e0,Sentinel,Low,Scheduled,"Identifies new UserAgents observed in the last 24 hours versus the previous 14 days. This detection
extracts words from user agents to build the baseline and determine rareity rather than perform a
direct comparison. This avoids FPs caused by version numbers and other high entropy user agent components.
These new UserAgents could be benign. However, in normally stable environments,
these new UserAgents could provide a starting point for investigating malicious activity.
Note: W3CIISLog can be noisy depending on the environment, however OfficeActivity and AWSCloudTrail are
usually stable with low numbers of detections.",InitialAccess|CommandAndControl|Execution,T1189|T1071|T1203,P1D,P14D
,NOBELIUM - Domain and IP IOCs - March 2021,bb8a3481-dd14-4e76-8dcc-bbec8776d695,Sentinel,Medium,Scheduled,"Identifies a match across various data feeds for domains and IP IOCs related to NOBELIUM.
 References: https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/",CommandAndControl,T1102,PT6H,PT6H
,"NOBELIUM - Domain, Hash and IP IOCs - May 2021",677da133-e487-4108-a150-5b926591a92b,Sentinel,Medium,Scheduled,"Identifies a match across various data feeds for domains, hashes and IP IOCs related to NOBELIUM.
Ref: https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/",CommandAndControl|Execution,T1102|T1204,PT6H,PT6H
,NOBELIUM - Script payload stored in Registry,00cb180c-08a8-4e55-a276-63fb1442d5b5,Sentinel,Medium,Scheduled,"This query idenifies when a process execution commandline indicates that a registry value is written to allow for later execution a malicious script
 References: https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/",Execution,T1059,P1D,P1D
,NOBELIUM - suspicious rundll32.exe execution of vbscript,d82e1987-4356-4a7b-bc5e-064f29b143c0,Sentinel,Medium,Scheduled,"This query idenifies when rundll32.exe executes a specific set of inline VBScript commands
 References: https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/",Persistence,T1547,P1D,P1D
,NOBELIUM - suspicious rundll32.exe execution of vbscript (Normalized Process Events),bdf04f58-242b-4729-b376-577c4bdf5d3a,Sentinel,Medium,Scheduled,"This query idenifies when rundll32.exe executes a specific set of inline VBScript commands
References: https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/
To use this analytics rule, make sure you have deployed the [ASIM normalization parsers](https://aka.ms/ASimProcessEvent)",Persistence,T1547,P1D,P1D
,NOBELIUM IOCs related to FoggyWeb backdoor,c37711a4-5f44-4472-8afc-0679bc0ef966,Sentinel,High,Scheduled,"Identifies a match across various data feeds for IOCs related to FoggyWeb backdoor by the threat actor NOBELIUM.
 FoggyWeb is a passive and highly targeted backdoor capable of remotely exfiltrating sensitive information from a compromised AD FS server.
 It can also receive additional malicious components from a command-and-control (C2) server and execute them on the compromised server.
 Reference: https://aka.ms/nobelium-foggy-web",Collection,T1005,PT6H,PT6H
,Non Domain Controller Active Directory Replication,b9d2eebc-5dcb-4888-8165-900db44443ab,Sentinel,High,Scheduled,"This query detects potential attempts by non-computer accounts (non domain controllers) to retrieve/synchronize an active directory object leveraging directory replication services (DRS).
A Domain Controller (computer account) would usually be performing these actions in a domain environment. Another detection rule can be created to cover domain controllers accounts doing at rare times.
A domain user with privileged permissions to use directory replication services is rare. Ref: https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-180815210510.html",CredentialAccess,T1003,P1D,P7D
,NRT Authentication Methods Changed for VIP Users,29e99017-e28d-47be-8b9a-c8c711f8a903,Sentinel,Medium,NRT,Identifies authentication methods being changed for a list of VIP users watchlist. This could be an indication of an attacker adding an auth method to the account so they can have continued access.,Persistence,T1098,,
,NRT Azure Active Directory Hybrid Health AD FS New Server,ec491363-5fe7-4eff-b68e-f42dcb76fcf6,Sentinel,Medium,NRT,"This detection uses AzureActivity logs (Administrative category) to identify the creation or update of a server instance in an Azure AD Hybrid health AD FS service.
A threat actor can create a new AD Health ADFS service and create a fake server instance to spoof AD FS signing logs. There is no need to compromise an on-prem AD FS server.
This can be done programmatically via HTTP requests to Azure. More information in this blog: https://o365blog.com/post/hybridhealthagent/",DefenseEvasion,T1578,,
,NRT Azure DevOps Audit Stream Disabled,74ed028d-e392-40b7-baef-e69627bf89d1,Sentinel,High,NRT,"Azure DevOps allow for audit logs to be streamed to external storage solutions such as SIEM solutions. An attacker looking to hide malicious Azure DevOps activity from defenders may look to disable data streams 
 before conducting activity and then re-enabling the stream after (so as not to raise data threshold-based alarms). Looking for disabled audit streams can identify this activity, and due to the nature of the action 
 its unlikely to have a high false positive rate.",DefenseEvasion,T1562,,
,NRT Base64 encoded Windows process command-lines,c3e5dbaa-a540-408c-8b36-68bdfb3df088,Sentinel,Medium,NRT,Identifies instances of a base64 encoded PE file header seen in the process command line parameter.,Execution|DefenseEvasion,T1059|T1027|T1140,,
,NRT Creation of expensive computes in Azure,56fe0db0-6779-46fa-b3c5-006082a53064,Sentinel,Medium,NRT,"Identifies the creation of large size/expensive VMs (GPU or with large no of virtual CPUs) in Azure.
Adversary may create new or update existing virtual machines sizes to evade defenses 
or use it for cryptomining purposes.
For Windows/Linux Vm Sizes - https://docs.microsoft.com/azure/virtual-machines/windows/sizes 
Azure VM Naming Conventions - https://docs.microsoft.com/azure/virtual-machines/vm-naming-conventions",DefenseEvasion,T1578,,
,NRT DNS events related to mining pools,d5b32cd4-2328-43da-ab47-cd289c1f5efc,Sentinel,Low,NRT,Identifies IP addresses that may be performing DNS lookups associated with common currency mining pools.,Impact,T1496,,
,NRT First access credential added to Application or Service Principal where no credential was present,b6988c32-4f3b-4a45-8313-b46b33061a74,Sentinel,Medium,NRT,"This will alert when an admin or app owner account adds a new credential to an Application or Service Principal where there was no previous verify KeyCredential associated.
If a threat actor obtains access to an account with sufficient privileges and adds the alternate authentication material triggering this event, the threat actor can now authenticate as the Application or Service Principal using this credential.
Additional information on OAuth Credential Grants can be found in RFC 6749 Section 4.4 or https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow
For further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities.",DefenseEvasion,T1550,,
,NRT GitHub Two Factor Auth Disable,594c653d-719a-4c23-b028-36e3413e632e,Sentinel,Medium,NRT,"Two-factor authentication is a process where a user is prompted during the sign-in process for an additional form of identification, such as to enter a code on their cellphone or to provide a fingerprint scan. Two factor authentication reduces the risk of account takeover. Attacker will want to disable such security tools in order to go undetected. ",DefenseEvasion,T1562,,
,NRT Login to AWS Management Console without MFA,0ee2aafb-4500-4e36-bcb1-e90eec2f0b9b,Sentinel,Low,NRT,"Multi-Factor Authentication (MFA) helps you to prevent credential compromise. This alert identifies logins to the AWS Management Console without MFA.
You can limit this detection to trigger for administrative accounts if you do not have MFA enabled on all accounts.
This is done by looking at the eventName ConsoleLogin and if the AdditionalEventData field indicates MFA was NOT used
and the ResponseElements field indicates NOT a Failure. Thereby indicating that a non-MFA login was successful.",DefenseEvasion|PrivilegeEscalation|Persistence|InitialAccess,T1078,,
,NRT Malicious Inbox Rule,b79f6190-d104-4691-b7db-823e05980895,Sentinel,Medium,NRT,"Often times after the initial compromise the attackers create inbox rules to delete emails that contain certain keywords.
 This is done so as to limit ability to warn compromised users that they've been compromised. Below is a sample query that tries to detect this.
Reference: https://www.reddit.com/r/sysadmin/comments/7kyp0a/recent_phishing_attempts_my_experience_and_what/",Persistence|DefenseEvasion,T1098|T1078,,
,NRT MFA Rejected by User,3617d76d-b15e-4c6f-985e-a1dac73c592d,Sentinel,Medium,NRT,"Identifies occurrences where a user has rejected an MFA prompt. This could be an indicator that a threat actor has compromised the username and password of this user account and is using it to try and log into the account.
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-user-accounts#monitoring-for-failed-unusual-sign-ins",InitialAccess,T1078,,
,NRT Modified domain federation trust settings,8540c842-5bbc-4a24-9fb2-a836c0e55a51,Sentinel,High,NRT,"This will alert when a user or application modifies the federation settings on the domain or Update domain authentication from Managed to Federated.
For example, this alert will trigger when a new Active Directory Federated Service (ADFS) TrustedRealm object, such as a signing certificate, is added to the domain.
Modification to domain federation settings should be rare. Confirm the added or modified target domain/URL is legitimate administrator behavior.
To understand why an authorized user may update settings for a federated domain in Office 365, Azure, or Intune, see: https://docs.microsoft.com/office365/troubleshoot/active-directory/update-federated-domain-office-365.
For details on security realms that accept security tokens, see the ADFS Proxy Protocol (MS-ADFSPP) specification: https://docs.microsoft.com/openspecs/windows_protocols/ms-adfspp/e7b9ea73-1980-4318-96a6-da559486664b.
For further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities.",CredentialAccess,,,
,NRT Multiple users email forwarded to same destination,3b05727d-a8d1-477d-bbdd-d957da96ac7b,Sentinel,Medium,NRT,"Identifies when multiple (more than one) users mailboxes are configured to forward to the same destination.
This could be an attacker-controlled destination mailbox configured to collect mail from multiple compromised user accounts.",Collection|Exfiltration,T1114|T1020,,
,NRT New access credential added to Application or Service Principal,e42e889a-caaf-4dbb-aec6-371b37d64298,Sentinel,Medium,NRT,"This will alert when an admin or app owner account adds a new credential to an Application or Service Principal where a verify KeyCredential was already present for the app.
If a threat actor obtains access to an account with sufficient privileges and adds the alternate authentication material triggering this event, the threat actor can now authenticate as the Application or Service Principal using this credential.
Additional information on OAuth Credential Grants can be found in RFC 6749 Section 4.4 or https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow
For further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities.",DefenseEvasion,T1550,,
,NRT PIM Elevation Request Rejected,5db427b2-f406-4274-b413-e9fcb29412f8,Sentinel,High,NRT,"Identifies when a user is rejected for a privileged role elevation via PIM. Monitor rejections for indicators of attacker compromise of the requesting account.
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-identity-management",Persistence,T1078,,
,NRT Privileged Role Assigned Outside PIM,14f6da04-2f96-44ee-9210-9ccc1be6401e,Sentinel,Low,NRT,"Identifies a privileged role being assigned to a user outside of PIM
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-accounts#things-to-monitor-1",PrivilegeEscalation,T1078,,
,NRT Process executed from binary hidden in Base64 encoded file,7ad4c32b-d0d2-411c-a0e8-b557afa12fce,Sentinel,Medium,NRT,"Encoding malicious software is a technique used to obfuscate files from detection.
The first CommandLine component is looking for Python decoding base64.
The second CommandLine component is looking for Bash/sh command line base64 decoding.
The third one is looking for Ruby decoding base64.",Execution|DefenseEvasion,T1059|T1027|T1140,,
,NRT Security Event log cleared,508cef41-2cd8-4d40-a519-b04826a9085f,Sentinel,Medium,NRT,"Checks for event id 1102 which indicates the security event log was cleared.
It uses Event Source Name ""Microsoft-Windows-Eventlog"" to avoid generating false positives from other sources, like AD FS servers for instance.",DefenseEvasion,T1070,,
,NRT Sensitive Azure Key Vault operations,884ead54-cb3f-4676-a1eb-b26532d6cbfd,Sentinel,Low,NRT,"Identifies when sensitive Azure Key Vault operations are used. This includes: VaultDelete, KeyDelete, SecretDelete, SecretPurge, KeyPurge, SecretBackup, KeyBackup.
Any Backup operations should match with expected scheduled backup activity.",Impact,T1485,,
,NRT Squid proxy events related to mining pools,dd03057e-4347-4853-bf1e-2b2d21eb4e59,Sentinel,Low,NRT,"Checks for Squid proxy events in Syslog associated with common mining pools .This query presumes the default Squid log format is being used.
 http://www.squid-cache.org/Doc/config/access_log/",CommandAndControl,T1102,,
,NRT User added to Azure Active Directory Privileged Groups,70fc7201-f28e-4ba7-b9ea-c04b96701f13,Sentinel,Medium,NRT,"This will alert when a user is added to any of the Privileged Groups.
For further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities.
For Administrator role permissions in Azure Active Directory please see https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles",Persistence|PrivilegeEscalation,T1098|T1078,,
,Office policy tampering,fbd72eb8-087e-466b-bd54-1ca6ea08c6d3,Sentinel,Medium,Scheduled,"Identifies if any tampering is done to either auditlog, ATP Safelink, SafeAttachment, AntiPhish or Dlp policy. 
An adversary may use this technique to evade detection or avoid other policy based defenses.
References: https://docs.microsoft.com/powershell/module/exchange/advanced-threat-protection/remove-antiphishrule?view=exchange-ps.",Persistence|DefenseEvasion,T1098|T1562,P1D,P1D
,OMI Vulnerability Exploitation,3cc5ccd8-b416-4141-bb2d-4eba370e37a5,Sentinel,Medium,Scheduled,"Following the September 14th, 2021 release of three Elevation of Privilege
(EoP) vulnerabilities (CVE-2021-38645, CVE-2021-38649, CVE-2021-38648) and one
unauthenticated Remote Code Execution (RCE) vulnerability (CVE-2021-38647) in
the Open Management Infrastructure (OMI) Framework.
This detection validates that any OMS-agent that is reporting to the Microsoft
Sentinel workspace is updated with the patch. The detection will go over the
heartbeats received from all agents over the last day and will create alert
for those agents who are not updated.",InitialAccess,,P1D,P1D
,Palo Alto - possible internal to external port scanning,5b72f527-e3f6-4a00-9908-8e4fee14da9f,Sentinel,Low,Scheduled,"Identifies a list of internal Source IPs (10.x.x.x Hosts) that have triggered 10 or more non-graceful tcp server resets from one or more Destination IPs which 
results in an ""ApplicationProtocol = incomplete"" designation. The server resets coupled with an ""Incomplete"" ApplicationProtocol designation can be an indication 
of internal to external port scanning or probing attack. 
References: https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClUvCAK and
https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClTaCAK",Discovery,T1046,PT1H,PT1H
,Palo Alto - potential beaconing detected,f0be259a-34ac-4946-aa15-ca2b115d5feb,Sentinel,Low,Scheduled,"Identifies beaconing patterns from Palo Alto Network traffic logs based on recurrent timedelta patterns. 
The query leverages various KQL functions to calculate time deltas and then compares it with total events observed in a day to find percentage of beaconing. 
This outbound beaconing pattern to untrusted public networks should be investigated for any malware callbacks or data exfiltration attempts.
Reference Blog:
http://www.austintaylor.io/detect/beaconing/intrusion/detection/system/command/control/flare/elastic/stack/2017/06/10/detect-beaconing-with-flare-elasticsearch-and-intrusion-detection-systems/
https://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/detect-network-beaconing-via-intra-request-time-delta-patterns/ba-p/779586",CommandAndControl,T1071|T1571,P1D,P2D
,Palo Alto Threat signatures from Unusual IP addresses,89a86f70-615f-4a79-9621-6f68c50f365f,Sentinel,Medium,Scheduled,"Identifies Palo Alto Threat signatures from unusual IP addresses which are not historically seen. 
This detection is also leveraged and required for MDE and PAN Fusion scenario
https://docs.microsoft.com/Azure/sentinel/fusion-scenario-reference#network-request-to-tor-anonymization-service-followed-by-anomalous-traffic-flagged-by-palo-alto-networks-firewall",Discovery|Exfiltration|CommandAndControl,T1046|T1030|T1071,PT1H,P7D
,Password spray attack against ADFSSignInLogs,5170c3c4-b8c9-485c-910d-a21d965ee181,Sentinel,Medium,Scheduled,"Identifies evidence of password spray activity against Connect Health for AD FS sign-in events by looking for failures from multiple accounts from the same IP address within a time window.
Reference: https://adfshelp.microsoft.com/References/ConnectHealthErrorCodeReference",CredentialAccess,T1110,PT30M,PT1H
,Password spray attack against Azure AD application,48607a29-a26a-4abf-8078-a06dbdd174a4,Sentinel,Medium,Scheduled,"Identifies evidence of password spray activity against Azure AD applications by looking for failures from multiple accounts from the same
IP address within a time window. If the number of accounts breaches the threshold just once, all failures from the IP address within the time range
are bought into the result. Details on whether there were successful authentications by the IP address within the time window are also included.
This can be an indicator that an attack was successful.
The default failure acccount threshold is 5, Default time window for failures is 20m and default look back window is 3 days
Note: Due to the number of possible accounts involved in a password spray it is not possible to map identities to a custom entity.
References: https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-sign-ins-error-codes.",CredentialAccess,T1110,P1D,P7D
,Password spray attack against Azure AD Seamless SSO,fb7ca1c9-e14c-40a3-856e-28f3c14ea1ba,Sentinel,Medium,Scheduled,"This query detects when there is a spike in Azure AD Seamless SSO errors. They may not be caused by a Password Spray attack, but the cause of the errors might need to be investigated.
Azure AD only logs the requests that matched existing accounts, thus there might have been unlogged requests for non-existing accounts.",CredentialAccess,T1110,PT1H,PT1H
,PE file dropped in Color Profile Folder,f68a5046-b7eb-4f69-9519-1e99708bb9e0,Sentinel,Medium,Scheduled,"This query looks for writes of PE files to C:\Windows\System32\spool\drivers\color\.
  This is a common directory used by malware, as well as some legitimate programs, and writes of PE files to the folder should be monitored.
  Ref: https://www.microsoft.com/security/blog/2022/07/27/untangling-knotweed-european-private-sector-offensive-actor-using-0-day-exploits/",Execution,T1203,P1D,P1D
,PIM Elevation Request Rejected,7d7e20f8-3384-4b71-811c-f5e950e8306c,Sentinel,High,Scheduled,"Identifies when a user is rejected for a privileged role elevation via PIM. Monitor rejections for indicators of attacker compromise of the requesting account.
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-identity-management",Persistence,T1078,PT2H,PT2H
,Port scan detected  (ASIM Network Session schema),1da9853f-3dea-4ea9-b7e5-26730da3d537,Sentinel,Medium,Scheduled,"This rule identifies a possible port scan, in which a single source tries to access a large number of different ports is a short time frame. This may indicate that a [port scanner](https://en.wikipedia.org/wiki/Port_scanner) is trying to identify open ports in order to penetrate a system.<br><br>
This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM NetworkSession schema",Discovery,T1046,PT1H,PT1H
,Possible contact with a domain generated by a DGA,4acd3a04-2fad-4efc-8a4b-51476594cec4,Sentinel,Medium,Scheduled,"Identifies contacts with domains names in CommonSecurityLog that might have been generated by a Domain Generation Algorithm (DGA). DGAs can be used
by malware to generate rendezvous points that are difficult to predict in advance. This detection uses the Alexa Top 1 million domain names to build a model
of what normal domains look like. It uses this to identify domains that may have been randomly generated by an algorithm.
The triThreshold is set to 500 - increase this to report on domains that are less likely to have been randomly generated, decrease it for more likely.
The start time and end time look back over 6 hours of data and the dgaLengthThreshold is set to 8 - meaning domains whose length is 8 or more are reported.",CommandAndControl,T1568,PT6H,PT6H
,Possible Resource-Based Constrained Delegation Abuse,2937bc6b-7cda-4fba-b452-ea43ba8e835f,Sentinel,Medium,Scheduled,"This query identifies Active Directory computer objects modifications that allow an adversary to abuse the Resource-based constrained delegation. 
This query checks for event id 5136 that the Object Class field is ""computer"" and the LDAP Display Name is ""msDS-AllowedToActOnBehalfOfOtherIdentity"" which is an indicator of Resource-based constrained delegation.
Ref: https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html",PrivilegeEscalation,T1134,PT1H,PT1H
,Possible STRONTIUM attempted credential harvesting - Oct 2020,68271db2-cbe9-4009-b1d3-bb3b5fe5713c,Sentinel,Low,Scheduled,Surfaces potential STRONTIUM group Office365 credential harvesting attempts within OfficeActivity Logon events.,CredentialAccess,T1110,P7D,P14D
,Possible STRONTIUM attempted credential harvesting - Sept 2020,04384937-e927-4595-8f3c-89ff58ed231f,Sentinel,Low,Scheduled,"Surfaces potential STRONTIUM group Office365 credential harvesting attempts within OfficeActivity Logon events.
References: https://www.microsoft.com/security/blog/2020/09/10/strontium-detecting-new-patters-credential-harvesting/.",CredentialAccess,T1110,P7D,P14D
,Potential beaconing activity (ASIM Network Session schema),fcb9d75c-c3c1-4910-8697-f136bfef2363,Sentinel,Low,Scheduled,"This rule identifies beaconing patterns from Network traffic logs based on recurrent frequency patterns. Such potential outbound beaconing pattern to untrusted public networks should be investigated for any malware callbacks or data exfiltration attempts as discussed in this [Blog](http://www.austintaylor.io/detect/beaconing/intrusion/detection/system/command/control/flare/elastic/stack/2017/06/10/detect-beaconing-with-flare-elasticsearch-and-intrusion-detection-systems/).\<br><br>
This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM NetworkSession schema",CommandAndControl,T1071|T1571,P1D,P2D
,Potential Build Process Compromise,5ef06767-b37c-4818-b035-47de950d0046,Sentinel,Medium,Scheduled,"The query looks for source code files being modified immediately after a build process is started. The purpose of this is to look for malicious code injection during the build process.
More details: https://techcommunity.microsoft.com/t5/azure-sentinel/monitoring-the-software-supply-chain-with-azure-sentinel/ba-p/2176463",Persistence,T1554,P1D,P1D
,Potential Build Process Compromise - MDE,1bf6e165-5e32-420e-ab4f-0da8558a8be2,Sentinel,Medium,Scheduled,"The query looks for source code files being modified immediately after a build process is started. The purpose of this is to look for malicious code injection during the build process. This query uses Microsoft Defender for Endpoint telemetry.
More details: https://techcommunity.microsoft.com/t5/azure-sentinel/monitoring-the-software-supply-chain-with-azure-sentinel/ba-p/2176463",Persistence,T1554,P1D,P1D
,Potential communication with a Domain Generation Algorithm (DGA) based hostname (ASIM Web Session schema),9176b18f-a946-42c6-a2f6-0f6d17cd6a8a,Sentinel,Medium,Scheduled,"This rule identifies communication with hosts that have a domain name that might have been generated by a Domain Generation Algorithm (DGA). DGAs are used by malware to generate rendezvous points that are difficult to predict in advance. This detection uses the top 1 million domain names to build a model of what normal domains look like nad uses the model to identify domains that may have been randomly generated by an algorithm. You can modify the triThreshold and dgaLengthThreshold query parameters to change Analytic Rule sensitivity. The higher the numbers, the less noisy the rule is. <br>
 This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM WebSession schema (ASIM WebSession Schema)",CommandAndControl,T1568,PT6H,PT6H
,Potential DGA detected,a0907abe-6925-4d90-af2b-c7e89dc201a6,Sentinel,Medium,Scheduled,"Identifies clients with a high NXDomain count which could be indicative of a DGA (cycling through possible C2 domains
where most C2s are not live). Alert is generated when a new IP address is seen (based on not being seen associated with
NXDomain records in prior 10-day baseline period).",CommandAndControl,T1568|T1008,P1D,P10D
,Potential DGA detected (ASIM DNS Schema),983a6922-894d-413c-9f04-d7add0ecc307,Sentinel,Medium,Scheduled,"Identifies clients with a high NXDomain count which could be indicative of a DGA (cycling through possible C2 domains
where most C2s are not live). Alert is generated when a new IP address is seen (based on not being seen associated with 
NXDomain records in prior 10-day baseline period).
This analytic rule uses [ASIM](https://aka.ms/AboutASIM) and supports any built-in or custom source that supports the ASIM DNS schema",CommandAndControl,T1568|T1008,P1D,P10D
,Potential Fodhelper UAC Bypass,56f3f35c-3aca-4437-a1fb-b7a84dc4af00,Sentinel,Medium,Scheduled,This detection looks for the steps required to conduct a UAC bypass using Fodhelper.exe. By default this detection looks for the setting of the required registry keys and the invoking of the process within 1 hour - this can be tweaked as required.,PrivilegeEscalation,T1548,PT2H,PT2H
,Potential Fodhelper UAC Bypass (ASIM Version),ac9e233e-44d4-45eb-b522-6e47445f6582,Sentinel,Medium,Scheduled,This detection looks for the steps required to conduct a UAC bypass using Fodhelper.exe. By default this detection looks for the setting of the required registry keys and the invoking of the process within 1 hour - this can be tweaked as required.,PrivilegeEscalation,T1548,PT2H,PT2H
,Potential Kerberoasting,1572e66b-20a7-4012-9ec4-77ec4b101bc8,Sentinel,Medium,Scheduled,"A service principal name (SPN) is used to uniquely identify a service instance in a Windows environment.
Each SPN is usually associated with a service account. Organizations may have used service accounts with weak passwords in their environment.
An attacker can try requesting Kerberos ticket-granting service (TGS) service tickets for any SPN from a domain controller (DC) which contains
a hash of the Service account. This can then be used for offline cracking. This hunting query looks for accounts that are generating excessive
requests to different resources within the last hour compared with the previous 24 hours.  Normal users would not make an unusually large number
of request within a small time window. This is based on 4769 events which can be very noisy so environment based tweaking might be needed.",CredentialAccess,T1558,PT1H,P1D
,Potential Password Spray Attack (Uses Authentication Normalization),6a2e2ff4-5568-475e-bef2-b95f12b9367b,Sentinel,Medium,Scheduled,"This query searches for failed attempts to log in from more than 15 various users within a 5 minute timeframe from the same source. This is a potential indication of a password spray attack
 To use this analytics rule, make sure you have deployed the [ASIM normalization parsers](https://aka.ms/ASimAuthentication)",CredentialAccess,T1110,PT1H,PT1H
,Potential re-named sdelete usage,720d12c6-a08c-44c4-b18f-2236412d59b0,Sentinel,Low,Scheduled,"This detection looks for command line parameters associated with the use of Sysinternals sdelete (https://docs.microsoft.com/sysinternals/downloads/sdelete) to delete multiple files on a host's C drive.
A threat actor may re-name the tool to avoid detection and then use it for destructive attacks on a host.",DefenseEvasion|Impact,T1485|T1036,PT1H,PT1H
,Potential re-named sdelete usage (ASIM Version),5b6ae038-f66e-4f74-9315-df52fd492be4,Sentinel,Low,Scheduled,"This detection looks for command line parameters associated with the use of Sysinternals sdelete (https://docs.microsoft.com/sysinternals/downloads/sdelete) to delete multiple files on a host's C drive.
A threat actor may re-name the tool to avoid detection and then use it for destructive attacks on a host.
This detection uses the ASIM imProcess parser, this will need to be deployed before use - https://docs.microsoft.com/azure/sentinel/normalization",DefenseEvasion|Impact,T1485|T1036,PT1H,PT1H
,Potential Remote Desktop Tunneling,d2e8fd50-8d66-11ec-b909-0242ac120002,Sentinel,Medium,Scheduled,"This query detects remote desktop authentication attempts with a localhost source address which can indicate a tunneled login.
Ref: https://www.mandiant.com/resources/bypassing-network-restrictions-through-rdp-tunneling",CommandAndControl,T1572,PT1H,PT1H
,Powershell Empire cmdlets seen in command line,ef88eb96-861c-43a0-ab16-f3835a97c928,Sentinel,Medium,Scheduled,Identifies instances of PowerShell Empire cmdlets in powershell process command line data.,Execution|Persistence,,PT12H,PT12H
,Prestige ransomware IOCs Oct 2022,bca9c877-2afc-4246-a26d-087ab1cdcd5f,Sentinel,High,Scheduled,"This query looks for file hashes and AV signatures associated with Prestige ransomware 
payload.",Execution,T1203,P1D,P1D
,Privileged Account Permissions Changed,0433c8a3-9aa6-4577-beef-2ea23be41137,Sentinel,Medium,Scheduled,"Detects changes to permissions assigned to admin users. Threat actors may try and increase permission scope by adding additional roles to already privileged accounts.
Review any modifications to ensure they were made legitimately.
Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-accounts#changes-to-privileged-accounts",PrivilegeEscalation,T1078,P1D,P2D
,Privileged Accounts - Sign in Failure Spikes,34c5aff9-a8c2-4601-9654-c7e46342d03b,Sentinel,High,Scheduled," Identifies spike in failed sign-ins from Privileged accounts. Privileged accounts list can be based on IdentityInfo UEBA table or built-in watchlist.
Spike is determined based on Time series anomaly which will look at historical baseline values.
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-accounts#things-to-monitor",InitialAccess,T1078,P1D,P14D
,Privileged Role Assigned Outside PIM,269435e3-1db8-4423-9dfc-9bf59997da1c,Sentinel,Low,Scheduled,"Identifies a privileged role being assigned to a user outside of PIM
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-accounts#things-to-monitor-1",PrivilegeEscalation,T1078,P1D,P1D
,Privileged User Logon from new ASN,55073036-bb86-47d3-a85a-b113ac3d9396,Sentinel,Medium,Scheduled,"Detects a successful logon by a privileged account from an ASN not logged in from in the last 14 days.
  Monitor these logons to ensure they are legitimate and identify if there are any similar sign ins.",DefenseEvasion,T1078,P1D,P7D
,Probable AdFind Recon Tool Usage,c63ae777-d5e0-4113-8c9a-c2c9d3d09fcd,Sentinel,High,Scheduled,Identifies the host and account that executed AdFind by hash and filename in addition to common and unique flags that are used by many threat actors in discovery.,Discovery,T1018,PT1H,PT1H
,Probable AdFind Recon Tool Usage (Normalized Process Events),45076281-35ae-45e0-b443-c32aa0baf965,Sentinel,High,Scheduled,"Identifies the host and account that executed AdFind by hash and filename in addition to common and unique flags that are used by many threat actors in discovery.
To use this analytics rule, make sure you have deployed the [ASIM normalization parsers](https://aka.ms/ASimProcessEvent)",Discovery,T1018,PT1H,PT1H
,Process executed from binary hidden in Base64 encoded file,d6190dde-8fd2-456a-ac5b-0a32400b0464,Sentinel,Medium,Scheduled,"Encoding malicious software is a technique used to obfuscate files from detection. 
The first CommandLine component is looking for Python decoding base64. 
The second CommandLine component is looking for Bash/sh command line base64 decoding.
The third one is looking for Ruby decoding base64.",Execution|DefenseEvasion,T1059|T1027|T1140,P1D,P1D
,Process execution frequency anomaly,2c55fe7a-b06f-4029-a5b9-c54a2320d7b8,Sentinel,Medium,Scheduled,"Identifies anomalous spike in frequency of executions of sensitive processes which are often leveraged as attack vectors.
The query leverages KQL built-in anomaly detection algorithms to find large deviations from baseline patterns.
Sudden increases in execution frequency of sensitive processes should be further investigated for malicious activity.
Tune the values from 1.5 to 3 in series_decompose_anomalies for further outliers or based on custom threshold values for score.",Execution,T1059,P1D,P14D
,ProofpointPOD - Binary file in attachment,eb68b129-5f17-4f56-bf6d-dde48d5e615a,Sentinel,Medium,Scheduled,Detects when email received with binary file as attachment.,InitialAccess,T1078,PT10M,PT10M
,ProofpointPOD - Email sender in TI list,35a0792a-1269-431e-ac93-7ae2980d4dde,Sentinel,Medium,Scheduled,Email sender in TI list.,Exfiltration|InitialAccess,T1078|T1567,P1D,P14D
,ProofpointPOD - Email sender IP in TI list,78979d32-e63f-4740-b206-cfb300c735e0,Sentinel,Medium,Scheduled,Email sender IP in TI list.,Exfiltration|InitialAccess,T1078|T1567,P1D,P14D
,ProofpointPOD - High risk message not discarded,c7cd6073-6d2c-4284-a5c8-da27605bdfde,Sentinel,Low,Scheduled,Detects when email with high risk score was not rejected or discarded by filters.,InitialAccess,T1566,PT10M,PT10M
,ProofpointPOD - Multiple archived attachments to the same recipient,bda5a2bd-979b-4828-a91f-27c2a5048f7f,Sentinel,Medium,Scheduled,Detects when multiple emails where sent to the same recipient with large archived attachments.,Exfiltration,T1567,PT30M,PT30M
,ProofpointPOD - Multiple large emails to the same recipient,d1aba9a3-5ab1-45ef-8ed4-da57dc3c0d32,Sentinel,Medium,Scheduled,Detects when multiple emails with large size where sent to the same recipient.,Exfiltration,T1567,PT30M,PT30M
,ProofpointPOD - Multiple protected emails to unknown recipient,f8127962-7739-4211-a4a9-390a7a00e91f,Sentinel,Medium,Scheduled,Detects when multiple protected messages where sent to early not seen recipient.,Exfiltration,T1567,PT30M,PT30M
,ProofpointPOD - Possible data exfiltration to private email,aedc5b33-2d7c-42cb-a692-f25ef637cbb1,Sentinel,Medium,Scheduled,Detects when sender sent email to the non-corporate domain and recipient's username is the same as sender's username.,InitialAccess,T1078,PT10M,PT10M
,ProofpointPOD - Suspicious attachment,f6a51e2c-2d6a-4f92-a090-cfb002ca611f,Sentinel,Medium,Scheduled,Detects when email contains suspicious attachment (file type).,InitialAccess,T1566,PT10M,PT10M
,ProofpointPOD - Weak ciphers,56b0a0cd-894e-4b38-a0a1-c41d9f96649a,Sentinel,Low,Scheduled,Detects when weak TLS ciphers are used.,CommandAndControl,T1573,PT1H,PT1H
,PulseConnectSecure - CVE-2021-22893 Possible Pulse Connect Secure RCE Vulnerability Attack,d0c82b7f-40b2-4180-a4d6-7aa0541b7599,Sentinel,High,Scheduled,This query identifies exploitation attempts using Pulse Connect Secure(PCS) vulnerability (CVE-2021-22893) to the VPN server,InitialAccess,T1190,PT1H,PT1H
,Rare and potentially high-risk Office operations,957cb240-f45d-4491-9ba5-93430a3c08be,Sentinel,Low,Scheduled,Identifies Office operations that are typically rare and can provide capabilities useful to attackers.,Persistence|Collection,T1098|T1114,P1D,P1D
,Rare application consent,83ba3057-9ea3-4759-bf6a-933f2e5bc7ee,Sentinel,Medium,Scheduled,"This will alert when the ""Consent to application"" operation occurs by a user that has not done this operation before or rarely does this.
This could indicate that permissions to access the listed Azure App were provided to a malicious actor.
Consent to application, Add service principal and Add OAuth2PermissionGrant should typically be rare events.
This may help detect the Oauth2 attack that can be initiated by this publicly available tool - https://github.com/fireeye/PwnAuth
For further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities.",Persistence|PrivilegeEscalation,T1136|T1068,P1D,P7D
,Rare client observed with high reverse DNS lookup count,15ae38a2-2e29-48f7-883f-863fb25a5a06,Sentinel,Medium,Scheduled,"Identifies clients with a high reverse DNS counts which could be carrying out reconnaissance or discovery activity.
Alert is generated if the IP performing such reverse DNS lookups was not seen doing so in the preceding 7-day period.",Discovery,T1046,P1D,P8D
,Rare RDP Connections,45b903c5-6f56-4969-af10-ae62ac709718,Sentinel,Medium,Scheduled,"Identifies when an RDP connection is new or rare related to any logon type by a given account today based on comparison with the previous 14 days.
RDP connections are indicated by the EventID 4624 with LogonType = 10",LateralMovement,T1021,P1D,P14D
,Rare subscription-level operations in Azure,23de46ea-c425-4a77-b456-511ae4855d69,Sentinel,Low,Scheduled,"This query looks for a few sensitive subscription-level events based on Azure Activity Logs.
 For example this monitors for the operation name 'Create or Update Snapshot' which is used for creating backups but could be misused by attackers
 to dump hashes or extract sensitive information from the disk.",CredentialAccess|Persistence,T1003|T1098,P1D,P14D
,RDP Nesting,69a45b05-71f5-45ca-8944-2e038747fb39,Sentinel,Medium,Scheduled,"Identifies when an RDP connection is made to a first system and then an RDP connection is made from the first system
to another system with the same account within the 60 minutes. Additionally, if historically daily
RDP connections are indicated by the logged EventID 4624 with LogonType = 10",LateralMovement,T1021,P1D,P8D
,Registry Persistence via AppCert DLL Modification,c61ad0ac-ad68-4ebb-b41a-74296d3e0044,Sentinel,Medium,Scheduled,"Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by AppCert DLLs loaded into processes. 
Dynamic-link libraries (DLLs) that are specified in the AppCertDLLs Registry key under HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\ are loaded into every process that calls the ubiquitously used application programming interface (API) functions CreateProcess, CreateProcessAsUser, CreateProcessWithLoginW, CreateProcessWithTokenW, or WinExec.
Ref: https://attack.mitre.org/techniques/T1546/009/",Persistence,T1546,PT1H,PT1H
,Registry Persistence via AppInit DLLs Modification,9367dff0-941d-44e2-8875-cb48570c7add,Sentinel,Medium,Scheduled,"Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by AppInit DLLs loaded into processes. 
Dynamic-link libraries (DLLs) that are specified in the AppInit_DLLs value in the Registry keys HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Windows or HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows are loaded by user32.dll into every process that loads user32.dll. In practice this is nearly every program, since user32.dll is a very common library.
Ref: https://attack.mitre.org/techniques/T1546/010/",Persistence,T1546,PT1H,PT1H
,RunningRAT request parameters,baedfdf4-7cc8-45a1-81a9-065821628b83,Sentinel,High,Scheduled,"This detection will alert when RunningRAT URI parameters or paths are detect in an HTTP request. Id the device blocked this communication
presence of this alert means the RunningRAT implant is likely still executing on the source host.",Exfiltration|CommandAndControl,T1041|T1071,P1D,P1D
,Scheduled Task Hide,6dd2629c-534b-4275-8201-d7968b4fa77e,Sentinel,High,Scheduled,"This query detects attempts by malware to hide the scheduled task by deleting the SD (Security Descriptor) value. Removal of SD value results in the scheduled task disappearing from schtasks /query and Task Scheduler.
 The query requires auditing to be turned on for HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree registry hive as well as audit policy for registry auditing to be turned on.
 Reference: https://www.microsoft.com/security/blog/2022/04/12/tarrask-malware-uses-scheduled-tasks-for-defense-evasion/
 Reference: https://4sysops.com/archives/audit-changes-in-the-windows-registry/",DefenseEvasion,T1562,P1D,P1D
,Sdelete deployed via GPO and run recursively,d9f28fdf-abc8-4f1a-a7e7-1aaec87a2fc5,Sentinel,Medium,Scheduled,This query looks for the Sdelete process being run recursively after being deployed to a host via GPO. Attackers could use this technique to deploy Sdelete to multiple host and delete data on them.,Impact,T1485,P1D,P1D
,Sdelete deployed via GPO and run recursively (ASIM Version),30c8b802-ace1-4408-bc29-4c5c5afb49e1,Sentinel,Medium,Scheduled,"This query looks for the Sdelete process being run recursively after being deployed to a host via GPO. Attackers could use this technique to deploy Sdelete to multiple host and delete data on them.
  This query uses the Advanced Security Information Model. Parsers will need to be deployed before use: https://docs.microsoft.com/azure/sentinel/normalization",Impact,T1485,P1D,P1D
,SEABORGIUM C2 Domains August 2022,2149d9bb-8298-444c-8f99-f7bf0274dd05,Sentinel,High,Scheduled,Identifies a match across various data feeds for domains related to an actor tracked by Microsoft as SEABORGIUM.,InitialAccess,T1566,P1D,P1D
,Security Event log cleared,80da0a8f-cfe1-4cd0-a895-8bc1771a720e,Sentinel,Medium,Scheduled,"Checks for event id 1102 which indicates the security event log was cleared.
It uses Event Source Name ""Microsoft-Windows-Eventlog"" to avoid generating false positives from other sources, like AD FS servers for instance.",DefenseEvasion,T1070,P1D,P1D
,Security Service Registry ACL Modification,473d57e6-f787-435c-a16b-b38b51fa9a4b,Sentinel,High,Scheduled,"Identifies attempts to modify registry ACL to evade security solutions. In the Solorigate attack, the attackers were found modifying registry permissions so services.exe cannot access the relevant registry keys to start the service.
 The detection leverages Security Event as well as MDE data to identify when specific security services registry permissions are modified. 
 Only some portions of this detection are related to Solorigate, it also includes coverage for some common tools that perform this activity. 
 Reference on guidance for enabling registry auditing:
 - https://docs.microsoft.com/windows/security/threat-protection/auditing/advanced-security-auditing-faq
 - https://docs.microsoft.com/windows/security/threat-protection/auditing/appendix-a-security-monitoring-recommendations-for-many-audit-events
 - https://docs.microsoft.com/windows/security/threat-protection/auditing/audit-registry
 - https://docs.microsoft.com/windows/security/threat-protection/auditing/event-4670
   - For the event 4670 to be created the audit policy for the registry must have auditing enabled for Write DAC and/or Write Owner
 - https://github.com/OTRF/Set-AuditRule 
 - https://docs.microsoft.com/dotnet/api/system.security.accesscontrol.registryrights?view=dotnet-plat-ext-5.0",DefenseEvasion,T1562,P1D,P1D
,SecurityEvent - Multiple authentication failures followed by a success,cf3ede88-a429-493b-9108-3e46d3c741f7,Sentinel,Low,Scheduled,"Identifies accounts who have failed to logon to the domain multiple times in a row, followed by a successful authentication
within a short time frame. Multiple failed attempts followed by a success can be an indication of a brute force attempt or
possible mis-configuration of a service account within an environment.
The lookback is set to 6h and the authentication window and threshold are set to 1h and 5, meaning we need to see a minimum
of 5 failures followed by a success for an account within 1 hour to surface an alert.",CredentialAccess,T1110,PT6H,PT6H
,Sensitive Azure Key Vault operations,d6491be0-ab2d-439d-95d6-ad8ea39277c5,Sentinel,Low,Scheduled,"Identifies when sensitive Azure Key Vault operations are used. This includes: VaultDelete, KeyDelete, SecretDelete, SecretPurge, KeyPurge, SecretBackup, KeyBackup.
Any Backup operations should match with expected scheduled backup activity.",Impact,T1485,P1D,P1D
,Service Principal Assigned App Role With Sensitive Access,dd78a122-d377-415a-afe9-f22e08d2112c,Sentinel,Medium,Scheduled,"Detects a Service Principal being assigned an app role that has sensitive access such as Mail.Read.
  A threat actor who compromises a Service Principal may assign it an app role to allow it to access sensitive data, or to perform other actions.
  Ensure that any assignment to a Service Principal is valid and appropriate.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-applications#application-granted-highly-privileged-permissions",PrivilegeEscalation,T1078,P1D,P1D
,Service Principal Assigned Privileged Role,84cccc86-5c11-4b3a-aca6-7c8f738ed0f7,Sentinel,Medium,Scheduled,"Detects a privileged role being added to a Service Principal.
  Ensure that any assignment to a Service Principal is valid and appropriate - Service Principals should not be assigned to very highly privileged roles such as Global Admin.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-accounts#changes-to-privileged-accounts",PrivilegeEscalation,T1078,P1D,P1D
,Service Principal Authentication Attempt from New Country,1baaaf00-655f-4de9-8ff8-312e902cda71,Sentinel,Medium,Scheduled,"Detects when there is a Service Principal login attempt from a country that has not seen a successful login in the previous 14 days.
  Threat actors may attempt to authenticate with credentials from compromised accounts - monitoring attempts from anomalous locations may help identify these attempts.
  Authentication attempts should be investigated to ensure the activity was legitimate and if there is other similar activity.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-user-accounts#monitoring-for-failed-unusual-sign-ins",InitialAccess,T1078,P1D,P14D
,Service Principal Name (SPN) Assigned to User Account,875d0eb1-883a-4191-bd0e-dbfdeb95a464,Sentinel,Medium,Scheduled,"This query identifies whether a Active Directory user object was assigned a service principal name which could indicate that an adversary is preparing for performing Kerberoasting. 
This query checks for event id 5136 that the Object Class field is ""user"" and the LDAP Display Name is ""servicePrincipalName"".
Ref: https://thevivi.net/assets/docs/2019/theVIVI-AD-Security-Workshop_AfricaHackon2019.pdf",PrivilegeEscalation,T1134,PT1H,PT1H
,Several deny actions registered,f8dad4e9-3f19-4d70-ab7f-8f19ccd43a3e,Sentinel,Medium,Scheduled,"Identifies attack pattern when attacker tries to move, or scan, from resource to resource on the network and creates an incident when a source has more than 1 registered deny action in Azure Firewall.",Discovery|LateralMovement|CommandAndControl,T1046|T1071|T1210,PT1H,PT1H
,SharePointFileOperation via devices with previously unseen user agents,5dd76a87-9f87-4576-bab3-268b0e2b338b,Sentinel,Medium,Scheduled,"Identifies if the number of documents uploaded or downloaded from device(s) associated
with a previously unseen user agent exceeds a threshold (default is 5).",Exfiltration,T1030,P1D,P14D
,SharePointFileOperation via previously unseen IPs,4b11568b-3f5f-4ba1-80c8-7f1dc8390eb7,Sentinel,Medium,Scheduled,"Identifies when the volume of documents uploaded to or downloaded from Sharepoint by new IP addresses
exceeds a threshold (default is 50).",Exfiltration,T1030,P1D,P14D
,Sign-ins from IPs that attempt sign-ins to disabled accounts,500c103a-0319-4d56-8e99-3cec8d860757,Sentinel,Medium,Scheduled,"Identifies IPs with failed attempts to sign in to one or more disabled accounts and where that same IP has had successful signins from other accounts.
This could indicate an attacker who obtained credentials for a list of accounts and is attempting to login with those accounts, some of which may have already been disabled.
References: https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-sign-ins-error-codes
50057 - User account is disabled. The account has been disabled by an administrator.",InitialAccess|Persistence,T1078|T1098,P1D,P1D
,Sign-ins from IPs that attempt sign-ins to disabled accounts (Uses Authentication Normalization),95002681-4ecb-4da3-9ece-26d7e5feaa33,Sentinel,Medium,Scheduled,"Identifies IPs with failed attempts to sign in to one or more disabled accounts signed in successfully to another account.
To use this analytics rule, make sure you have deployed the [ASIM normalization parsers](https://aka.ms/ASimAuthentication)",InitialAccess|Persistence,T1078|T1098,P1D,P1D
,Solorigate Defender Detections,e70fa6e0-796a-4e85-9420-98b17b0bb749,Sentinel,High,Scheduled,"Surfaces any Defender Alert for Solorigate Events. In Microsoft Sentinel the SecurityAlerts table includes only the Device Name of the affected device, this query joins the DeviceInfo table to clearly connect other information such as
 Device group, ip, logged on users etc. This way, the Microsoft Sentinel user can have all the pertinent device info in one view for all the the Solarigate Defender alerts.",InitialAccess,T1195,P1D,P1D
,Solorigate Domains Found in VM Insights,ab4b6944-a20d-42ab-8b63-238426525801,Sentinel,High,Scheduled,Identifies connections to Solorigate-related DNS records based on VM insights data,CommandAndControl,T1102,PT1H,PT1H
,Solorigate Named Pipe,11b4c19d-2a79-4da3-af38-b067e1273dee,Sentinel,High,Scheduled,"Identifies a match across various data feeds for named pipe IOCs related to the Solorigate incident.
 For the sysmon events required for this detection, logging for Named Pipe Events needs to be configured in Sysmon config (Event ID 17 and Event ID 18)
 Reference: https://techcommunity.microsoft.com/t5/azure-sentinel/solarwinds-post-compromise-hunting-with-azure-sentinel/ba-p/1995095",DefenseEvasion|PrivilegeEscalation,T1055,P1D,P1D
,Solorigate Network Beacon,cecdbd4c-4902-403c-8d4b-32eb1efe460b,Sentinel,High,Scheduled,"Identifies a match across various data feeds for domains IOCs related to the Solorigate incident.
 References: https://blogs.microsoft.com/on-the-issues/2020/12/13/customers-protect-nation-state-cyberattacks/, 
 https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html?1",CommandAndControl,T1102,PT6H,PT6H
,SOURGUM Actor IOC - July 2021,066395ac-ef91-4993-8bf6-25c61ab0ca5a,Sentinel,High,Scheduled,Identifies a match across IOC's related to an actor tracked by Microsoft as SOURGUM,Persistence,T1546,PT6H,PT6H
,SOURGUM Actor IOC - July 2021,94749332-1ad9-49dd-a5ab-5ff2170788fc,Sentinel,High,Scheduled,Identifies a match across IOC's related to an actor tracked by Microsoft as SOURGUM,Persistence,T1546,PT6H,PT6H
,Squid proxy events for ToR proxies,90d3f6ec-80fb-48e0-9937-2c70c9df9bad,Sentinel,Low,Scheduled,"Check for Squid proxy events associated with common ToR proxies. This query presumes the default squid log format is being used.
http://www.squid-cache.org/Doc/config/access_log/",CommandAndControl,T1090|T1008,P1D,P1D
,Squid proxy events related to mining pools,80733eb7-35b2-45b6-b2b8-3c51df258206,Sentinel,Low,Scheduled,"Checks for Squid proxy events in Syslog associated with common mining pools .This query presumes the default Squid log format is being used. 
 http://www.squid-cache.org/Doc/config/access_log/",CommandAndControl,T1102,P1D,P1D
,SSH - Potential Brute Force,e1ce0eab-10d1-4aae-863f-9a383345ba88,Sentinel,Low,Scheduled,Identifies an IP address that had 15 failed attempts to sign in via SSH in a 4 hour block during a 24 hour time period.,CredentialAccess,T1110,P1D,P1D
,Starting or Stopping HealthService to Avoid Detection,2bc7b4ae-eeaa-4538-ba15-ef298ec1ffae,Sentinel,Medium,Scheduled,"This query detects events where an actor is stopping or starting HealthService to disable telemetry collection/detection from the agent.
 The query requires a SACL to audit for access request to the service.",DefenseEvasion,T1562,P1D,P1D
,Successful logon from IP and failure from a different IP,02ef8d7e-fc3a-4d86-a457-650fa571d8d2,Sentinel,Medium,Scheduled,"Identifies when a user account successfully logs onto an Azure App from one IP and within 10 mins failed to logon to the same App via a different IP.
This may indicate a malicious attempt at password guessing based on knowledge of the users account.",CredentialAccess|InitialAccess,T1110|T1078,P1D,P1D
,SUNBURST and SUPERNOVA backdoor hashes,a3c144f9-8051-47d4-ac29-ffb0c312c910,Sentinel,High,Scheduled,"Identifies SolarWinds SUNBURST and SUPERNOVA backdoor file hash IOCs in DeviceFileEvents
References:
- https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html
- https://gist.github.com/olafhartong/71ffdd4cab4b6acd5cbcd1a0691ff82f",Execution|Persistence|InitialAccess,T1195|T1059|T1546,P1D,P1D
,SUNBURST and SUPERNOVA backdoor hashes (Normalized File Events),bc5ffe2a-84d6-48fe-bc7b-1055100469bc,Sentinel,High,Scheduled,"Identifies SolarWinds SUNBURST and SUPERNOVA backdoor file hash IOCs in File Events
To use this analytics rule, make sure you have deployed the [ASIM normalization parsers](https://aka.ms/ASimFileEvent)
References:
- https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html
- https://gist.github.com/olafhartong/71ffdd4cab4b6acd5cbcd1a0691ff82f",Execution|Persistence|InitialAccess,T1195|T1059|T1546,P1D,P1D
,SUNBURST network beacons,ce1e7025-866c-41f3-9b08-ec170e05e73e,Sentinel,Medium,Scheduled,"Identifies SolarWinds SUNBURST domain beacon IOCs in DeviceNetworkEvents
References:
- https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html
- https://gist.github.com/olafhartong/71ffdd4cab4b6acd5cbcd1a0691ff82f",Execution|Persistence|InitialAccess,T1195|T1059|T1546,P1D,P1D
,SUNBURST suspicious SolarWinds child processes,4a3073ac-7383-48a9-90a8-eb6716183a54,Sentinel,Medium,Scheduled,"Identifies suspicious child processes of SolarWinds.Orion.Core.BusinessLayer.dll that may be evidence of the SUNBURST backdoor
References:
- https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html
- https://gist.github.com/olafhartong/71ffdd4cab4b6acd5cbcd1a0691ff82f",Execution|Persistence,,P1D,P1D
,SUNBURST suspicious SolarWinds child processes (Normalized Process Events),631d02df-ab51-46c1-8d72-32d0cfec0720,Sentinel,Medium,Scheduled,"Identifies suspicious child processes of SolarWinds.Orion.Core.BusinessLayer.dll that may be evidence of the SUNBURST backdoor
References:
- https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html
- https://gist.github.com/olafhartong/71ffdd4cab4b6acd5cbcd1a0691ff82f
To use this analytics rule, make sure you have deployed the [ASIM normalization parsers](https://aka.ms/ASimProcessEvent)",Execution|Persistence,,P1D,P1D
,SUNSPOT log file creation,c0e84221-f240-4dd7-ab1e-37e034ea2a4e,Sentinel,Medium,Scheduled,"This query uses Microsoft Defender for Endpoint data and Windows Event Logs to look for IoCs associated with the SUNSPOT malware shared by Crowdstrike.
More details: 
  - https://www.crowdstrike.com/blog/sunspot-malware-technical-analysis/ 
  - https://techcommunity.microsoft.com/t5/azure-sentinel/monitoring-your-software-build-process-with-azure-sentinel/ba-p/2140807",Persistence,T1554,P1D,P1D
,SUNSPOT malware hashes,53e936c6-6c30-4d12-8343-b8a0456e8429,Sentinel,Medium,Scheduled,"This query uses Microsoft Defender for Endpoint data to look for IoCs associated with the SUNSPOT malware shared by Crowdstrike.
More details: 
  - https://www.crowdstrike.com/blog/sunspot-malware-technical-analysis/ 
  - https://techcommunity.microsoft.com/t5/azure-sentinel/monitoring-your-software-build-process-with-azure-sentinel/ba-p/2140807",Persistence,T1554,P1D,P1D
,SUPERNOVA webshell,2acc91c3-17c2-4388-938e-4eac2d5894e8,Sentinel,High,Scheduled,"Identifies SUPERNOVA webshell based on W3CIISLog data.
 References:
 - https://unit42.paloaltonetworks.com/solarstorm-supernova/",Persistence|CommandAndControl,T1505|T1071,P1D,P1D
,Suspicious application consent for offline access,3533f74c-9207-4047-96e2-0eb9383be587,Sentinel,Low,Scheduled,"This will alert when a user consents to provide a previously-unknown Azure application with offline access via OAuth.
Offline access will provide the Azure App with access to the listed resources without requiring two-factor authentication.
Consent to applications with offline access and read capabilities should be rare, especially as the knownApplications list is expanded. Public contributions to expand this filter are welcome!
For further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities.",CredentialAccess,T1528,P1D,P14D
,Suspicious application consent similar to O365 Attack Toolkit,f948a32f-226c-4116-bddd-d95e91d97eb9,Sentinel,High,Scheduled,"This will alert when a user consents to provide a previously-unknown Azure application with the same OAuth permissions used by the MDSec O365 Attack Toolkit (https://github.com/mdsecactivebreach/o365-attack-toolkit).
The default permissions/scope for the MDSec O365 Attack toolkit are contacts.read, user.read, mail.read, notes.read.all, mailboxsettings.readwrite, and files.readwrite.all.
Consent to applications with these permissions should be rare, especially as the knownApplications list is expanded, especially as the knownApplications list is expanded. Public contributions to expand this filter are welcome!
For further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities.",CredentialAccess|DefenseEvasion,T1528|T1550,P1D,P14D
,Suspicious application consent similar to PwnAuth,39198934-62a0-4781-8416-a81265c03fd6,Sentinel,Medium,Scheduled,"This will alert when a user consents to provide a previously-unknown Azure application with the same OAuth permissions used by the FireEye PwnAuth toolkit (https://github.com/fireeye/PwnAuth).
The default permissions/scope for the PwnAuth toolkit are user.read, offline_access, mail.readwrite, mail.send, and files.read.all.
Consent to applications with these permissions should be rare, especially as the knownApplications list is expanded. Public contributions to expand this filter are welcome!
For further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities.",CredentialAccess|DefenseEvasion,T1528|T1550,P1D,P14D
,Suspicious granting of permissions to an account,b2c15736-b9eb-4dae-8b02-3016b6a45a32,Sentinel,Medium,Scheduled,Identifies IPs from which users grant access to other users on azure resources and alerts when a previously unseen source IP address is used.,Persistence|PrivilegeEscalation,T1098|T1548,P1D,P14D
,Suspicious link sharing pattern,1218175f-c534-421c-8070-5dcaabf28067,Sentinel,Low,Scheduled,"Alerts in links that have been shared across multiple Zoom chat channels by the same user in a short space if time.
Adjust the threshold figure to change the number of channels a message needs to be posted in before an alert is raised.",CredentialAccess|Persistence,,P1D,P1D
,Suspicious linking of existing user to external User,22a320c2-e1e5-4c74-a35b-39fc9cdcf859,Sentinel,Medium,Scheduled," This query will detect when an attempt is made to update an existing user and link it to an guest or external identity. These activities are unusual and such linking of external 
identities should be investigated. In some cases you may see internal AAD sync accounts (Sync_) do this which may be benign",PrivilegeEscalation,T1078,P1D,P1D
,Suspicious Login from deleted guest account,defe4855-0d33-4362-9557-009237623976,Sentinel,Medium,Scheduled," This query will detect logins from guest account which was recently deleted. 
For any successful logins from deleted identities should be investigated further if any existing user accounts have been altered or linked to such identity prior deletion",PrivilegeEscalation,T1078,P1D,P1D
,Suspicious modification of Global Administrator user properties,48602a24-67cf-4362-b258-3f4249e55def,Sentinel,Medium,Scheduled," This query will detect if user properties of Global Administrator are updated by an existing user. Usually only user administrator or other global administrator can update such properties.
Investigate if such user change is an attempt to elevate an existing low privileged identity or rogue administrator activity",PrivilegeEscalation,T1078,P1D,P1D
,Suspicious number of resource creation or deployment activities,361dd1e3-1c11-491e-82a3-bb2e44ac36ba,Sentinel,Medium,Scheduled,"Indicates when an anomalous number of VM creations or deployment activities occur in Azure via the AzureActivity log.
The anomaly detection identifies activities that have occurred both since the start of the day 1 day ago and the start of the day 7 days ago.
The start of the day is considered 12am UTC time.",Impact,T1496,P1D,P7D
,Suspicious Resource deployment,9fb57e58-3ed8-4b89-afcf-c8e786508b1c,Sentinel,Low,Scheduled,Identifies when a rare Resource and ResourceGroup deployment occurs by a previously unseen Caller.,Impact,T1496,P1D,P14D
,Suspicious Service Principal creation activity,6852d9da-8015-4b95-8ecf-d9572ee0395d,Sentinel,Low,Scheduled,"This alert will detect creation of an SPN, permissions granted, credentials created, activity and deletion of the SPN in a time frame (default 10 minutes)",CredentialAccess|PrivilegeEscalation|InitialAccess,T1078|T1528,PT1H,PT1H10M
,Tarrask malware IOC - April 2022,caf78b95-d886-4ac3-957a-a7a3691ff4ed,Sentinel,High,Scheduled,"Identifies a hash match related to Tarrask malware across various data sources.
 Reference: https://www.microsoft.com/security/blog/2022/04/12/tarrask-malware-uses-scheduled-tasks-for-defense-evasion/",Persistence,T1053,PT12H,PT12H
,TEARDROP memory-only dropper,738702fd-0a66-42c7-8586-e30f0583f8fe,Sentinel,High,Scheduled,"Identifies SolarWinds TEARDROP memory-only dropper IOCs in Window's defender Exploit Guard activity
References:
- https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html
- https://gist.github.com/olafhartong/71ffdd4cab4b6acd5cbcd1a0691ff82f",Execution|Persistence|DefenseEvasion,T1543|T1059|T1027,P1D,P1D
,THALLIUM domains included in DCU takedown,70b12a3b-4896-42cb-910c-5ffaf8d7987d,Sentinel,High,Scheduled,"THALLIUM spearphishing and command and control domains included in December 2019 DCU/MSTIC takedown. 
 Matches domain name IOCs related to the THALLIUM activity group with CommonSecurityLog, DnsEvents, VMConnection and SecurityEvents dataTypes.
 References: https://blogs.microsoft.com/on-the-issues/2019/12/30/microsoft-court-action-against-nation-state-cybercrime/ ",CommandAndControl|CredentialAccess,,P1D,P1D
,TI map Domain entity to CommonSecurityLog,dd0a6029-ecef-4507-89c4-fc355ac52111,Sentinel,Medium,Scheduled,Identifies a match in CommonSecurityLog table from any Domain IOC from TI,Impact,,PT1H,P14D
,TI map Domain entity to DnsEvents,85aca4d1-5d15-4001-abd9-acb86ca1786a,Sentinel,Medium,Scheduled,Identifies a match in DnsEvents from any Domain IOC from TI,Impact,,PT1H,P14D
,TI map Domain entity to PaloAlto,ec21493c-2684-4acd-9bc2-696dbad72426,Sentinel,Medium,Scheduled,Identifies a match in Palo Alto data in CommonSecurityLog table from any Domain IOC from TI,Impact,,PT1H,P14D
,TI map Domain entity to SecurityAlert,87890d78-3e05-43ec-9ab9-ba32f4e01250,Sentinel,Medium,Scheduled,Identifies a match in SecurityAlert table from any Domain IOC from TI,Impact,,PT1H,P14D
,TI map Domain entity to Syslog,532f62c1-fba6-4baa-bbb6-4a32a4ef32fa,Sentinel,Medium,Scheduled,Identifies a match in Syslog table from any Domain IOC from TI,Impact,,PT1H,P14D
,TI map Email entity to AzureActivity,cca3b4d9-ac39-4109-8b93-65bb284003e6,Sentinel,Medium,Scheduled,Identifies a match in AzureActivity table from any Email IOC from TI,Impact,,PT1H,P14D
,TI map Email entity to CommonSecurityLog,ffcd575b-3d54-482a-a6d8-d0de13b6ac63,Sentinel,Medium,Scheduled,Identifies a match in CommonSecurityLog table from any Email IOC from TI,Impact,,PT1H,P14D
,TI map Email entity to OfficeActivity,4a3f5ed7-8da5-4ce2-af6f-c9ada45060f2,Sentinel,Medium,Scheduled,Identifies a match in OfficeActivity table from any Email IOC from TI,Impact,,PT1H,P14D
,TI map Email entity to SecurityAlert,a2e36ce0-da4d-4b6e-88c6-4e40161c5bfc,Sentinel,Medium,Scheduled,"Identifies a match in SecurityAlert table from any Email IOC from TI which will extend coverage to datatypes such as MCAS, StorageThreatProtection and many others",Impact,,PT1H,P14D
,TI map Email entity to SecurityEvent,2fc5d810-c9cc-491a-b564-841427ae0e50,Sentinel,Medium,Scheduled,Identifies a match in SecurityEvent table from any Email IOC from TI,Impact,,PT1H,P14D
,TI map Email entity to SigninLogs,30fa312c-31eb-43d8-b0cc-bcbdfb360822,Sentinel,Medium,Scheduled,Identifies a match in SigninLogs table from any Email IOC from TI,Impact,,PT1H,P14D
,TI map File Hash to CommonSecurityLog Event,5d33fc63-b83b-4913-b95e-94d13f0d379f,Sentinel,Medium,Scheduled,Identifies a match in CommonSecurityLog Event data from any FileHash IOC from TI,Impact,,PT1H,P14D
,TI map File Hash to Security Event,a7427ed7-04b4-4e3b-b323-08b981b9b4bf,Sentinel,Medium,Scheduled,Identifies a match in Security Event data from any File Hash IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to AppServiceHTTPLogs,f9949656-473f-4503-bf43-a9d9890f7d08,Sentinel,Medium,Scheduled,Identifies a match in AppServiceHTTPLogs from any IP IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to AWSCloudTrail,f110287e-1358-490d-8147-ed804b328514,Sentinel,Medium,Scheduled,Identifies a match in AWSCloudTrail from any IP IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to Azure Key Vault logs,57c7e832-64eb-411f-8928-4133f01f4a25,Sentinel,Medium,Scheduled,Identifies a match in Azure Key Vault logsfrom any IP IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to Azure SQL Security Audit Events,d0aa8969-1bbe-4da3-9e76-09e5f67c9d85,Sentinel,Medium,Scheduled,Identifies a match in SQLSecurityAuditEvents from any IP IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to AzureActivity,2441bce9-02e4-407b-8cc7-7d597f38b8b0,Sentinel,Medium,Scheduled,Identifies a match in AzureActivity from any IP IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to AzureFirewall,0b904747-1336-4363-8d84-df2710bfe5e7,Sentinel,Medium,Scheduled,Identifies a match in AzureFirewall (NetworkRule & ApplicationRule Logs) from any IP IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to AzureNetworkAnalytics_CL (NSG Flow Logs),a4025a76-6490-4e6b-bb69-d02be4b03f07,Sentinel,Medium,Scheduled,Identifies a match in AzureNetworkAnalytics_CL (NSG Flow Logs) from any IP IOC from TI that was Allowed,Impact,,PT1H,P14D
,TI map IP entity to CommonSecurityLog,66c81ae2-1f89-4433-be00-2fbbd9ba5ebe,Sentinel,Medium,Scheduled,Identifies a match in CommonSecurityLog from any IP IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to DnsEvents,69b7723c-2889-469f-8b55-a2d355ed9c87,Sentinel,Medium,Scheduled,Identifies a match in DnsEvents from any IP IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to Duo Security,d23ed927-5be3-4902-a9c1-85f841eb4fa1,Sentinel,Medium,Scheduled,Identifies a match in DuoSecurity from any IP IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to GitHub_CL,aac495a9-feb1-446d-b08e-a1164a539452,Sentinel,Medium,Scheduled,Identifies a match in GitHub_CL table from any IP IOC from TI,Impact,,PT1H,P1D
,TI map IP entity to LastPass data,System.Object[],Solution,Medium,Scheduled,Identifies a match in LastPass table from any IP IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to OfficeActivity,f15370f4-c6fa-42c5-9be4-1d308f40284e,Sentinel,Medium,Scheduled,Identifies a match in OfficeActivity from any IP IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to SigninLogs,f2eb15bd-8a88-4b24-9281-e133edfba315,Sentinel,Medium,Scheduled,Identifies a match in SigninLogs from any IP IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to VMConnection,9713e3c0-1410-468d-b79e-383448434b2d,Sentinel,Medium,Scheduled,Identifies a match in VMConnection from any IP IOC from TI,Impact,,PT1H,P14D
,TI map IP entity to W3CIISLog,5e45930c-09b1-4430-b2d1-cc75ada0dc0f,Sentinel,Medium,Scheduled,Identifies a match in W3CIISLog from any IP IOC from TI,Impact,,PT1H,P14D
,TI map URL entity to AuditLogs,712fab52-2a7d-401e-a08c-ff939cc7c25e,Sentinel,Medium,Scheduled,Identifies a match in AuditLogs from any URL IOC from TI,Impact,,PT1H,P14D
,TI map URL entity to OfficeActivity data,36a9c9e5-3dc1-4ed9-afaa-1d13617bfc2b,Sentinel,Medium,Scheduled,Identifies a match in OfficeActivity data from any URL IOC from TI,Impact,,PT1H,P14D
,TI map URL entity to PaloAlto data,106813db-679e-4382-a51b-1bfc463befc3,Sentinel,Medium,Scheduled,Identifies a match in PaloAlto data from any URL IOC from TI,Impact,,PT1H,P14D
,TI map URL entity to SecurityAlert data,f30a47c1-65fb-42b1-a7f4-00941c12550b,Sentinel,Medium,Scheduled,Identifies a match in SecurityAlert data from any URL IOC from TI,Impact,,PT1H,P14D
,TI map URL entity to Syslog data,b31037ea-6f68-4fbd-bab2-d0d0f44c2fcf,Sentinel,Medium,Scheduled,Identifies a match in Syslog data from any URL IOC from TI,Impact,,PT1H,P14D
,Time series anomaly detection for total volume of traffic,06a9b845-6a95-4432-a78b-83919b28c375,Sentinel,Medium,Scheduled,"Identifies anamalous spikes in network traffic logs as compared to baseline or normal historical patterns.
The query leverages a KQL built-in anomaly detection algorithm to find large deviations from baseline patterns.
Sudden increases in network traffic volume may be an indication of data exfiltration attempts and should be investigated.
The higher the score, the further it is from the baseline value.
The output is aggregated to provide summary view of unique source IP to destination IP address and port traffic observed in the flagged anomaly hour.
The source IP addresses which were sending less than percentotalthreshold of the total traffic have been exluded whose value can be adjusted as needed .
You may have to run queries for individual source IP addresses from SourceIPlist to determine if anything looks suspicious",Exfiltration,T1030,P1D,P14D
,Time series anomaly for data size transferred to public internet,f2dd4a3a-ebac-4994-9499-1a859938c947,Sentinel,Medium,Scheduled,"Identifies anomalous data transfer to public networks. The query leverages built-in KQL anomaly detection algorithms that detects large deviations from a baseline pattern.
A sudden increase in data transferred to unknown public networks is an indication of data exfiltration attempts and should be investigated.
The higher the score, the further it is from the baseline value.
The output is aggregated to provide summary view of unique source IP to destination IP address and port bytes sent traffic observed in the flagged anomaly hour.
The source IP addresses which were sending less than bytessentperhourthreshold have been exluded whose value can be adjusted as needed .
You may have to run queries for individual source IP addresses from SourceIPlist to determine if anything looks suspicious",Exfiltration,T1030,P1D,P14D
,Trust Monitor Event,8dcf7238-a7d0-4cfd-8d0c-b230e3cd9182,Sentinel,Medium,Scheduled,This query identifies when a new trust monitor event is detected.,CredentialAccess,,PT5M,PT5M
,Unusual Anomaly,d0255b5f-2a3c-4112-8744-e6757af3283a,Sentinel,Medium,Scheduled,"Anomaly Rules generate events in the Anomalies table. This scheduled rule tries to detect Anomalies that are not usual, they could be a type of Anomaly that has recently been activated, or an infrequent type. The detected Anomaly should be reviewed, if it is relevant enough, eventually a separate scheduled Analytics Rule could be created specifically for that Anomaly Type, so an alert and/or incident is generated everytime that type of Anomaly happens.",,,PT1H,P4D
,Unusual identity creation using exchange powershell,0a3f4f4f-46ad-4562-acd6-f17730a5aef4,Sentinel,High,Scheduled," The query below identifies creation of unusual identity by the Europium actor to mimic Microsoft Exchange Health Manager Service account using Exchange PowerShell commands
  Reference: https://www.microsoft.com/security/blog/2022/09/08/microsoft-investigates-iranian-attacks-against-the-albanian-government/",Persistence,T1136,PT12H,PT12H
,Unusual Volume of Password Updated or Removed,System.Object[],Solution,Low,Scheduled,"This rule will check if there is an unnormal activity of sites that are deleted or changed per user.
 The normal amount of actions is calculated based on the previous 14 days of activity. If there is a significant increase, an incident will be created.",Impact,,P1D,P14D
,URL Added to Application from Unknown Domain,017e095a-94d8-430c-a047-e51a11fb737b,Sentinel,High,Scheduled,"Detects a URL being added to an application where the domain is not one that is associated with the tenant.
  The query uses domains seen in sign in logs to determine if the domain is associated with the tenant.
  Applications associated with URLs not controlled by the organization can pose a security risk.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-applications#application-configuration-changes",Persistence|PrivilegeEscalation,T1078,P1D,P1D
,User account added to built in domain local or global group,a35f2c18-1b97-458f-ad26-e033af18eb99,Sentinel,Low,Scheduled,"Identifies when a user account has been added to a privileged built in domain local group or global group
such as the Enterprise Admins, Cert Publishers or DnsAdmins. Be sure to verify this is an expected addition.",Persistence|PrivilegeEscalation,T1098|T1078,P1D,P1D
,User account created and deleted within 10 mins,4b93c5af-d20b-4236-b696-a28b8c51407f,Sentinel,Medium,Scheduled,"Identifies when a user account is created and then deleted within 10 minutes. This can be an indication of compromise and
an adversary attempting to hide in the noise.",Persistence|PrivilegeEscalation,T1098|T1078,P1D,P1DT1H
,User Account Created Using Incorrect Naming Format,ee55dc85-d2da-48c1-a6c0-3eaee62a8d56,Sentinel,Low,Scheduled,"This query looks for accounts being created where the name does not match a defined pattern.
  Attackers may attempt to add accounts as a means of establishing persistant access to an environment, looking for anomalies in created accounts may help identify illegitimately created accounts.
  Created accounts should be investigated to ensure they were legitimated created.
  The user_regex field in the query needs to be populated with the expected pattern for the environment before deployment.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-user-accounts#accounts-not-following-naming-policies",Persistence,T1136,P1D,P1D
,User account created without expected attributes defined,dc99e38c-f4e9-4837-94d7-353ac0b01a77,Sentinel,Low,Scheduled,"This query looks for accounts being created that do not have attributes populated that are commonly populated in the tenant.
  Attackers may attempt to add accounts as a means of establishing persistant access to an environment, looking for anomalies in created accounts may help identify illegitimately created accounts.
  Created accounts should be investigated to ensure they were legitimated created.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-user-accounts#accounts-not-following-naming-policies",Persistence,T1136,P1D,P1D
,User account enabled and disabled within 10 mins,3d023f64-8225-41a2-9570-2bd7c2c4535e,Sentinel,Medium,Scheduled,"Identifies when a user account is enabled and then disabled within 10 minutes. This can be an indication of compromise and
an adversary attempting to hide in the noise.",Persistence|PrivilegeEscalation,T1098|T1078,P1D,P1DT1H
,User Accounts - Sign in Failure due to CA Spikes,3a9d5ede-2b9d-43a2-acc4-d272321ff77c,Sentinel,Medium,Scheduled," Identifies spike in failed sign-ins from user accounts due to conditional access policied.
Spike is determined based on Time series anomaly which will look at historical baseline values.
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-user-accounts#monitoring-for-failed-unusual-sign-ins",InitialAccess,T1078,P1D,P14D
,User Added to Admin Role,2a09f8cb-deb7-4c40-b08b-9137667f1c0b,Sentinel,Low,Scheduled,"Detects a user being added to a new privileged role. Monitor these additions to ensure the users are made eligible for these roles are intended to have these levels of access.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-accounts#changes-to-privileged-accounts",PrivilegeEscalation,T1078,P1D,P1D
,User added to Azure Active Directory Privileged Groups,4d94d4a9-dc96-410a-8dea-4d4d4584188b,Sentinel,Medium,Scheduled,"This will alert when a user is added to any of the Privileged Groups.
For further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities.
For Administrator role permissions in Azure Active Directory please see https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles",Persistence|PrivilegeEscalation,T1098|T1078,PT1H,PT1H
,User agent search for log4j exploitation attempt,System.Object[],Solution,High,Scheduled,"This query uses various log sources having user agent data to look for log4j CVE-2021-44228 exploitation attempt based on user agent pattern. Log4j is an open-source Apache logging library that is used in 
 many Java-based applications. The regex and the string matching look for the most common attacks. This might not be comprehensive to detect every possible user agent variation.
 Reference: https://msrc-blog.microsoft.com/2021/12/11/microsofts-response-to-cve-2021-44228-apache-log4j2/",InitialAccess,,P1D,P1D
,User agent search for log4j exploitation attempt,29283b22-a1c0-4d16-b0a9-3460b655a46a,Sentinel,High,Scheduled,"This query uses various log sources having user agent data to look for log4j CVE-2021-44228 exploitation attempt based on user agent pattern. Log4j is an open-source Apache logging library that is used in 
 many Java-based applications. The regex and the string matching look for the most common attacks. This might not be comprehensive to detect every possible user agent variation.
 Reference: https://msrc-blog.microsoft.com/2021/12/11/microsofts-response-to-cve-2021-44228-apache-log4j2/",InitialAccess,T1190,P1D,P1D
,User Assigned Privileged Role,050b9b3d-53d0-4364-a3da-1b678b8211ec,Sentinel,High,Scheduled,"Identifies when a new privileged role is assigned to a user.  Any account eligible for a role is now being given privileged access. If the assignment is unexpected or into a role that isn't the responsibility of the account holder, investigate.
Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-accounts#things-to-monitor-1",Persistence,T1078,PT2H,PT2H
,User joining Zoom meeting from suspicious timezone,58fc0170-0877-4ea8-a9ff-d805e361cfae,Sentinel,Low,Scheduled,"The alert shows users that join a Zoom meeting from a time zone other than the one the meeting was created in.
You can also whitelist known good time zones in the tz_whitelist value using the tz database name format https://en.wikipedia.org/wiki/List_of_tz_database_time_zones",InitialAccess|PrivilegeEscalation,T1078,P1D,P14D
,User login from different countries within 3 hours (Uses Authentication Normalization),09ec8fa2-b25f-4696-bfae-05a7b85d7b9e,Sentinel,High,Scheduled,"This query searches for successful user logins from different countries within 3 hours.
 To use this analytics rule, make sure you have deployed the [ASIM normalization parsers](https://aka.ms/ASimAuthentication)",InitialAccess,T1078,PT3H,PT3H
,User State changed from Guest to Member,a09a0b8e-30fe-4ebf-94a0-cffe50f579cd,Sentinel,Medium,Scheduled,"Detects when a guest account in a tenant is converted to a member of the tenant.
  Monitoring guest accounts and the access they are provided is important to detect potential account abuse.
  Accounts converted to members should be investigated to ensure the activity was legitimate.
  Ref: https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-user-accounts#monitoring-for-failed-unusual-sign-ins",Persistence,T1098,P1D,P1D
,Users searching for VIP user activity,f7f4a77e-f68f-4b56-9aaf-a0c9d87d7a8e,Sentinel,Low,Scheduled,"This query monitors for users running Log Analytics queries that contain filters
for specific, defined VIP user accounts or the VIPUser watchlist template.
Use this detection to alert for users specifically searching for activity of sensitive users.",Collection|Exfiltration,T1530|T1213|T1020,P1D,P1D
,Vulnerable Machines related to log4j CVE-2021-44228,3d71fc38-f249-454e-8479-0a358382ef9a,Sentinel,High,Scheduled,"This query uses the Azure Defender Security Nested Recommendations data to find machines vulnerable to log4j CVE-2021-44228. Log4j is an open-source Apache logging library that is used in 
 many Java-based applications. Security Nested Recommendations data is sent to Microsoft Sentinel using the continuous export feature of Azure Defender(refrence link below).
 Reference: https://msrc-blog.microsoft.com/2021/12/11/microsofts-response-to-cve-2021-44228-apache-log4j2/
 Reference: https://docs.microsoft.com/azure/security-center/continuous-export?tabs=azure-portal
 Reference: https://techcommunity.microsoft.com/t5/microsoft-defender-for-cloud/how-defender-for-cloud-displays-machines-affected-by-log4j/ba-p/3037271",InitialAccess|Execution,T1190|T1203,P1D,P1D
,Vulnerable Machines related to log4j CVE-2021-44228,System.Object[],Solution,High,Scheduled,"This query uses the Azure Defender Security Nested Recommendations data to find machines vulnerable to log4j CVE-2021-44228. Log4j is an open-source Apache logging library that is used in 
 many Java-based applications. Security Nested Recommendations data is sent to Microsoft Sentinel using the continuous export feature of Azure Defender(refrence link below).
 Reference: https://msrc-blog.microsoft.com/2021/12/11/microsofts-response-to-cve-2021-44228-apache-log4j2/
 Reference: https://docs.microsoft.com/azure/security-center/continuous-export?tabs=azure-portal
 Reference: https://techcommunity.microsoft.com/t5/microsoft-defender-for-cloud/how-defender-for-cloud-displays-machines-affected-by-log4j/ba-p/3037271",InitialAccess|Execution,,P1D,P1D
,Vulnerable Machines related to OMIGOD CVE-2021-38647,4d94d4a9-dc96-450a-9dea-4d4d4594199b,Sentinel,High,Scheduled,"This query uses the Azure Defender Security Nested Recommendations data to find machines vulnerable to OMIGOD CVE-2021-38647. OMI is the Linux equivalent of Windows WMI and 
 helps users manage configurations across remote and local environments. The query aims to find machines that have this OMI vulnerability (CVE-2021-38647).
 Security Nested Recommendations data is sent to Microsoft Sentinel using the continuous export feature of Azure Defender(refrence link below).
 Reference: https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure
 Reference: https://docs.microsoft.com/azure/security-center/continuous-export?tabs=azure-portal",InitialAccess|Execution,T1190|T1203,P1D,P1D
,Wazuh - Large Number of Web errors from an IP,2790795b-7dba-483e-853f-44aa0bc9c985,Sentinel,Low,Scheduled,Identifies instances where Wazuh logged over 400 '403' Web Errors from one IP Address. To onboard Wazuh data into Sentinel please view: https://github.com/wazuh/wazuh-documentation/blob/master/source/azure/monitoring%20activity.rst,Persistence,,P1D,P1D
,WDigest downgrade attack,f6502545-ae3a-4232-a8b0-79d87e5c98d7,Sentinel,Medium,Scheduled,"When the WDigest Authentication protocol is enabled, plain text passwords are stored in the Local Security Authority Subsystem Service (LSASS) exposing them to theft. This setting will prevent WDigest from storing credentials in memory.
Ref: https://www.stigviewer.com/stig/windows_7/2016-12-19/finding/V-72753",CredentialAccess,T1003,PT1H,PT1H
,Windows Binaries Executed from Non-Default Directory,15049017-527f-4d3b-b011-b0e99e68ef45,Sentinel,Medium,Scheduled,"The query detects Windows binaries, that can be executed from a non-default directory (e.g. C:\Windows\, C:\Windows\System32 etc.). 
Ref: https://lolbas-project.github.io/",Execution,T1059,PT1H,PT1H
,Windows Binaries Lolbins Renamed,cbf6ad48-fa5c-4bf7-b205-28dbadb91255,Sentinel,Medium,Scheduled,"This query detects the execution of renamed Windows binaries (Lolbins). This is a common technique used by adversaries to evade detection. 
Ref: https://docs.paloaltonetworks.com/cortex/cortex-xdr/cortex-xdr-analytics-alert-reference/cortex-xdr-analytics-alert-reference/execution-of-renamed-lolbin.html",Execution,T1059,PT1H,PT1H
,Windows host username encoded in base64 web request,6e715730-82c0-496c-983b-7a20c4590bd9,Sentinel,Medium,Scheduled,"This detection will identify network requests in HTTP proxy data that contains Base64 encoded usernames from machines in the DeviceEvents table.
This technique was seen usee by POLONIUM in their RunningRAT tool.",Exfiltration|CommandAndControl,T1041|T1071,P1D,P1D
,Workspace deletion attempt from an infected device,a5b3429d-f1da-42b9-883c-327ecb7b91ff,Sentinel,Medium,Scheduled,"This query will alert on any sign-ins from devices infected with malware in correlation with potential workspace deletion activity. 
Attackers may attempt to delete  workspaces containing  compute instances  after successful compromise to cause service unavailability to regular business operation.",InitialAccess|Impact,T1078|T1489,P1D,P14D
,Zinc Actor IOCs domains hashes IPs and useragent - October 2022,95543d6d-f00d-4193-a63f-4edeefb7ec36,Sentinel,High,Scheduled,"Identifies a match across domainname, IP, hash and useragent IOCs related to an actor tracked by Microsoft as Zinc.
Reference: https://www.microsoft.com/security/blog/2022/09/29/zinc-weaponizing-open-source-software/",Persistence,T1546,PT6H,PT6H
,Zinc Actor IOCs files - October 2022,9a7f6651-801b-491c-a548-8b454b356eaa,Sentinel,High,Scheduled,"Identifies a match across filename and commandline IOC's related to an actor tracked by Microsoft as Zinc.
Reference: https://www.microsoft.com/security/blog/2022/09/29/zinc-weaponizing-open-source-software/",Persistence,T1546,PT6H,PT6H
,Zoom E2E Encryption Disabled,e4779bdc-397a-4b71-be28-59e6a1e1d16b,Sentinel,Medium,Scheduled,This alerts when end to end encryption is disabled for Zoom meetings.,CredentialAccess|Discovery,T1040,P1D,P1D
